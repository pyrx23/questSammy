import{i as u_,e as l_,f as h_,h as f_,j as d_,k as p_,m as g_,o as y_,p as m_,q as v_,s as Ca,r as $a,t as Da,u as Ua,v as nu,w as ne,x as Qr,y as __,z as Uf,A as ja,B as jf,H as b_,C as La,D as Lf,E as qf,F as qa,G as w_,I as pa,J as E_,K as su,L as I_,_ as S_}from"./index-7Sksl8rG.js";import{s as as,a as Ma,d as x_,i as wh,c as P_,b as O_,f as au,p as N_,J as hi,e as ou,g as cu,h as uu,j as Si,k as li,l as es,m as T_,n as A_,H as Oi}from"./http-3IaJyFM4.js";function lu(n){return globalThis.Buffer!=null?new Uint8Array(n.buffer,n.byteOffset,n.byteLength):n}function Mf(n=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?lu(globalThis.Buffer.allocUnsafe(n)):new Uint8Array(n)}function qc(n,t){t||(t=n.reduce((a,c)=>a+c.length,0));const r=Mf(t);let s=0;for(const a of n)r.set(a,s),s+=a.length;return lu(r)}const Eh={...u_,...l_,...h_,...f_,...d_,...p_,...g_,...y_,...m_,...v_};function zf(n,t,r,s){return{name:n,prefix:t,encoder:{name:n,prefix:t,encode:r},decoder:{decode:s}}}const Ih=zf("utf8","u",n=>"u"+new TextDecoder("utf8").decode(n),n=>new TextEncoder().encode(n.substring(1))),mc=zf("ascii","a",n=>{let t="a";for(let r=0;r<n.length;r++)t+=String.fromCharCode(n[r]);return t},n=>{n=n.substring(1);const t=Mf(n.length);for(let r=0;r<n.length;r++)t[r]=n.charCodeAt(r);return t}),Ff={utf8:Ih,"utf-8":Ih,hex:Eh.base16,latin1:mc,ascii:mc,binary:mc,...Eh};function nr(n,t="utf8"){const r=Ff[t];if(!r)throw new Error(`Unsupported encoding "${t}"`);return(t==="utf8"||t==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?lu(globalThis.Buffer.from(n,"utf-8")):r.decoder.decode(`${r.prefix}${n}`)}function Jt(n,t="utf8"){const r=Ff[t];if(!r)throw new Error(`Unsupported encoding "${t}"`);return(t==="utf8"||t==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(n.buffer,n.byteOffset,n.byteLength).toString("utf8"):r.encoder.encode(n).substring(1)}const R_={waku:{publish:"waku_publish",batchPublish:"waku_batchPublish",subscribe:"waku_subscribe",batchSubscribe:"waku_batchSubscribe",subscription:"waku_subscription",unsubscribe:"waku_unsubscribe",batchUnsubscribe:"waku_batchUnsubscribe"},irn:{publish:"irn_publish",batchPublish:"irn_batchPublish",subscribe:"irn_subscribe",batchSubscribe:"irn_batchSubscribe",subscription:"irn_subscription",unsubscribe:"irn_unsubscribe",batchUnsubscribe:"irn_batchUnsubscribe"},iridium:{publish:"iridium_publish",batchPublish:"iridium_batchPublish",subscribe:"iridium_subscribe",batchSubscribe:"iridium_batchSubscribe",subscription:"iridium_subscription",unsubscribe:"iridium_unsubscribe",batchUnsubscribe:"iridium_batchUnsubscribe"}};var C_={};(function(n){const t=Da,r=Ua,s=Ca,a=$a,c=l=>l==null,f=Symbol("encodeFragmentIdentifier");function b(l){switch(l.arrayFormat){case"index":return p=>(m,y)=>{const g=m.length;return y===void 0||l.skipNull&&y===null||l.skipEmptyString&&y===""?m:y===null?[...m,[E(p,l),"[",g,"]"].join("")]:[...m,[E(p,l),"[",E(g,l),"]=",E(y,l)].join("")]};case"bracket":return p=>(m,y)=>y===void 0||l.skipNull&&y===null||l.skipEmptyString&&y===""?m:y===null?[...m,[E(p,l),"[]"].join("")]:[...m,[E(p,l),"[]=",E(y,l)].join("")];case"colon-list-separator":return p=>(m,y)=>y===void 0||l.skipNull&&y===null||l.skipEmptyString&&y===""?m:y===null?[...m,[E(p,l),":list="].join("")]:[...m,[E(p,l),":list=",E(y,l)].join("")];case"comma":case"separator":case"bracket-separator":{const p=l.arrayFormat==="bracket-separator"?"[]=":"=";return m=>(y,g)=>g===void 0||l.skipNull&&g===null||l.skipEmptyString&&g===""?y:(g=g===null?"":g,y.length===0?[[E(m,l),p,E(g,l)].join("")]:[[y,E(g,l)].join(l.arrayFormatSeparator)])}default:return p=>(m,y)=>y===void 0||l.skipNull&&y===null||l.skipEmptyString&&y===""?m:y===null?[...m,E(p,l)]:[...m,[E(p,l),"=",E(y,l)].join("")]}}function S(l){let p;switch(l.arrayFormat){case"index":return(m,y,g)=>{if(p=/\[(\d*)\]$/.exec(m),m=m.replace(/\[\d*\]$/,""),!p){g[m]=y;return}g[m]===void 0&&(g[m]={}),g[m][p[1]]=y};case"bracket":return(m,y,g)=>{if(p=/(\[\])$/.exec(m),m=m.replace(/\[\]$/,""),!p){g[m]=y;return}if(g[m]===void 0){g[m]=[y];return}g[m]=[].concat(g[m],y)};case"colon-list-separator":return(m,y,g)=>{if(p=/(:list)$/.exec(m),m=m.replace(/:list$/,""),!p){g[m]=y;return}if(g[m]===void 0){g[m]=[y];return}g[m]=[].concat(g[m],y)};case"comma":case"separator":return(m,y,g)=>{const N=typeof y=="string"&&y.includes(l.arrayFormatSeparator),P=typeof y=="string"&&!N&&O(y,l).includes(l.arrayFormatSeparator);y=P?O(y,l):y;const Q=N||P?y.split(l.arrayFormatSeparator).map(se=>O(se,l)):y===null?y:O(y,l);g[m]=Q};case"bracket-separator":return(m,y,g)=>{const N=/(\[\])$/.test(m);if(m=m.replace(/\[\]$/,""),!N){g[m]=y&&O(y,l);return}const P=y===null?[]:y.split(l.arrayFormatSeparator).map(Q=>O(Q,l));if(g[m]===void 0){g[m]=P;return}g[m]=[].concat(g[m],P)};default:return(m,y,g)=>{if(g[m]===void 0){g[m]=y;return}g[m]=[].concat(g[m],y)}}}function v(l){if(typeof l!="string"||l.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function E(l,p){return p.encode?p.strict?t(l):encodeURIComponent(l):l}function O(l,p){return p.decode?r(l):l}function R(l){return Array.isArray(l)?l.sort():typeof l=="object"?R(Object.keys(l)).sort((p,m)=>Number(p)-Number(m)).map(p=>l[p]):l}function z(l){const p=l.indexOf("#");return p!==-1&&(l=l.slice(0,p)),l}function q(l){let p="";const m=l.indexOf("#");return m!==-1&&(p=l.slice(m)),p}function W(l){l=z(l);const p=l.indexOf("?");return p===-1?"":l.slice(p+1)}function ie(l,p){return p.parseNumbers&&!Number.isNaN(Number(l))&&typeof l=="string"&&l.trim()!==""?l=Number(l):p.parseBooleans&&l!==null&&(l.toLowerCase()==="true"||l.toLowerCase()==="false")&&(l=l.toLowerCase()==="true"),l}function ce(l,p){p=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},p),v(p.arrayFormatSeparator);const m=S(p),y=Object.create(null);if(typeof l!="string"||(l=l.trim().replace(/^[?#&]/,""),!l))return y;for(const g of l.split("&")){if(g==="")continue;let[N,P]=s(p.decode?g.replace(/\+/g," "):g,"=");P=P===void 0?null:["comma","separator","bracket-separator"].includes(p.arrayFormat)?P:O(P,p),m(O(N,p),P,y)}for(const g of Object.keys(y)){const N=y[g];if(typeof N=="object"&&N!==null)for(const P of Object.keys(N))N[P]=ie(N[P],p);else y[g]=ie(N,p)}return p.sort===!1?y:(p.sort===!0?Object.keys(y).sort():Object.keys(y).sort(p.sort)).reduce((g,N)=>{const P=y[N];return P&&typeof P=="object"&&!Array.isArray(P)?g[N]=R(P):g[N]=P,g},Object.create(null))}n.extract=W,n.parse=ce,n.stringify=(l,p)=>{if(!l)return"";p=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},p),v(p.arrayFormatSeparator);const m=P=>p.skipNull&&c(l[P])||p.skipEmptyString&&l[P]==="",y=b(p),g={};for(const P of Object.keys(l))m(P)||(g[P]=l[P]);const N=Object.keys(g);return p.sort!==!1&&N.sort(p.sort),N.map(P=>{const Q=l[P];return Q===void 0?"":Q===null?E(P,p):Array.isArray(Q)?Q.length===0&&p.arrayFormat==="bracket-separator"?E(P,p)+"[]":Q.reduce(y(P),[]).join("&"):E(P,p)+"="+E(Q,p)}).filter(P=>P.length>0).join("&")},n.parseUrl=(l,p)=>{p=Object.assign({decode:!0},p);const[m,y]=s(l,"#");return Object.assign({url:m.split("?")[0]||"",query:ce(W(l),p)},p&&p.parseFragmentIdentifier&&y?{fragmentIdentifier:O(y,p)}:{})},n.stringifyUrl=(l,p)=>{p=Object.assign({encode:!0,strict:!0,[f]:!0},p);const m=z(l.url).split("?")[0]||"",y=n.extract(l.url),g=n.parse(y,{sort:!1}),N=Object.assign(g,l.query);let P=n.stringify(N,p);P&&(P=`?${P}`);let Q=q(l.url);return l.fragmentIdentifier&&(Q=`#${p[f]?E(l.fragmentIdentifier,p):l.fragmentIdentifier}`),`${m}${P}${Q}`},n.pick=(l,p,m)=>{m=Object.assign({parseFragmentIdentifier:!0,[f]:!1},m);const{url:y,query:g,fragmentIdentifier:N}=n.parseUrl(l,m);return n.stringifyUrl({url:y,query:a(g,p),fragmentIdentifier:N},m)},n.exclude=(l,p,m)=>{const y=Array.isArray(p)?g=>!p.includes(g):(g,N)=>!p(g,N);return n.pick(l,y,m)}})(C_);function $_(n,t=[]){const r=[];return Object.keys(n).forEach(s=>{if(t.length&&!t.includes(s))return;const a=n[s];r.push(...a.accounts)}),r}const D_={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}};function U_(n,t){const{message:r,code:s}=D_[n];return{message:t?`${r} ${t}`:r,code:s}}function Mc(n,t){return Array.isArray(n)?typeof t<"u"&&n.length?n.every(t):!0:!1}const j_=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,L_=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,q_=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;function M_(n,t){if(n==="__proto__"||n==="constructor"&&t&&typeof t=="object"&&"prototype"in t){z_(n);return}return t}function z_(n){console.warn(`[destr] Dropping "${n}" key to prevent prototype pollution.`)}function ga(n,t={}){if(typeof n!="string")return n;const r=n.trim();if(n[0]==='"'&&n.at(-1)==='"'&&!n.includes("\\"))return r.slice(1,-1);if(r.length<=9){const s=r.toLowerCase();if(s==="true")return!0;if(s==="false")return!1;if(s==="undefined")return;if(s==="null")return null;if(s==="nan")return Number.NaN;if(s==="infinity")return Number.POSITIVE_INFINITY;if(s==="-infinity")return Number.NEGATIVE_INFINITY}if(!q_.test(n)){if(t.strict)throw new SyntaxError("[destr] Invalid JSON");return n}try{if(j_.test(n)||L_.test(n)){if(t.strict)throw new Error("[destr] Possible prototype pollution");return JSON.parse(n,M_)}return JSON.parse(n)}catch(s){if(t.strict)throw s;return n}}function F_(n){return!n||typeof n.then!="function"?Promise.resolve(n):n}function zt(n,...t){try{return F_(n(...t))}catch(r){return Promise.reject(r)}}function H_(n){const t=typeof n;return n===null||t!=="object"&&t!=="function"}function K_(n){const t=Object.getPrototypeOf(n);return!t||t.isPrototypeOf(Object)}function wa(n){if(H_(n))return String(n);if(K_(n)||Array.isArray(n))return JSON.stringify(n);if(typeof n.toJSON=="function")return wa(n.toJSON());throw new Error("[unstorage] Cannot stringify value!")}function Hf(){if(typeof Buffer===void 0)throw new TypeError("[unstorage] Buffer is not supported!")}const zc="base64:";function k_(n){if(typeof n=="string")return n;Hf();const t=Buffer.from(n).toString("base64");return zc+t}function V_(n){return typeof n!="string"||!n.startsWith(zc)?n:(Hf(),Buffer.from(n.slice(zc.length),"base64"))}function dr(n){return n?n.split("?")[0].replace(/[/\\]/g,":").replace(/:+/g,":").replace(/^:|:$/g,""):""}function B_(...n){return dr(n.join(":"))}function ya(n){return n=dr(n),n?n+":":""}const G_="memory",W_=()=>{const n=new Map;return{name:G_,options:{},hasItem(t){return n.has(t)},getItem(t){return n.get(t)??null},getItemRaw(t){return n.get(t)??null},setItem(t,r){n.set(t,r)},setItemRaw(t,r){n.set(t,r)},removeItem(t){n.delete(t)},getKeys(){return Array.from(n.keys())},clear(){n.clear()},dispose(){n.clear()}}};function Q_(n={}){const t={mounts:{"":n.driver||W_()},mountpoints:[""],watching:!1,watchListeners:[],unwatch:{}},r=v=>{for(const E of t.mountpoints)if(v.startsWith(E))return{base:E,relativeKey:v.slice(E.length),driver:t.mounts[E]};return{base:"",relativeKey:v,driver:t.mounts[""]}},s=(v,E)=>t.mountpoints.filter(O=>O.startsWith(v)||E&&v.startsWith(O)).map(O=>({relativeBase:v.length>O.length?v.slice(O.length):void 0,mountpoint:O,driver:t.mounts[O]})),a=(v,E)=>{if(t.watching){E=dr(E);for(const O of t.watchListeners)O(v,E)}},c=async()=>{if(!t.watching){t.watching=!0;for(const v in t.mounts)t.unwatch[v]=await Sh(t.mounts[v],a,v)}},f=async()=>{if(t.watching){for(const v in t.unwatch)await t.unwatch[v]();t.unwatch={},t.watching=!1}},b=(v,E,O)=>{const R=new Map,z=q=>{let W=R.get(q.base);return W||(W={driver:q.driver,base:q.base,items:[]},R.set(q.base,W)),W};for(const q of v){const W=typeof q=="string",ie=dr(W?q:q.key),ce=W?void 0:q.value,l=W||!q.options?E:{...E,...q.options},p=r(ie);z(p).items.push({key:ie,value:ce,relativeKey:p.relativeKey,options:l})}return Promise.all([...R.values()].map(q=>O(q))).then(q=>q.flat())},S={hasItem(v,E={}){v=dr(v);const{relativeKey:O,driver:R}=r(v);return zt(R.hasItem,O,E)},getItem(v,E={}){v=dr(v);const{relativeKey:O,driver:R}=r(v);return zt(R.getItem,O,E).then(z=>ga(z))},getItems(v,E){return b(v,E,O=>O.driver.getItems?zt(O.driver.getItems,O.items.map(R=>({key:R.relativeKey,options:R.options})),E).then(R=>R.map(z=>({key:B_(O.base,z.key),value:ga(z.value)}))):Promise.all(O.items.map(R=>zt(O.driver.getItem,R.relativeKey,R.options).then(z=>({key:R.key,value:ga(z)})))))},getItemRaw(v,E={}){v=dr(v);const{relativeKey:O,driver:R}=r(v);return R.getItemRaw?zt(R.getItemRaw,O,E):zt(R.getItem,O,E).then(z=>V_(z))},async setItem(v,E,O={}){if(E===void 0)return S.removeItem(v);v=dr(v);const{relativeKey:R,driver:z}=r(v);z.setItem&&(await zt(z.setItem,R,wa(E),O),z.watch||a("update",v))},async setItems(v,E){await b(v,E,async O=>{O.driver.setItems&&await zt(O.driver.setItems,O.items.map(R=>({key:R.relativeKey,value:wa(R.value),options:R.options})),E),O.driver.setItem&&await Promise.all(O.items.map(R=>zt(O.driver.setItem,R.relativeKey,wa(R.value),R.options)))})},async setItemRaw(v,E,O={}){if(E===void 0)return S.removeItem(v,O);v=dr(v);const{relativeKey:R,driver:z}=r(v);if(z.setItemRaw)await zt(z.setItemRaw,R,E,O);else if(z.setItem)await zt(z.setItem,R,k_(E),O);else return;z.watch||a("update",v)},async removeItem(v,E={}){typeof E=="boolean"&&(E={removeMeta:E}),v=dr(v);const{relativeKey:O,driver:R}=r(v);R.removeItem&&(await zt(R.removeItem,O,E),(E.removeMeta||E.removeMata)&&await zt(R.removeItem,O+"$",E),R.watch||a("remove",v))},async getMeta(v,E={}){typeof E=="boolean"&&(E={nativeOnly:E}),v=dr(v);const{relativeKey:O,driver:R}=r(v),z=Object.create(null);if(R.getMeta&&Object.assign(z,await zt(R.getMeta,O,E)),!E.nativeOnly){const q=await zt(R.getItem,O+"$",E).then(W=>ga(W));q&&typeof q=="object"&&(typeof q.atime=="string"&&(q.atime=new Date(q.atime)),typeof q.mtime=="string"&&(q.mtime=new Date(q.mtime)),Object.assign(z,q))}return z},setMeta(v,E,O={}){return this.setItem(v+"$",E,O)},removeMeta(v,E={}){return this.removeItem(v+"$",E)},async getKeys(v,E={}){v=ya(v);const O=s(v,!0);let R=[];const z=[];for(const q of O){const ie=(await zt(q.driver.getKeys,q.relativeBase,E)).map(ce=>q.mountpoint+dr(ce)).filter(ce=>!R.some(l=>ce.startsWith(l)));z.push(...ie),R=[q.mountpoint,...R.filter(ce=>!ce.startsWith(q.mountpoint))]}return v?z.filter(q=>q.startsWith(v)&&!q.endsWith("$")):z.filter(q=>!q.endsWith("$"))},async clear(v,E={}){v=ya(v),await Promise.all(s(v,!1).map(async O=>{if(O.driver.clear)return zt(O.driver.clear,O.relativeBase,E);if(O.driver.removeItem){const R=await O.driver.getKeys(O.relativeBase||"",E);return Promise.all(R.map(z=>O.driver.removeItem(z,E)))}}))},async dispose(){await Promise.all(Object.values(t.mounts).map(v=>xh(v)))},async watch(v){return await c(),t.watchListeners.push(v),async()=>{t.watchListeners=t.watchListeners.filter(E=>E!==v),t.watchListeners.length===0&&await f()}},async unwatch(){t.watchListeners=[],await f()},mount(v,E){if(v=ya(v),v&&t.mounts[v])throw new Error(`already mounted at ${v}`);return v&&(t.mountpoints.push(v),t.mountpoints.sort((O,R)=>R.length-O.length)),t.mounts[v]=E,t.watching&&Promise.resolve(Sh(E,a,v)).then(O=>{t.unwatch[v]=O}).catch(console.error),S},async unmount(v,E=!0){v=ya(v),!(!v||!t.mounts[v])&&(t.watching&&v in t.unwatch&&(t.unwatch[v](),delete t.unwatch[v]),E&&await xh(t.mounts[v]),t.mountpoints=t.mountpoints.filter(O=>O!==v),delete t.mounts[v])},getMount(v=""){v=dr(v)+":";const E=r(v);return{driver:E.driver,base:E.base}},getMounts(v="",E={}){return v=dr(v),s(v,E.parents).map(R=>({driver:R.driver,base:R.mountpoint}))}};return S}function Sh(n,t,r){return n.watch?n.watch((s,a)=>t(s,r+a)):()=>{}}async function xh(n){typeof n.dispose=="function"&&await zt(n.dispose)}function Bi(n){return new Promise((t,r)=>{n.oncomplete=n.onsuccess=()=>t(n.result),n.onabort=n.onerror=()=>r(n.error)})}function Kf(n,t){const r=indexedDB.open(n);r.onupgradeneeded=()=>r.result.createObjectStore(t);const s=Bi(r);return(a,c)=>s.then(f=>c(f.transaction(t,a).objectStore(t)))}let vc;function os(){return vc||(vc=Kf("keyval-store","keyval")),vc}function Ph(n,t=os()){return t("readonly",r=>Bi(r.get(n)))}function J_(n,t,r=os()){return r("readwrite",s=>(s.put(t,n),Bi(s.transaction)))}function Y_(n,t=os()){return t("readwrite",r=>(r.delete(n),Bi(r.transaction)))}function Z_(n=os()){return n("readwrite",t=>(t.clear(),Bi(t.transaction)))}function X_(n,t){return n.openCursor().onsuccess=function(){this.result&&(t(this.result),this.result.continue())},Bi(n.transaction)}function eb(n=os()){return n("readonly",t=>{if(t.getAllKeys)return Bi(t.getAllKeys());const r=[];return X_(t,s=>r.push(s.key)).then(()=>r)})}const tb="idb-keyval";var rb=(n={})=>{const t=n.base&&n.base.length>0?`${n.base}:`:"",r=a=>t+a;let s;return n.dbName&&n.storeName&&(s=Kf(n.dbName,n.storeName)),{name:tb,options:n,async hasItem(a){return!(typeof await Ph(r(a),s)>"u")},async getItem(a){return await Ph(r(a),s)??null},setItem(a,c){return J_(r(a),c,s)},removeItem(a){return Y_(r(a),s)},getKeys(){return eb(s)},clear(){return Z_(s)}}};const ib="WALLET_CONNECT_V2_INDEXED_DB",nb="keyvaluestorage";let sb=class{constructor(){this.indexedDb=Q_({driver:rb({dbName:ib,storeName:nb})})}async getKeys(){return this.indexedDb.getKeys()}async getEntries(){return(await this.indexedDb.getItems(await this.indexedDb.getKeys())).map(t=>[t.key,t.value])}async getItem(t){const r=await this.indexedDb.getItem(t);if(r!==null)return r}async setItem(t,r){await this.indexedDb.setItem(t,as(r))}async removeItem(t){await this.indexedDb.removeItem(t)}};var _c=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Ea={exports:{}};(function(){let n;function t(){}n=t,n.prototype.getItem=function(r){return this.hasOwnProperty(r)?String(this[r]):null},n.prototype.setItem=function(r,s){this[r]=String(s)},n.prototype.removeItem=function(r){delete this[r]},n.prototype.clear=function(){const r=this;Object.keys(r).forEach(function(s){r[s]=void 0,delete r[s]})},n.prototype.key=function(r){return r=r||0,Object.keys(this)[r]},n.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof _c<"u"&&_c.localStorage?Ea.exports=_c.localStorage:typeof window<"u"&&window.localStorage?Ea.exports=window.localStorage:Ea.exports=new t})();function ab(n){var t;return[n[0],Ma((t=n[1])!=null?t:"")]}let ob=class{constructor(){this.localStorage=Ea.exports}async getKeys(){return Object.keys(this.localStorage)}async getEntries(){return Object.entries(this.localStorage).map(ab)}async getItem(t){const r=this.localStorage.getItem(t);if(r!==null)return Ma(r)}async setItem(t,r){this.localStorage.setItem(t,as(r))}async removeItem(t){this.localStorage.removeItem(t)}};const cb="wc_storage_version",Oh=1,ub=async(n,t,r)=>{const s=cb,a=await t.getItem(s);if(a&&a>=Oh){r(t);return}const c=await n.getKeys();if(!c.length){r(t);return}const f=[];for(;c.length;){const b=c.shift();if(!b)continue;const S=b.toLowerCase();if(S.includes("wc@")||S.includes("walletconnect")||S.includes("wc_")||S.includes("wallet_connect")){const v=await n.getItem(b);await t.setItem(b,v),f.push(b)}}await t.setItem(s,Oh),r(t),lb(n,f)},lb=async(n,t)=>{t.length&&t.forEach(async r=>{await n.removeItem(r)})};let hb=class{constructor(){this.initialized=!1,this.setInitialized=r=>{this.storage=r,this.initialized=!0};const t=new ob;this.storage=t;try{const r=new sb;ub(t,r,this.setInitialized)}catch{this.initialized=!0}}async getKeys(){return await this.initialize(),this.storage.getKeys()}async getEntries(){return await this.initialize(),this.storage.getEntries()}async getItem(t){return await this.initialize(),this.storage.getItem(t)}async setItem(t,r){return await this.initialize(),this.storage.setItem(t,r)}async removeItem(t){return await this.initialize(),this.storage.removeItem(t)}async initialize(){this.initialized||await new Promise(t=>{const r=setInterval(()=>{this.initialized&&(clearInterval(r),t())},20)})}};var _n={};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var Fc=function(n,t){return Fc=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,s){r.__proto__=s}||function(r,s){for(var a in s)s.hasOwnProperty(a)&&(r[a]=s[a])},Fc(n,t)};function fb(n,t){Fc(n,t);function r(){this.constructor=n}n.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}var Hc=function(){return Hc=Object.assign||function(t){for(var r,s=1,a=arguments.length;s<a;s++){r=arguments[s];for(var c in r)Object.prototype.hasOwnProperty.call(r,c)&&(t[c]=r[c])}return t},Hc.apply(this,arguments)};function db(n,t){var r={};for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&t.indexOf(s)<0&&(r[s]=n[s]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,s=Object.getOwnPropertySymbols(n);a<s.length;a++)t.indexOf(s[a])<0&&Object.prototype.propertyIsEnumerable.call(n,s[a])&&(r[s[a]]=n[s[a]]);return r}function pb(n,t,r,s){var a=arguments.length,c=a<3?t:s===null?s=Object.getOwnPropertyDescriptor(t,r):s,f;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(n,t,r,s);else for(var b=n.length-1;b>=0;b--)(f=n[b])&&(c=(a<3?f(c):a>3?f(t,r,c):f(t,r))||c);return a>3&&c&&Object.defineProperty(t,r,c),c}function gb(n,t){return function(r,s){t(r,s,n)}}function yb(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)}function mb(n,t,r,s){function a(c){return c instanceof r?c:new r(function(f){f(c)})}return new(r||(r=Promise))(function(c,f){function b(E){try{v(s.next(E))}catch(O){f(O)}}function S(E){try{v(s.throw(E))}catch(O){f(O)}}function v(E){E.done?c(E.value):a(E.value).then(b,S)}v((s=s.apply(n,t||[])).next())})}function vb(n,t){var r={label:0,sent:function(){if(c[0]&1)throw c[1];return c[1]},trys:[],ops:[]},s,a,c,f;return f={next:b(0),throw:b(1),return:b(2)},typeof Symbol=="function"&&(f[Symbol.iterator]=function(){return this}),f;function b(v){return function(E){return S([v,E])}}function S(v){if(s)throw new TypeError("Generator is already executing.");for(;r;)try{if(s=1,a&&(c=v[0]&2?a.return:v[0]?a.throw||((c=a.return)&&c.call(a),0):a.next)&&!(c=c.call(a,v[1])).done)return c;switch(a=0,c&&(v=[v[0]&2,c.value]),v[0]){case 0:case 1:c=v;break;case 4:return r.label++,{value:v[1],done:!1};case 5:r.label++,a=v[1],v=[0];continue;case 7:v=r.ops.pop(),r.trys.pop();continue;default:if(c=r.trys,!(c=c.length>0&&c[c.length-1])&&(v[0]===6||v[0]===2)){r=0;continue}if(v[0]===3&&(!c||v[1]>c[0]&&v[1]<c[3])){r.label=v[1];break}if(v[0]===6&&r.label<c[1]){r.label=c[1],c=v;break}if(c&&r.label<c[2]){r.label=c[2],r.ops.push(v);break}c[2]&&r.ops.pop(),r.trys.pop();continue}v=t.call(n,r)}catch(E){v=[6,E],a=0}finally{s=c=0}if(v[0]&5)throw v[1];return{value:v[0]?v[1]:void 0,done:!0}}}function _b(n,t,r,s){s===void 0&&(s=r),n[s]=t[r]}function bb(n,t){for(var r in n)r!=="default"&&!t.hasOwnProperty(r)&&(t[r]=n[r])}function Kc(n){var t=typeof Symbol=="function"&&Symbol.iterator,r=t&&n[t],s=0;if(r)return r.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&s>=n.length&&(n=void 0),{value:n&&n[s++],done:!n}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function kf(n,t){var r=typeof Symbol=="function"&&n[Symbol.iterator];if(!r)return n;var s=r.call(n),a,c=[],f;try{for(;(t===void 0||t-- >0)&&!(a=s.next()).done;)c.push(a.value)}catch(b){f={error:b}}finally{try{a&&!a.done&&(r=s.return)&&r.call(s)}finally{if(f)throw f.error}}return c}function wb(){for(var n=[],t=0;t<arguments.length;t++)n=n.concat(kf(arguments[t]));return n}function Eb(){for(var n=0,t=0,r=arguments.length;t<r;t++)n+=arguments[t].length;for(var s=Array(n),a=0,t=0;t<r;t++)for(var c=arguments[t],f=0,b=c.length;f<b;f++,a++)s[a]=c[f];return s}function rs(n){return this instanceof rs?(this.v=n,this):new rs(n)}function Ib(n,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var s=r.apply(n,t||[]),a,c=[];return a={},f("next"),f("throw"),f("return"),a[Symbol.asyncIterator]=function(){return this},a;function f(R){s[R]&&(a[R]=function(z){return new Promise(function(q,W){c.push([R,z,q,W])>1||b(R,z)})})}function b(R,z){try{S(s[R](z))}catch(q){O(c[0][3],q)}}function S(R){R.value instanceof rs?Promise.resolve(R.value.v).then(v,E):O(c[0][2],R)}function v(R){b("next",R)}function E(R){b("throw",R)}function O(R,z){R(z),c.shift(),c.length&&b(c[0][0],c[0][1])}}function Sb(n){var t,r;return t={},s("next"),s("throw",function(a){throw a}),s("return"),t[Symbol.iterator]=function(){return this},t;function s(a,c){t[a]=n[a]?function(f){return(r=!r)?{value:rs(n[a](f)),done:a==="return"}:c?c(f):f}:c}}function xb(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=n[Symbol.asyncIterator],r;return t?t.call(n):(n=typeof Kc=="function"?Kc(n):n[Symbol.iterator](),r={},s("next"),s("throw"),s("return"),r[Symbol.asyncIterator]=function(){return this},r);function s(c){r[c]=n[c]&&function(f){return new Promise(function(b,S){f=n[c](f),a(b,S,f.done,f.value)})}}function a(c,f,b,S){Promise.resolve(S).then(function(v){c({value:v,done:b})},f)}}function Pb(n,t){return Object.defineProperty?Object.defineProperty(n,"raw",{value:t}):n.raw=t,n}function Ob(n){if(n&&n.__esModule)return n;var t={};if(n!=null)for(var r in n)Object.hasOwnProperty.call(n,r)&&(t[r]=n[r]);return t.default=n,t}function Nb(n){return n&&n.__esModule?n:{default:n}}function Tb(n,t){if(!t.has(n))throw new TypeError("attempted to get private field on non-instance");return t.get(n)}function Ab(n,t,r){if(!t.has(n))throw new TypeError("attempted to set private field on non-instance");return t.set(n,r),r}const Rb=Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return Hc},__asyncDelegator:Sb,__asyncGenerator:Ib,__asyncValues:xb,__await:rs,__awaiter:mb,__classPrivateFieldGet:Tb,__classPrivateFieldSet:Ab,__createBinding:_b,__decorate:pb,__exportStar:bb,__extends:fb,__generator:vb,__importDefault:Nb,__importStar:Ob,__makeTemplateObject:Pb,__metadata:yb,__param:gb,__read:kf,__rest:db,__spread:wb,__spreadArrays:Eb,__values:Kc},Symbol.toStringTag,{value:"Module"})),za=nu(Rb);var Hn={},bc={},Kn={};class Gi{}const Cb=Object.freeze(Object.defineProperty({__proto__:null,IEvents:Gi},Symbol.toStringTag,{value:"Module"})),$b=nu(Cb);var Nh;function Db(){if(Nh)return Kn;Nh=1,Object.defineProperty(Kn,"__esModule",{value:!0}),Kn.IHeartBeat=void 0;const n=$b;class t extends n.IEvents{constructor(s){super()}}return Kn.IHeartBeat=t,Kn}var Th;function Vf(){return Th||(Th=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),za.__exportStar(Db(),n)}(bc)),bc}var wc={},Hi={},Ah;function Ub(){if(Ah)return Hi;Ah=1,Object.defineProperty(Hi,"__esModule",{value:!0}),Hi.HEARTBEAT_EVENTS=Hi.HEARTBEAT_INTERVAL=void 0;const n=ne;return Hi.HEARTBEAT_INTERVAL=n.FIVE_SECONDS,Hi.HEARTBEAT_EVENTS={pulse:"heartbeat_pulse"},Hi}var Rh;function Bf(){return Rh||(Rh=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),za.__exportStar(Ub(),n)}(wc)),wc}var Ch;function jb(){if(Ch)return Hn;Ch=1,Object.defineProperty(Hn,"__esModule",{value:!0}),Hn.HeartBeat=void 0;const n=za,t=Qr,r=ne,s=Vf(),a=Bf();class c extends s.IHeartBeat{constructor(b){super(b),this.events=new t.EventEmitter,this.interval=a.HEARTBEAT_INTERVAL,this.interval=(b==null?void 0:b.interval)||a.HEARTBEAT_INTERVAL}static init(b){return n.__awaiter(this,void 0,void 0,function*(){const S=new c(b);return yield S.init(),S})}init(){return n.__awaiter(this,void 0,void 0,function*(){yield this.initialize()})}stop(){clearInterval(this.intervalRef)}on(b,S){this.events.on(b,S)}once(b,S){this.events.once(b,S)}off(b,S){this.events.off(b,S)}removeListener(b,S){this.events.removeListener(b,S)}initialize(){return n.__awaiter(this,void 0,void 0,function*(){this.intervalRef=setInterval(()=>this.pulse(),r.toMiliseconds(this.interval))})}pulse(){this.events.emit(a.HEARTBEAT_EVENTS.pulse)}}return Hn.HeartBeat=c,Hn}(function(n){Object.defineProperty(n,"__esModule",{value:!0});const t=za;t.__exportStar(jb(),n),t.__exportStar(Vf(),n),t.__exportStar(Bf(),n)})(_n);var Ne={};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var kc=function(n,t){return kc=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,s){r.__proto__=s}||function(r,s){for(var a in s)s.hasOwnProperty(a)&&(r[a]=s[a])},kc(n,t)};function Lb(n,t){kc(n,t);function r(){this.constructor=n}n.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}var Vc=function(){return Vc=Object.assign||function(t){for(var r,s=1,a=arguments.length;s<a;s++){r=arguments[s];for(var c in r)Object.prototype.hasOwnProperty.call(r,c)&&(t[c]=r[c])}return t},Vc.apply(this,arguments)};function qb(n,t){var r={};for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&t.indexOf(s)<0&&(r[s]=n[s]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,s=Object.getOwnPropertySymbols(n);a<s.length;a++)t.indexOf(s[a])<0&&Object.prototype.propertyIsEnumerable.call(n,s[a])&&(r[s[a]]=n[s[a]]);return r}function Mb(n,t,r,s){var a=arguments.length,c=a<3?t:s===null?s=Object.getOwnPropertyDescriptor(t,r):s,f;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(n,t,r,s);else for(var b=n.length-1;b>=0;b--)(f=n[b])&&(c=(a<3?f(c):a>3?f(t,r,c):f(t,r))||c);return a>3&&c&&Object.defineProperty(t,r,c),c}function zb(n,t){return function(r,s){t(r,s,n)}}function Fb(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)}function Hb(n,t,r,s){function a(c){return c instanceof r?c:new r(function(f){f(c)})}return new(r||(r=Promise))(function(c,f){function b(E){try{v(s.next(E))}catch(O){f(O)}}function S(E){try{v(s.throw(E))}catch(O){f(O)}}function v(E){E.done?c(E.value):a(E.value).then(b,S)}v((s=s.apply(n,t||[])).next())})}function Kb(n,t){var r={label:0,sent:function(){if(c[0]&1)throw c[1];return c[1]},trys:[],ops:[]},s,a,c,f;return f={next:b(0),throw:b(1),return:b(2)},typeof Symbol=="function"&&(f[Symbol.iterator]=function(){return this}),f;function b(v){return function(E){return S([v,E])}}function S(v){if(s)throw new TypeError("Generator is already executing.");for(;r;)try{if(s=1,a&&(c=v[0]&2?a.return:v[0]?a.throw||((c=a.return)&&c.call(a),0):a.next)&&!(c=c.call(a,v[1])).done)return c;switch(a=0,c&&(v=[v[0]&2,c.value]),v[0]){case 0:case 1:c=v;break;case 4:return r.label++,{value:v[1],done:!1};case 5:r.label++,a=v[1],v=[0];continue;case 7:v=r.ops.pop(),r.trys.pop();continue;default:if(c=r.trys,!(c=c.length>0&&c[c.length-1])&&(v[0]===6||v[0]===2)){r=0;continue}if(v[0]===3&&(!c||v[1]>c[0]&&v[1]<c[3])){r.label=v[1];break}if(v[0]===6&&r.label<c[1]){r.label=c[1],c=v;break}if(c&&r.label<c[2]){r.label=c[2],r.ops.push(v);break}c[2]&&r.ops.pop(),r.trys.pop();continue}v=t.call(n,r)}catch(E){v=[6,E],a=0}finally{s=c=0}if(v[0]&5)throw v[1];return{value:v[0]?v[1]:void 0,done:!0}}}function kb(n,t,r,s){s===void 0&&(s=r),n[s]=t[r]}function Vb(n,t){for(var r in n)r!=="default"&&!t.hasOwnProperty(r)&&(t[r]=n[r])}function Bc(n){var t=typeof Symbol=="function"&&Symbol.iterator,r=t&&n[t],s=0;if(r)return r.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&s>=n.length&&(n=void 0),{value:n&&n[s++],done:!n}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function Gf(n,t){var r=typeof Symbol=="function"&&n[Symbol.iterator];if(!r)return n;var s=r.call(n),a,c=[],f;try{for(;(t===void 0||t-- >0)&&!(a=s.next()).done;)c.push(a.value)}catch(b){f={error:b}}finally{try{a&&!a.done&&(r=s.return)&&r.call(s)}finally{if(f)throw f.error}}return c}function Bb(){for(var n=[],t=0;t<arguments.length;t++)n=n.concat(Gf(arguments[t]));return n}function Gb(){for(var n=0,t=0,r=arguments.length;t<r;t++)n+=arguments[t].length;for(var s=Array(n),a=0,t=0;t<r;t++)for(var c=arguments[t],f=0,b=c.length;f<b;f++,a++)s[a]=c[f];return s}function is(n){return this instanceof is?(this.v=n,this):new is(n)}function Wb(n,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var s=r.apply(n,t||[]),a,c=[];return a={},f("next"),f("throw"),f("return"),a[Symbol.asyncIterator]=function(){return this},a;function f(R){s[R]&&(a[R]=function(z){return new Promise(function(q,W){c.push([R,z,q,W])>1||b(R,z)})})}function b(R,z){try{S(s[R](z))}catch(q){O(c[0][3],q)}}function S(R){R.value instanceof is?Promise.resolve(R.value.v).then(v,E):O(c[0][2],R)}function v(R){b("next",R)}function E(R){b("throw",R)}function O(R,z){R(z),c.shift(),c.length&&b(c[0][0],c[0][1])}}function Qb(n){var t,r;return t={},s("next"),s("throw",function(a){throw a}),s("return"),t[Symbol.iterator]=function(){return this},t;function s(a,c){t[a]=n[a]?function(f){return(r=!r)?{value:is(n[a](f)),done:a==="return"}:c?c(f):f}:c}}function Jb(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=n[Symbol.asyncIterator],r;return t?t.call(n):(n=typeof Bc=="function"?Bc(n):n[Symbol.iterator](),r={},s("next"),s("throw"),s("return"),r[Symbol.asyncIterator]=function(){return this},r);function s(c){r[c]=n[c]&&function(f){return new Promise(function(b,S){f=n[c](f),a(b,S,f.done,f.value)})}}function a(c,f,b,S){Promise.resolve(S).then(function(v){c({value:v,done:b})},f)}}function Yb(n,t){return Object.defineProperty?Object.defineProperty(n,"raw",{value:t}):n.raw=t,n}function Zb(n){if(n&&n.__esModule)return n;var t={};if(n!=null)for(var r in n)Object.hasOwnProperty.call(n,r)&&(t[r]=n[r]);return t.default=n,t}function Xb(n){return n&&n.__esModule?n:{default:n}}function ew(n,t){if(!t.has(n))throw new TypeError("attempted to get private field on non-instance");return t.get(n)}function tw(n,t,r){if(!t.has(n))throw new TypeError("attempted to set private field on non-instance");return t.set(n,r),r}const rw=Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return Vc},__asyncDelegator:Qb,__asyncGenerator:Wb,__asyncValues:Jb,__await:is,__awaiter:Hb,__classPrivateFieldGet:ew,__classPrivateFieldSet:tw,__createBinding:kb,__decorate:Mb,__exportStar:Vb,__extends:Lb,__generator:Kb,__importDefault:Xb,__importStar:Zb,__makeTemplateObject:Yb,__metadata:Fb,__param:zb,__read:Gf,__rest:qb,__spread:Bb,__spreadArrays:Gb,__values:Bc},Symbol.toStringTag,{value:"Module"})),iw=nu(rw);var Ec,$h;function nw(){if($h)return Ec;$h=1;function n(r){try{return JSON.stringify(r)}catch{return'"[Circular]"'}}Ec=t;function t(r,s,a){var c=a&&a.stringify||n,f=1;if(typeof r=="object"&&r!==null){var b=s.length+f;if(b===1)return r;var S=new Array(b);S[0]=c(r);for(var v=1;v<b;v++)S[v]=c(s[v]);return S.join(" ")}if(typeof r!="string")return r;var E=s.length;if(E===0)return r;for(var O="",R=1-f,z=-1,q=r&&r.length||0,W=0;W<q;){if(r.charCodeAt(W)===37&&W+1<q){switch(z=z>-1?z:0,r.charCodeAt(W+1)){case 100:case 102:if(R>=E||s[R]==null)break;z<W&&(O+=r.slice(z,W)),O+=Number(s[R]),z=W+2,W++;break;case 105:if(R>=E||s[R]==null)break;z<W&&(O+=r.slice(z,W)),O+=Math.floor(Number(s[R])),z=W+2,W++;break;case 79:case 111:case 106:if(R>=E||s[R]===void 0)break;z<W&&(O+=r.slice(z,W));var ie=typeof s[R];if(ie==="string"){O+="'"+s[R]+"'",z=W+2,W++;break}if(ie==="function"){O+=s[R].name||"<anonymous>",z=W+2,W++;break}O+=c(s[R]),z=W+2,W++;break;case 115:if(R>=E)break;z<W&&(O+=r.slice(z,W)),O+=String(s[R]),z=W+2,W++;break;case 37:z<W&&(O+=r.slice(z,W)),O+="%",z=W+2,W++,R--;break}++R}++W}return z===-1?r:(z<q&&(O+=r.slice(z)),O)}return Ec}var Ic,Dh;function sw(){if(Dh)return Ic;Dh=1;const n=nw();Ic=a;const t=y().console||{},r={mapHttpRequest:q,mapHttpResponse:q,wrapRequestSerializer:W,wrapResponseSerializer:W,wrapErrorSerializer:W,req:q,res:q,err:R};function s(g,N){return Array.isArray(g)?g.filter(function(Q){return Q!=="!stdSerializers.err"}):g===!0?Object.keys(N):!1}function a(g){g=g||{},g.browser=g.browser||{};const N=g.browser.transmit;if(N&&typeof N.send!="function")throw Error("pino: transmit option must have a send function");const P=g.browser.write||t;g.browser.write&&(g.browser.asObject=!0);const Q=g.serializers||{},se=s(g.browser.serialize,Q);let Ee=g.browser.serialize;Array.isArray(g.browser.serialize)&&g.browser.serialize.indexOf("!stdSerializers.err")>-1&&(Ee=!1);const Te=["error","fatal","warn","info","debug","trace"];typeof P=="function"&&(P.error=P.fatal=P.warn=P.info=P.debug=P.trace=P),g.enabled===!1&&(g.level="silent");const tt=g.level||"info",L=Object.create(P);L.log||(L.log=ie),Object.defineProperty(L,"levelVal",{get:Me}),Object.defineProperty(L,"level",{get:Ae,set:ee});const V={transmit:N,serialize:se,asObject:g.browser.asObject,levels:Te,timestamp:z(g)};L.levels=a.levels,L.level=tt,L.setMaxListeners=L.getMaxListeners=L.emit=L.addListener=L.on=L.prependListener=L.once=L.prependOnceListener=L.removeListener=L.removeAllListeners=L.listeners=L.listenerCount=L.eventNames=L.write=L.flush=ie,L.serializers=Q,L._serialize=se,L._stdErrSerialize=Ee,L.child=Y,N&&(L._logEvent=O());function Me(){return this.level==="silent"?1/0:this.levels.values[this.level]}function Ae(){return this._level}function ee(J){if(J!=="silent"&&!this.levels.values[J])throw Error("unknown level "+J);this._level=J,c(V,L,"error","log"),c(V,L,"fatal","error"),c(V,L,"warn","error"),c(V,L,"info","log"),c(V,L,"debug","log"),c(V,L,"trace","log")}function Y(J,Z){if(!J)throw new Error("missing bindings for child Pino");Z=Z||{},se&&J.serializers&&(Z.serializers=J.serializers);const lt=Z.serializers;if(se&&lt){var Ke=Object.assign({},Q,lt),Fr=g.browser.serialize===!0?Object.keys(Ke):se;delete J.serializers,S([J],Fr,Ke,this._stdErrSerialize)}function be(St){this._childLevel=(St._childLevel|0)+1,this.error=v(St,J,"error"),this.fatal=v(St,J,"fatal"),this.warn=v(St,J,"warn"),this.info=v(St,J,"info"),this.debug=v(St,J,"debug"),this.trace=v(St,J,"trace"),Ke&&(this.serializers=Ke,this._serialize=Fr),N&&(this._logEvent=O([].concat(St._logEvent.bindings,J)))}return be.prototype=this,new be(this)}return L}a.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}},a.stdSerializers=r,a.stdTimeFunctions=Object.assign({},{nullTime:ce,epochTime:l,unixTime:p,isoTime:m});function c(g,N,P,Q){const se=Object.getPrototypeOf(N);N[P]=N.levelVal>N.levels.values[P]?ie:se[P]?se[P]:t[P]||t[Q]||ie,f(g,N,P)}function f(g,N,P){!g.transmit&&N[P]===ie||(N[P]=function(Q){return function(){const Ee=g.timestamp(),Te=new Array(arguments.length),tt=Object.getPrototypeOf&&Object.getPrototypeOf(this)===t?t:this;for(var L=0;L<Te.length;L++)Te[L]=arguments[L];if(g.serialize&&!g.asObject&&S(Te,this._serialize,this.serializers,this._stdErrSerialize),g.asObject?Q.call(tt,b(this,P,Te,Ee)):Q.apply(tt,Te),g.transmit){const V=g.transmit.level||N.level,Me=a.levels.values[V],Ae=a.levels.values[P];if(Ae<Me)return;E(this,{ts:Ee,methodLevel:P,methodValue:Ae,transmitLevel:V,transmitValue:a.levels.values[g.transmit.level||N.level],send:g.transmit.send,val:N.levelVal},Te)}}}(N[P]))}function b(g,N,P,Q){g._serialize&&S(P,g._serialize,g.serializers,g._stdErrSerialize);const se=P.slice();let Ee=se[0];const Te={};Q&&(Te.time=Q),Te.level=a.levels.values[N];let tt=(g._childLevel|0)+1;if(tt<1&&(tt=1),Ee!==null&&typeof Ee=="object"){for(;tt--&&typeof se[0]=="object";)Object.assign(Te,se.shift());Ee=se.length?n(se.shift(),se):void 0}else typeof Ee=="string"&&(Ee=n(se.shift(),se));return Ee!==void 0&&(Te.msg=Ee),Te}function S(g,N,P,Q){for(const se in g)if(Q&&g[se]instanceof Error)g[se]=a.stdSerializers.err(g[se]);else if(typeof g[se]=="object"&&!Array.isArray(g[se]))for(const Ee in g[se])N&&N.indexOf(Ee)>-1&&Ee in P&&(g[se][Ee]=P[Ee](g[se][Ee]))}function v(g,N,P){return function(){const Q=new Array(1+arguments.length);Q[0]=N;for(var se=1;se<Q.length;se++)Q[se]=arguments[se-1];return g[P].apply(this,Q)}}function E(g,N,P){const Q=N.send,se=N.ts,Ee=N.methodLevel,Te=N.methodValue,tt=N.val,L=g._logEvent.bindings;S(P,g._serialize||Object.keys(g.serializers),g.serializers,g._stdErrSerialize===void 0?!0:g._stdErrSerialize),g._logEvent.ts=se,g._logEvent.messages=P.filter(function(V){return L.indexOf(V)===-1}),g._logEvent.level.label=Ee,g._logEvent.level.value=Te,Q(Ee,g._logEvent,tt),g._logEvent=O(L)}function O(g){return{ts:0,messages:[],bindings:g||[],level:{label:"",value:0}}}function R(g){const N={type:g.constructor.name,msg:g.message,stack:g.stack};for(const P in g)N[P]===void 0&&(N[P]=g[P]);return N}function z(g){return typeof g.timestamp=="function"?g.timestamp:g.timestamp===!1?ce:l}function q(){return{}}function W(g){return g}function ie(){}function ce(){return!1}function l(){return Date.now()}function p(){return Math.round(Date.now()/1e3)}function m(){return new Date(Date.now()).toISOString()}function y(){function g(N){return typeof N<"u"&&N}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return g(self)||g(window)||g(this)||{}}}return Ic}var Ki={},Uh;function Wf(){return Uh||(Uh=1,Object.defineProperty(Ki,"__esModule",{value:!0}),Ki.PINO_CUSTOM_CONTEXT_KEY=Ki.PINO_LOGGER_DEFAULTS=void 0,Ki.PINO_LOGGER_DEFAULTS={level:"info"},Ki.PINO_CUSTOM_CONTEXT_KEY="custom_context"),Ki}var ir={},jh;function aw(){if(jh)return ir;jh=1,Object.defineProperty(ir,"__esModule",{value:!0}),ir.generateChildLogger=ir.formatChildLoggerContext=ir.getLoggerContext=ir.setBrowserLoggerContext=ir.getBrowserLoggerContext=ir.getDefaultLoggerOptions=void 0;const n=Wf();function t(b){return Object.assign(Object.assign({},b),{level:(b==null?void 0:b.level)||n.PINO_LOGGER_DEFAULTS.level})}ir.getDefaultLoggerOptions=t;function r(b,S=n.PINO_CUSTOM_CONTEXT_KEY){return b[S]||""}ir.getBrowserLoggerContext=r;function s(b,S,v=n.PINO_CUSTOM_CONTEXT_KEY){return b[v]=S,b}ir.setBrowserLoggerContext=s;function a(b,S=n.PINO_CUSTOM_CONTEXT_KEY){let v="";return typeof b.bindings>"u"?v=r(b,S):v=b.bindings().context||"",v}ir.getLoggerContext=a;function c(b,S,v=n.PINO_CUSTOM_CONTEXT_KEY){const E=a(b,v);return E.trim()?`${E}/${S}`:S}ir.formatChildLoggerContext=c;function f(b,S,v=n.PINO_CUSTOM_CONTEXT_KEY){const E=c(b,S,v),O=b.child({context:E});return s(O,E,v)}return ir.generateChildLogger=f,ir}(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.pino=void 0;const t=iw,r=t.__importDefault(sw());Object.defineProperty(n,"pino",{enumerable:!0,get:function(){return r.default}}),t.__exportStar(Wf(),n),t.__exportStar(aw(),n)})(Ne);class ow extends Gi{constructor(t){super(),this.opts=t,this.protocol="wc",this.version=2}}let cw=class extends Gi{constructor(t,r){super(),this.core=t,this.logger=r,this.records=new Map}},uw=class{constructor(t,r){this.logger=t,this.core=r}},lw=class extends Gi{constructor(t,r){super(),this.relayer=t,this.logger=r}},hw=class extends Gi{constructor(t){super()}},fw=class{constructor(t,r,s,a){this.core=t,this.logger=r,this.name=s}};class dw extends Gi{constructor(t,r){super(),this.relayer=t,this.logger=r}}let pw=class extends Gi{constructor(t,r){super(),this.core=t,this.logger=r}},gw=class{constructor(t,r){this.projectId=t,this.logger=r}},yw=class{constructor(t){this.opts=t,this.protocol="wc",this.version=2}},mw=class{constructor(t){this.client=t}};var hu={},Qf={};(function(n){Object.defineProperty(n,"__esModule",{value:!0});var t=__,r=Uf;n.DIGEST_LENGTH=64,n.BLOCK_SIZE=128;var s=function(){function b(){this.digestLength=n.DIGEST_LENGTH,this.blockSize=n.BLOCK_SIZE,this._stateHi=new Int32Array(8),this._stateLo=new Int32Array(8),this._tempHi=new Int32Array(16),this._tempLo=new Int32Array(16),this._buffer=new Uint8Array(256),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return b.prototype._initState=function(){this._stateHi[0]=1779033703,this._stateHi[1]=3144134277,this._stateHi[2]=1013904242,this._stateHi[3]=2773480762,this._stateHi[4]=1359893119,this._stateHi[5]=2600822924,this._stateHi[6]=528734635,this._stateHi[7]=1541459225,this._stateLo[0]=4089235720,this._stateLo[1]=2227873595,this._stateLo[2]=4271175723,this._stateLo[3]=1595750129,this._stateLo[4]=2917565137,this._stateLo[5]=725511199,this._stateLo[6]=4215389547,this._stateLo[7]=327033209},b.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},b.prototype.clean=function(){r.wipe(this._buffer),r.wipe(this._tempHi),r.wipe(this._tempLo),this.reset()},b.prototype.update=function(S,v){if(v===void 0&&(v=S.length),this._finished)throw new Error("SHA512: can't update because hash was finished.");var E=0;if(this._bytesHashed+=v,this._bufferLength>0){for(;this._bufferLength<n.BLOCK_SIZE&&v>0;)this._buffer[this._bufferLength++]=S[E++],v--;this._bufferLength===this.blockSize&&(c(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,this.blockSize),this._bufferLength=0)}for(v>=this.blockSize&&(E=c(this._tempHi,this._tempLo,this._stateHi,this._stateLo,S,E,v),v%=this.blockSize);v>0;)this._buffer[this._bufferLength++]=S[E++],v--;return this},b.prototype.finish=function(S){if(!this._finished){var v=this._bytesHashed,E=this._bufferLength,O=v/536870912|0,R=v<<3,z=v%128<112?128:256;this._buffer[E]=128;for(var q=E+1;q<z-8;q++)this._buffer[q]=0;t.writeUint32BE(O,this._buffer,z-8),t.writeUint32BE(R,this._buffer,z-4),c(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,z),this._finished=!0}for(var q=0;q<this.digestLength/8;q++)t.writeUint32BE(this._stateHi[q],S,q*8),t.writeUint32BE(this._stateLo[q],S,q*8+4);return this},b.prototype.digest=function(){var S=new Uint8Array(this.digestLength);return this.finish(S),S},b.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{stateHi:new Int32Array(this._stateHi),stateLo:new Int32Array(this._stateLo),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},b.prototype.restoreState=function(S){return this._stateHi.set(S.stateHi),this._stateLo.set(S.stateLo),this._bufferLength=S.bufferLength,S.buffer&&this._buffer.set(S.buffer),this._bytesHashed=S.bytesHashed,this._finished=!1,this},b.prototype.cleanSavedState=function(S){r.wipe(S.stateHi),r.wipe(S.stateLo),S.buffer&&r.wipe(S.buffer),S.bufferLength=0,S.bytesHashed=0},b}();n.SHA512=s;var a=new Int32Array([1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591]);function c(b,S,v,E,O,R,z){for(var q=v[0],W=v[1],ie=v[2],ce=v[3],l=v[4],p=v[5],m=v[6],y=v[7],g=E[0],N=E[1],P=E[2],Q=E[3],se=E[4],Ee=E[5],Te=E[6],tt=E[7],L,V,Me,Ae,ee,Y,J,Z;z>=128;){for(var lt=0;lt<16;lt++){var Ke=8*lt+R;b[lt]=t.readUint32BE(O,Ke),S[lt]=t.readUint32BE(O,Ke+4)}for(var lt=0;lt<80;lt++){var Fr=q,be=W,St=ie,F=ce,M=l,U=p,h=m,A=y,ae=g,de=N,ve=P,Re=Q,$e=se,Se=Ee,xt=Te,_t=tt;if(L=y,V=tt,ee=V&65535,Y=V>>>16,J=L&65535,Z=L>>>16,L=(l>>>14|se<<32-14)^(l>>>18|se<<32-18)^(se>>>41-32|l<<32-(41-32)),V=(se>>>14|l<<32-14)^(se>>>18|l<<32-18)^(l>>>41-32|se<<32-(41-32)),ee+=V&65535,Y+=V>>>16,J+=L&65535,Z+=L>>>16,L=l&p^~l&m,V=se&Ee^~se&Te,ee+=V&65535,Y+=V>>>16,J+=L&65535,Z+=L>>>16,L=a[lt*2],V=a[lt*2+1],ee+=V&65535,Y+=V>>>16,J+=L&65535,Z+=L>>>16,L=b[lt%16],V=S[lt%16],ee+=V&65535,Y+=V>>>16,J+=L&65535,Z+=L>>>16,Y+=ee>>>16,J+=Y>>>16,Z+=J>>>16,Me=J&65535|Z<<16,Ae=ee&65535|Y<<16,L=Me,V=Ae,ee=V&65535,Y=V>>>16,J=L&65535,Z=L>>>16,L=(q>>>28|g<<32-28)^(g>>>34-32|q<<32-(34-32))^(g>>>39-32|q<<32-(39-32)),V=(g>>>28|q<<32-28)^(q>>>34-32|g<<32-(34-32))^(q>>>39-32|g<<32-(39-32)),ee+=V&65535,Y+=V>>>16,J+=L&65535,Z+=L>>>16,L=q&W^q&ie^W&ie,V=g&N^g&P^N&P,ee+=V&65535,Y+=V>>>16,J+=L&65535,Z+=L>>>16,Y+=ee>>>16,J+=Y>>>16,Z+=J>>>16,A=J&65535|Z<<16,_t=ee&65535|Y<<16,L=F,V=Re,ee=V&65535,Y=V>>>16,J=L&65535,Z=L>>>16,L=Me,V=Ae,ee+=V&65535,Y+=V>>>16,J+=L&65535,Z+=L>>>16,Y+=ee>>>16,J+=Y>>>16,Z+=J>>>16,F=J&65535|Z<<16,Re=ee&65535|Y<<16,W=Fr,ie=be,ce=St,l=F,p=M,m=U,y=h,q=A,N=ae,P=de,Q=ve,se=Re,Ee=$e,Te=Se,tt=xt,g=_t,lt%16===15)for(var Ke=0;Ke<16;Ke++)L=b[Ke],V=S[Ke],ee=V&65535,Y=V>>>16,J=L&65535,Z=L>>>16,L=b[(Ke+9)%16],V=S[(Ke+9)%16],ee+=V&65535,Y+=V>>>16,J+=L&65535,Z+=L>>>16,Me=b[(Ke+1)%16],Ae=S[(Ke+1)%16],L=(Me>>>1|Ae<<32-1)^(Me>>>8|Ae<<32-8)^Me>>>7,V=(Ae>>>1|Me<<32-1)^(Ae>>>8|Me<<32-8)^(Ae>>>7|Me<<32-7),ee+=V&65535,Y+=V>>>16,J+=L&65535,Z+=L>>>16,Me=b[(Ke+14)%16],Ae=S[(Ke+14)%16],L=(Me>>>19|Ae<<32-19)^(Ae>>>61-32|Me<<32-(61-32))^Me>>>6,V=(Ae>>>19|Me<<32-19)^(Me>>>61-32|Ae<<32-(61-32))^(Ae>>>6|Me<<32-6),ee+=V&65535,Y+=V>>>16,J+=L&65535,Z+=L>>>16,Y+=ee>>>16,J+=Y>>>16,Z+=J>>>16,b[Ke]=J&65535|Z<<16,S[Ke]=ee&65535|Y<<16}L=q,V=g,ee=V&65535,Y=V>>>16,J=L&65535,Z=L>>>16,L=v[0],V=E[0],ee+=V&65535,Y+=V>>>16,J+=L&65535,Z+=L>>>16,Y+=ee>>>16,J+=Y>>>16,Z+=J>>>16,v[0]=q=J&65535|Z<<16,E[0]=g=ee&65535|Y<<16,L=W,V=N,ee=V&65535,Y=V>>>16,J=L&65535,Z=L>>>16,L=v[1],V=E[1],ee+=V&65535,Y+=V>>>16,J+=L&65535,Z+=L>>>16,Y+=ee>>>16,J+=Y>>>16,Z+=J>>>16,v[1]=W=J&65535|Z<<16,E[1]=N=ee&65535|Y<<16,L=ie,V=P,ee=V&65535,Y=V>>>16,J=L&65535,Z=L>>>16,L=v[2],V=E[2],ee+=V&65535,Y+=V>>>16,J+=L&65535,Z+=L>>>16,Y+=ee>>>16,J+=Y>>>16,Z+=J>>>16,v[2]=ie=J&65535|Z<<16,E[2]=P=ee&65535|Y<<16,L=ce,V=Q,ee=V&65535,Y=V>>>16,J=L&65535,Z=L>>>16,L=v[3],V=E[3],ee+=V&65535,Y+=V>>>16,J+=L&65535,Z+=L>>>16,Y+=ee>>>16,J+=Y>>>16,Z+=J>>>16,v[3]=ce=J&65535|Z<<16,E[3]=Q=ee&65535|Y<<16,L=l,V=se,ee=V&65535,Y=V>>>16,J=L&65535,Z=L>>>16,L=v[4],V=E[4],ee+=V&65535,Y+=V>>>16,J+=L&65535,Z+=L>>>16,Y+=ee>>>16,J+=Y>>>16,Z+=J>>>16,v[4]=l=J&65535|Z<<16,E[4]=se=ee&65535|Y<<16,L=p,V=Ee,ee=V&65535,Y=V>>>16,J=L&65535,Z=L>>>16,L=v[5],V=E[5],ee+=V&65535,Y+=V>>>16,J+=L&65535,Z+=L>>>16,Y+=ee>>>16,J+=Y>>>16,Z+=J>>>16,v[5]=p=J&65535|Z<<16,E[5]=Ee=ee&65535|Y<<16,L=m,V=Te,ee=V&65535,Y=V>>>16,J=L&65535,Z=L>>>16,L=v[6],V=E[6],ee+=V&65535,Y+=V>>>16,J+=L&65535,Z+=L>>>16,Y+=ee>>>16,J+=Y>>>16,Z+=J>>>16,v[6]=m=J&65535|Z<<16,E[6]=Te=ee&65535|Y<<16,L=y,V=tt,ee=V&65535,Y=V>>>16,J=L&65535,Z=L>>>16,L=v[7],V=E[7],ee+=V&65535,Y+=V>>>16,J+=L&65535,Z+=L>>>16,Y+=ee>>>16,J+=Y>>>16,Z+=J>>>16,v[7]=y=J&65535|Z<<16,E[7]=tt=ee&65535|Y<<16,R+=128,z-=128}return R}function f(b){var S=new s;S.update(b);var v=S.digest();return S.clean(),v}n.hash=f})(Qf);(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.convertSecretKeyToX25519=n.convertPublicKeyToX25519=n.verify=n.sign=n.extractPublicKeyFromSecretKey=n.generateKeyPair=n.generateKeyPairFromSeed=n.SEED_LENGTH=n.SECRET_KEY_LENGTH=n.PUBLIC_KEY_LENGTH=n.SIGNATURE_LENGTH=void 0;const t=ja,r=Qf,s=Uf;n.SIGNATURE_LENGTH=64,n.PUBLIC_KEY_LENGTH=32,n.SECRET_KEY_LENGTH=64,n.SEED_LENGTH=32;function a(F){const M=new Float64Array(16);if(F)for(let U=0;U<F.length;U++)M[U]=F[U];return M}const c=new Uint8Array(32);c[0]=9;const f=a(),b=a([1]),S=a([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),v=a([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),E=a([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),O=a([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),R=a([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function z(F,M){for(let U=0;U<16;U++)F[U]=M[U]|0}function q(F){let M=1;for(let U=0;U<16;U++){let h=F[U]+M+65535;M=Math.floor(h/65536),F[U]=h-M*65536}F[0]+=M-1+37*(M-1)}function W(F,M,U){const h=~(U-1);for(let A=0;A<16;A++){const ae=h&(F[A]^M[A]);F[A]^=ae,M[A]^=ae}}function ie(F,M){const U=a(),h=a();for(let A=0;A<16;A++)h[A]=M[A];q(h),q(h),q(h);for(let A=0;A<2;A++){U[0]=h[0]-65517;for(let de=1;de<15;de++)U[de]=h[de]-65535-(U[de-1]>>16&1),U[de-1]&=65535;U[15]=h[15]-32767-(U[14]>>16&1);const ae=U[15]>>16&1;U[14]&=65535,W(h,U,1-ae)}for(let A=0;A<16;A++)F[2*A]=h[A]&255,F[2*A+1]=h[A]>>8}function ce(F,M){let U=0;for(let h=0;h<32;h++)U|=F[h]^M[h];return(1&U-1>>>8)-1}function l(F,M){const U=new Uint8Array(32),h=new Uint8Array(32);return ie(U,F),ie(h,M),ce(U,h)}function p(F){const M=new Uint8Array(32);return ie(M,F),M[0]&1}function m(F,M){for(let U=0;U<16;U++)F[U]=M[2*U]+(M[2*U+1]<<8);F[15]&=32767}function y(F,M,U){for(let h=0;h<16;h++)F[h]=M[h]+U[h]}function g(F,M,U){for(let h=0;h<16;h++)F[h]=M[h]-U[h]}function N(F,M,U){let h,A,ae=0,de=0,ve=0,Re=0,$e=0,Se=0,xt=0,_t=0,at=0,Ue=0,Je=0,Ye=0,ot=0,ze=0,Ze=0,Ce=0,ke=0,ht=0,Le=0,Pt=0,Dt=0,Ft=0,Ht=0,Lt=0,Yt=0,ar=0,Hr=0,Zt=0,Jr=0,di=0,Ni=0,ft=U[0],rt=U[1],dt=U[2],pt=U[3],ct=U[4],it=U[5],Ot=U[6],Nt=U[7],gt=U[8],Tt=U[9],yt=U[10],bt=U[11],mt=U[12],Qe=U[13],At=U[14],Rt=U[15];h=M[0],ae+=h*ft,de+=h*rt,ve+=h*dt,Re+=h*pt,$e+=h*ct,Se+=h*it,xt+=h*Ot,_t+=h*Nt,at+=h*gt,Ue+=h*Tt,Je+=h*yt,Ye+=h*bt,ot+=h*mt,ze+=h*Qe,Ze+=h*At,Ce+=h*Rt,h=M[1],de+=h*ft,ve+=h*rt,Re+=h*dt,$e+=h*pt,Se+=h*ct,xt+=h*it,_t+=h*Ot,at+=h*Nt,Ue+=h*gt,Je+=h*Tt,Ye+=h*yt,ot+=h*bt,ze+=h*mt,Ze+=h*Qe,Ce+=h*At,ke+=h*Rt,h=M[2],ve+=h*ft,Re+=h*rt,$e+=h*dt,Se+=h*pt,xt+=h*ct,_t+=h*it,at+=h*Ot,Ue+=h*Nt,Je+=h*gt,Ye+=h*Tt,ot+=h*yt,ze+=h*bt,Ze+=h*mt,Ce+=h*Qe,ke+=h*At,ht+=h*Rt,h=M[3],Re+=h*ft,$e+=h*rt,Se+=h*dt,xt+=h*pt,_t+=h*ct,at+=h*it,Ue+=h*Ot,Je+=h*Nt,Ye+=h*gt,ot+=h*Tt,ze+=h*yt,Ze+=h*bt,Ce+=h*mt,ke+=h*Qe,ht+=h*At,Le+=h*Rt,h=M[4],$e+=h*ft,Se+=h*rt,xt+=h*dt,_t+=h*pt,at+=h*ct,Ue+=h*it,Je+=h*Ot,Ye+=h*Nt,ot+=h*gt,ze+=h*Tt,Ze+=h*yt,Ce+=h*bt,ke+=h*mt,ht+=h*Qe,Le+=h*At,Pt+=h*Rt,h=M[5],Se+=h*ft,xt+=h*rt,_t+=h*dt,at+=h*pt,Ue+=h*ct,Je+=h*it,Ye+=h*Ot,ot+=h*Nt,ze+=h*gt,Ze+=h*Tt,Ce+=h*yt,ke+=h*bt,ht+=h*mt,Le+=h*Qe,Pt+=h*At,Dt+=h*Rt,h=M[6],xt+=h*ft,_t+=h*rt,at+=h*dt,Ue+=h*pt,Je+=h*ct,Ye+=h*it,ot+=h*Ot,ze+=h*Nt,Ze+=h*gt,Ce+=h*Tt,ke+=h*yt,ht+=h*bt,Le+=h*mt,Pt+=h*Qe,Dt+=h*At,Ft+=h*Rt,h=M[7],_t+=h*ft,at+=h*rt,Ue+=h*dt,Je+=h*pt,Ye+=h*ct,ot+=h*it,ze+=h*Ot,Ze+=h*Nt,Ce+=h*gt,ke+=h*Tt,ht+=h*yt,Le+=h*bt,Pt+=h*mt,Dt+=h*Qe,Ft+=h*At,Ht+=h*Rt,h=M[8],at+=h*ft,Ue+=h*rt,Je+=h*dt,Ye+=h*pt,ot+=h*ct,ze+=h*it,Ze+=h*Ot,Ce+=h*Nt,ke+=h*gt,ht+=h*Tt,Le+=h*yt,Pt+=h*bt,Dt+=h*mt,Ft+=h*Qe,Ht+=h*At,Lt+=h*Rt,h=M[9],Ue+=h*ft,Je+=h*rt,Ye+=h*dt,ot+=h*pt,ze+=h*ct,Ze+=h*it,Ce+=h*Ot,ke+=h*Nt,ht+=h*gt,Le+=h*Tt,Pt+=h*yt,Dt+=h*bt,Ft+=h*mt,Ht+=h*Qe,Lt+=h*At,Yt+=h*Rt,h=M[10],Je+=h*ft,Ye+=h*rt,ot+=h*dt,ze+=h*pt,Ze+=h*ct,Ce+=h*it,ke+=h*Ot,ht+=h*Nt,Le+=h*gt,Pt+=h*Tt,Dt+=h*yt,Ft+=h*bt,Ht+=h*mt,Lt+=h*Qe,Yt+=h*At,ar+=h*Rt,h=M[11],Ye+=h*ft,ot+=h*rt,ze+=h*dt,Ze+=h*pt,Ce+=h*ct,ke+=h*it,ht+=h*Ot,Le+=h*Nt,Pt+=h*gt,Dt+=h*Tt,Ft+=h*yt,Ht+=h*bt,Lt+=h*mt,Yt+=h*Qe,ar+=h*At,Hr+=h*Rt,h=M[12],ot+=h*ft,ze+=h*rt,Ze+=h*dt,Ce+=h*pt,ke+=h*ct,ht+=h*it,Le+=h*Ot,Pt+=h*Nt,Dt+=h*gt,Ft+=h*Tt,Ht+=h*yt,Lt+=h*bt,Yt+=h*mt,ar+=h*Qe,Hr+=h*At,Zt+=h*Rt,h=M[13],ze+=h*ft,Ze+=h*rt,Ce+=h*dt,ke+=h*pt,ht+=h*ct,Le+=h*it,Pt+=h*Ot,Dt+=h*Nt,Ft+=h*gt,Ht+=h*Tt,Lt+=h*yt,Yt+=h*bt,ar+=h*mt,Hr+=h*Qe,Zt+=h*At,Jr+=h*Rt,h=M[14],Ze+=h*ft,Ce+=h*rt,ke+=h*dt,ht+=h*pt,Le+=h*ct,Pt+=h*it,Dt+=h*Ot,Ft+=h*Nt,Ht+=h*gt,Lt+=h*Tt,Yt+=h*yt,ar+=h*bt,Hr+=h*mt,Zt+=h*Qe,Jr+=h*At,di+=h*Rt,h=M[15],Ce+=h*ft,ke+=h*rt,ht+=h*dt,Le+=h*pt,Pt+=h*ct,Dt+=h*it,Ft+=h*Ot,Ht+=h*Nt,Lt+=h*gt,Yt+=h*Tt,ar+=h*yt,Hr+=h*bt,Zt+=h*mt,Jr+=h*Qe,di+=h*At,Ni+=h*Rt,ae+=38*ke,de+=38*ht,ve+=38*Le,Re+=38*Pt,$e+=38*Dt,Se+=38*Ft,xt+=38*Ht,_t+=38*Lt,at+=38*Yt,Ue+=38*ar,Je+=38*Hr,Ye+=38*Zt,ot+=38*Jr,ze+=38*di,Ze+=38*Ni,A=1,h=ae+A+65535,A=Math.floor(h/65536),ae=h-A*65536,h=de+A+65535,A=Math.floor(h/65536),de=h-A*65536,h=ve+A+65535,A=Math.floor(h/65536),ve=h-A*65536,h=Re+A+65535,A=Math.floor(h/65536),Re=h-A*65536,h=$e+A+65535,A=Math.floor(h/65536),$e=h-A*65536,h=Se+A+65535,A=Math.floor(h/65536),Se=h-A*65536,h=xt+A+65535,A=Math.floor(h/65536),xt=h-A*65536,h=_t+A+65535,A=Math.floor(h/65536),_t=h-A*65536,h=at+A+65535,A=Math.floor(h/65536),at=h-A*65536,h=Ue+A+65535,A=Math.floor(h/65536),Ue=h-A*65536,h=Je+A+65535,A=Math.floor(h/65536),Je=h-A*65536,h=Ye+A+65535,A=Math.floor(h/65536),Ye=h-A*65536,h=ot+A+65535,A=Math.floor(h/65536),ot=h-A*65536,h=ze+A+65535,A=Math.floor(h/65536),ze=h-A*65536,h=Ze+A+65535,A=Math.floor(h/65536),Ze=h-A*65536,h=Ce+A+65535,A=Math.floor(h/65536),Ce=h-A*65536,ae+=A-1+37*(A-1),A=1,h=ae+A+65535,A=Math.floor(h/65536),ae=h-A*65536,h=de+A+65535,A=Math.floor(h/65536),de=h-A*65536,h=ve+A+65535,A=Math.floor(h/65536),ve=h-A*65536,h=Re+A+65535,A=Math.floor(h/65536),Re=h-A*65536,h=$e+A+65535,A=Math.floor(h/65536),$e=h-A*65536,h=Se+A+65535,A=Math.floor(h/65536),Se=h-A*65536,h=xt+A+65535,A=Math.floor(h/65536),xt=h-A*65536,h=_t+A+65535,A=Math.floor(h/65536),_t=h-A*65536,h=at+A+65535,A=Math.floor(h/65536),at=h-A*65536,h=Ue+A+65535,A=Math.floor(h/65536),Ue=h-A*65536,h=Je+A+65535,A=Math.floor(h/65536),Je=h-A*65536,h=Ye+A+65535,A=Math.floor(h/65536),Ye=h-A*65536,h=ot+A+65535,A=Math.floor(h/65536),ot=h-A*65536,h=ze+A+65535,A=Math.floor(h/65536),ze=h-A*65536,h=Ze+A+65535,A=Math.floor(h/65536),Ze=h-A*65536,h=Ce+A+65535,A=Math.floor(h/65536),Ce=h-A*65536,ae+=A-1+37*(A-1),F[0]=ae,F[1]=de,F[2]=ve,F[3]=Re,F[4]=$e,F[5]=Se,F[6]=xt,F[7]=_t,F[8]=at,F[9]=Ue,F[10]=Je,F[11]=Ye,F[12]=ot,F[13]=ze,F[14]=Ze,F[15]=Ce}function P(F,M){N(F,M,M)}function Q(F,M){const U=a();let h;for(h=0;h<16;h++)U[h]=M[h];for(h=253;h>=0;h--)P(U,U),h!==2&&h!==4&&N(U,U,M);for(h=0;h<16;h++)F[h]=U[h]}function se(F,M){const U=a();let h;for(h=0;h<16;h++)U[h]=M[h];for(h=250;h>=0;h--)P(U,U),h!==1&&N(U,U,M);for(h=0;h<16;h++)F[h]=U[h]}function Ee(F,M){const U=a(),h=a(),A=a(),ae=a(),de=a(),ve=a(),Re=a(),$e=a(),Se=a();g(U,F[1],F[0]),g(Se,M[1],M[0]),N(U,U,Se),y(h,F[0],F[1]),y(Se,M[0],M[1]),N(h,h,Se),N(A,F[3],M[3]),N(A,A,v),N(ae,F[2],M[2]),y(ae,ae,ae),g(de,h,U),g(ve,ae,A),y(Re,ae,A),y($e,h,U),N(F[0],de,ve),N(F[1],$e,Re),N(F[2],Re,ve),N(F[3],de,$e)}function Te(F,M,U){for(let h=0;h<4;h++)W(F[h],M[h],U)}function tt(F,M){const U=a(),h=a(),A=a();Q(A,M[2]),N(U,M[0],A),N(h,M[1],A),ie(F,h),F[31]^=p(U)<<7}function L(F,M,U){z(F[0],f),z(F[1],b),z(F[2],b),z(F[3],f);for(let h=255;h>=0;--h){const A=U[h/8|0]>>(h&7)&1;Te(F,M,A),Ee(M,F),Ee(F,F),Te(F,M,A)}}function V(F,M){const U=[a(),a(),a(),a()];z(U[0],E),z(U[1],O),z(U[2],b),N(U[3],E,O),L(F,U,M)}function Me(F){if(F.length!==n.SEED_LENGTH)throw new Error(`ed25519: seed must be ${n.SEED_LENGTH} bytes`);const M=(0,r.hash)(F);M[0]&=248,M[31]&=127,M[31]|=64;const U=new Uint8Array(32),h=[a(),a(),a(),a()];V(h,M),tt(U,h);const A=new Uint8Array(64);return A.set(F),A.set(U,32),{publicKey:U,secretKey:A}}n.generateKeyPairFromSeed=Me;function Ae(F){const M=(0,t.randomBytes)(32,F),U=Me(M);return(0,s.wipe)(M),U}n.generateKeyPair=Ae;function ee(F){if(F.length!==n.SECRET_KEY_LENGTH)throw new Error(`ed25519: secret key must be ${n.SECRET_KEY_LENGTH} bytes`);return new Uint8Array(F.subarray(32))}n.extractPublicKeyFromSecretKey=ee;const Y=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]);function J(F,M){let U,h,A,ae;for(h=63;h>=32;--h){for(U=0,A=h-32,ae=h-12;A<ae;++A)M[A]+=U-16*M[h]*Y[A-(h-32)],U=Math.floor((M[A]+128)/256),M[A]-=U*256;M[A]+=U,M[h]=0}for(U=0,A=0;A<32;A++)M[A]+=U-(M[31]>>4)*Y[A],U=M[A]>>8,M[A]&=255;for(A=0;A<32;A++)M[A]-=U*Y[A];for(h=0;h<32;h++)M[h+1]+=M[h]>>8,F[h]=M[h]&255}function Z(F){const M=new Float64Array(64);for(let U=0;U<64;U++)M[U]=F[U];for(let U=0;U<64;U++)F[U]=0;J(F,M)}function lt(F,M){const U=new Float64Array(64),h=[a(),a(),a(),a()],A=(0,r.hash)(F.subarray(0,32));A[0]&=248,A[31]&=127,A[31]|=64;const ae=new Uint8Array(64);ae.set(A.subarray(32),32);const de=new r.SHA512;de.update(ae.subarray(32)),de.update(M);const ve=de.digest();de.clean(),Z(ve),V(h,ve),tt(ae,h),de.reset(),de.update(ae.subarray(0,32)),de.update(F.subarray(32)),de.update(M);const Re=de.digest();Z(Re);for(let $e=0;$e<32;$e++)U[$e]=ve[$e];for(let $e=0;$e<32;$e++)for(let Se=0;Se<32;Se++)U[$e+Se]+=Re[$e]*A[Se];return J(ae.subarray(32),U),ae}n.sign=lt;function Ke(F,M){const U=a(),h=a(),A=a(),ae=a(),de=a(),ve=a(),Re=a();return z(F[2],b),m(F[1],M),P(A,F[1]),N(ae,A,S),g(A,A,F[2]),y(ae,F[2],ae),P(de,ae),P(ve,de),N(Re,ve,de),N(U,Re,A),N(U,U,ae),se(U,U),N(U,U,A),N(U,U,ae),N(U,U,ae),N(F[0],U,ae),P(h,F[0]),N(h,h,ae),l(h,A)&&N(F[0],F[0],R),P(h,F[0]),N(h,h,ae),l(h,A)?-1:(p(F[0])===M[31]>>7&&g(F[0],f,F[0]),N(F[3],F[0],F[1]),0)}function Fr(F,M,U){const h=new Uint8Array(32),A=[a(),a(),a(),a()],ae=[a(),a(),a(),a()];if(U.length!==n.SIGNATURE_LENGTH)throw new Error(`ed25519: signature must be ${n.SIGNATURE_LENGTH} bytes`);if(Ke(ae,F))return!1;const de=new r.SHA512;de.update(U.subarray(0,32)),de.update(F),de.update(M);const ve=de.digest();return Z(ve),L(A,ae,ve),V(ae,U.subarray(32)),Ee(A,ae),tt(h,A),!ce(U,h)}n.verify=Fr;function be(F){let M=[a(),a(),a(),a()];if(Ke(M,F))throw new Error("Ed25519: invalid public key");let U=a(),h=a(),A=M[1];y(U,b,A),g(h,b,A),Q(h,h),N(U,U,h);let ae=new Uint8Array(32);return ie(ae,U),ae}n.convertPublicKeyToX25519=be;function St(F){const M=(0,r.hash)(F.subarray(0,32));M[0]&=248,M[31]&=127,M[31]|=64;const U=new Uint8Array(M.subarray(0,32));return(0,s.wipe)(M),U}n.convertSecretKeyToX25519=St})(hu);const vw="EdDSA",_w="JWT",Jf=".",Yf="base64url",bw="utf8",ww="utf8",Ew=":",Iw="did",Sw="key",Lh="base58btc",xw="z",Pw="K36",Ow=32;function Pa(n){return Jt(nr(as(n),bw),Yf)}function Zf(n){const t=nr(Pw,Lh),r=xw+Jt(qc([t,n]),Lh);return[Iw,Sw,r].join(Ew)}function Nw(n){return Jt(n,Yf)}function Tw(n){return nr([Pa(n.header),Pa(n.payload)].join(Jf),ww)}function Aw(n){return[Pa(n.header),Pa(n.payload),Nw(n.signature)].join(Jf)}function qh(n=ja.randomBytes(Ow)){return hu.generateKeyPairFromSeed(n)}async function Rw(n,t,r,s,a=ne.fromMiliseconds(Date.now())){const c={alg:vw,typ:_w},f=Zf(s.publicKey),b=a+r,S={iss:f,sub:n,aud:t,iat:a,exp:b},v=Tw({header:c,payload:S}),E=hu.sign(s.secretKey,v);return Aw({header:c,payload:S,signature:E})}var ns={};(function(n){const t=Da,r=Ua,s=Ca,a=$a,c=l=>l==null,f=Symbol("encodeFragmentIdentifier");function b(l){switch(l.arrayFormat){case"index":return p=>(m,y)=>{const g=m.length;return y===void 0||l.skipNull&&y===null||l.skipEmptyString&&y===""?m:y===null?[...m,[E(p,l),"[",g,"]"].join("")]:[...m,[E(p,l),"[",E(g,l),"]=",E(y,l)].join("")]};case"bracket":return p=>(m,y)=>y===void 0||l.skipNull&&y===null||l.skipEmptyString&&y===""?m:y===null?[...m,[E(p,l),"[]"].join("")]:[...m,[E(p,l),"[]=",E(y,l)].join("")];case"colon-list-separator":return p=>(m,y)=>y===void 0||l.skipNull&&y===null||l.skipEmptyString&&y===""?m:y===null?[...m,[E(p,l),":list="].join("")]:[...m,[E(p,l),":list=",E(y,l)].join("")];case"comma":case"separator":case"bracket-separator":{const p=l.arrayFormat==="bracket-separator"?"[]=":"=";return m=>(y,g)=>g===void 0||l.skipNull&&g===null||l.skipEmptyString&&g===""?y:(g=g===null?"":g,y.length===0?[[E(m,l),p,E(g,l)].join("")]:[[y,E(g,l)].join(l.arrayFormatSeparator)])}default:return p=>(m,y)=>y===void 0||l.skipNull&&y===null||l.skipEmptyString&&y===""?m:y===null?[...m,E(p,l)]:[...m,[E(p,l),"=",E(y,l)].join("")]}}function S(l){let p;switch(l.arrayFormat){case"index":return(m,y,g)=>{if(p=/\[(\d*)\]$/.exec(m),m=m.replace(/\[\d*\]$/,""),!p){g[m]=y;return}g[m]===void 0&&(g[m]={}),g[m][p[1]]=y};case"bracket":return(m,y,g)=>{if(p=/(\[\])$/.exec(m),m=m.replace(/\[\]$/,""),!p){g[m]=y;return}if(g[m]===void 0){g[m]=[y];return}g[m]=[].concat(g[m],y)};case"colon-list-separator":return(m,y,g)=>{if(p=/(:list)$/.exec(m),m=m.replace(/:list$/,""),!p){g[m]=y;return}if(g[m]===void 0){g[m]=[y];return}g[m]=[].concat(g[m],y)};case"comma":case"separator":return(m,y,g)=>{const N=typeof y=="string"&&y.includes(l.arrayFormatSeparator),P=typeof y=="string"&&!N&&O(y,l).includes(l.arrayFormatSeparator);y=P?O(y,l):y;const Q=N||P?y.split(l.arrayFormatSeparator).map(se=>O(se,l)):y===null?y:O(y,l);g[m]=Q};case"bracket-separator":return(m,y,g)=>{const N=/(\[\])$/.test(m);if(m=m.replace(/\[\]$/,""),!N){g[m]=y&&O(y,l);return}const P=y===null?[]:y.split(l.arrayFormatSeparator).map(Q=>O(Q,l));if(g[m]===void 0){g[m]=P;return}g[m]=[].concat(g[m],P)};default:return(m,y,g)=>{if(g[m]===void 0){g[m]=y;return}g[m]=[].concat(g[m],y)}}}function v(l){if(typeof l!="string"||l.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function E(l,p){return p.encode?p.strict?t(l):encodeURIComponent(l):l}function O(l,p){return p.decode?r(l):l}function R(l){return Array.isArray(l)?l.sort():typeof l=="object"?R(Object.keys(l)).sort((p,m)=>Number(p)-Number(m)).map(p=>l[p]):l}function z(l){const p=l.indexOf("#");return p!==-1&&(l=l.slice(0,p)),l}function q(l){let p="";const m=l.indexOf("#");return m!==-1&&(p=l.slice(m)),p}function W(l){l=z(l);const p=l.indexOf("?");return p===-1?"":l.slice(p+1)}function ie(l,p){return p.parseNumbers&&!Number.isNaN(Number(l))&&typeof l=="string"&&l.trim()!==""?l=Number(l):p.parseBooleans&&l!==null&&(l.toLowerCase()==="true"||l.toLowerCase()==="false")&&(l=l.toLowerCase()==="true"),l}function ce(l,p){p=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},p),v(p.arrayFormatSeparator);const m=S(p),y=Object.create(null);if(typeof l!="string"||(l=l.trim().replace(/^[?#&]/,""),!l))return y;for(const g of l.split("&")){if(g==="")continue;let[N,P]=s(p.decode?g.replace(/\+/g," "):g,"=");P=P===void 0?null:["comma","separator","bracket-separator"].includes(p.arrayFormat)?P:O(P,p),m(O(N,p),P,y)}for(const g of Object.keys(y)){const N=y[g];if(typeof N=="object"&&N!==null)for(const P of Object.keys(N))N[P]=ie(N[P],p);else y[g]=ie(N,p)}return p.sort===!1?y:(p.sort===!0?Object.keys(y).sort():Object.keys(y).sort(p.sort)).reduce((g,N)=>{const P=y[N];return P&&typeof P=="object"&&!Array.isArray(P)?g[N]=R(P):g[N]=P,g},Object.create(null))}n.extract=W,n.parse=ce,n.stringify=(l,p)=>{if(!l)return"";p=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},p),v(p.arrayFormatSeparator);const m=P=>p.skipNull&&c(l[P])||p.skipEmptyString&&l[P]==="",y=b(p),g={};for(const P of Object.keys(l))m(P)||(g[P]=l[P]);const N=Object.keys(g);return p.sort!==!1&&N.sort(p.sort),N.map(P=>{const Q=l[P];return Q===void 0?"":Q===null?E(P,p):Array.isArray(Q)?Q.length===0&&p.arrayFormat==="bracket-separator"?E(P,p)+"[]":Q.reduce(y(P),[]).join("&"):E(P,p)+"="+E(Q,p)}).filter(P=>P.length>0).join("&")},n.parseUrl=(l,p)=>{p=Object.assign({decode:!0},p);const[m,y]=s(l,"#");return Object.assign({url:m.split("?")[0]||"",query:ce(W(l),p)},p&&p.parseFragmentIdentifier&&y?{fragmentIdentifier:O(y,p)}:{})},n.stringifyUrl=(l,p)=>{p=Object.assign({encode:!0,strict:!0,[f]:!0},p);const m=z(l.url).split("?")[0]||"",y=n.extract(l.url),g=n.parse(y,{sort:!1}),N=Object.assign(g,l.query);let P=n.stringify(N,p);P&&(P=`?${P}`);let Q=q(l.url);return l.fragmentIdentifier&&(Q=`#${p[f]?E(l.fragmentIdentifier,p):l.fragmentIdentifier}`),`${m}${P}${Q}`},n.pick=(l,p,m)=>{m=Object.assign({parseFragmentIdentifier:!0,[f]:!1},m);const{url:y,query:g,fragmentIdentifier:N}=n.parseUrl(l,m);return n.stringifyUrl({url:y,query:a(g,p),fragmentIdentifier:N},m)},n.exclude=(l,p,m)=>{const y=Array.isArray(p)?g=>!p.includes(g):(g,N)=>!p(g,N);return n.pick(l,y,m)}})(ns);const Xf="base10",sr="base16",Gc="base64pad",fu="utf8",ed=0,bn=1,Cw=0,Mh=1,Wc=12,du=32;function $w(){const n=jf.generateKeyPair();return{privateKey:Jt(n.secretKey,sr),publicKey:Jt(n.publicKey,sr)}}function Qc(){const n=ja.randomBytes(du);return Jt(n,sr)}function Dw(n,t){const r=jf.sharedKey(nr(n,sr),nr(t,sr),!0),s=new b_(La.SHA256,r).expand(du);return Jt(s,sr)}function Uw(n){const t=La.hash(nr(n,sr));return Jt(t,sr)}function Jc(n){const t=La.hash(nr(n,fu));return Jt(t,sr)}function jw(n){return nr(`${n}`,Xf)}function cs(n){return Number(Jt(n,Xf))}function Lw(n){const t=jw(typeof n.type<"u"?n.type:ed);if(cs(t)===bn&&typeof n.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const r=typeof n.senderPublicKey<"u"?nr(n.senderPublicKey,sr):void 0,s=typeof n.iv<"u"?nr(n.iv,sr):ja.randomBytes(Wc),a=new Lf.ChaCha20Poly1305(nr(n.symKey,sr)).seal(s,nr(n.message,fu));return Mw({type:t,sealed:a,iv:s,senderPublicKey:r})}function qw(n){const t=new Lf.ChaCha20Poly1305(nr(n.symKey,sr)),{sealed:r,iv:s}=Oa(n.encoded),a=t.open(s,r);if(a===null)throw new Error("Failed to decrypt");return Jt(a,fu)}function Mw(n){if(cs(n.type)===bn){if(typeof n.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return Jt(qc([n.type,n.senderPublicKey,n.iv,n.sealed]),Gc)}return Jt(qc([n.type,n.iv,n.sealed]),Gc)}function Oa(n){const t=nr(n,Gc),r=t.slice(Cw,Mh),s=Mh;if(cs(r)===bn){const b=s+du,S=b+Wc,v=t.slice(s,b),E=t.slice(b,S),O=t.slice(S);return{type:r,sealed:O,iv:E,senderPublicKey:v}}const a=s+Wc,c=t.slice(s,a),f=t.slice(a);return{type:r,sealed:f,iv:c}}function zw(n,t){const r=Oa(n);return td({type:cs(r.type),senderPublicKey:typeof r.senderPublicKey<"u"?Jt(r.senderPublicKey,sr):void 0,receiverPublicKey:t==null?void 0:t.receiverPublicKey})}function td(n){const t=(n==null?void 0:n.type)||ed;if(t===bn){if(typeof(n==null?void 0:n.senderPublicKey)>"u")throw new Error("missing sender public key");if(typeof(n==null?void 0:n.receiverPublicKey)>"u")throw new Error("missing receiver public key")}return{type:t,senderPublicKey:n==null?void 0:n.senderPublicKey,receiverPublicKey:n==null?void 0:n.receiverPublicKey}}function zh(n){return n.type===bn&&typeof n.senderPublicKey=="string"&&typeof n.receiverPublicKey=="string"}var Fw=Object.defineProperty,Fh=Object.getOwnPropertySymbols,Hw=Object.prototype.hasOwnProperty,Kw=Object.prototype.propertyIsEnumerable,Hh=(n,t,r)=>t in n?Fw(n,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[t]=r,Kh=(n,t)=>{for(var r in t||(t={}))Hw.call(t,r)&&Hh(n,r,t[r]);if(Fh)for(var r of Fh(t))Kw.call(t,r)&&Hh(n,r,t[r]);return n};const kw="ReactNative",zr={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},Vw="js";function pu(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}function wn(){return!qf()&&!!qa()&&navigator.product===kw}function Fa(){return!pu()&&!!qa()}function Ha(){return wn()?zr.reactNative:pu()?zr.node:Fa()?zr.browser:zr.unknown}function Bw(){var n;try{return wn()&&typeof global<"u"&&typeof(global==null?void 0:global.Application)<"u"?(n=global.Application)==null?void 0:n.applicationId:void 0}catch{return}}function Gw(n,t){let r=ns.parse(n);return r=Kh(Kh({},r),t),n=ns.stringify(r),n}function Ww(){if(Ha()===zr.reactNative&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"){const{OS:r,Version:s}=global.Platform;return[r,s].join("-")}const n=x_();if(n===null)return"unknown";const t=n.os?n.os.replace(" ","").toLowerCase():"unknown";return n.type==="browser"?[t,n.name,n.version].join("-"):[t,n.version].join("-")}function Qw(){var n;const t=Ha();return t===zr.browser?[t,((n=w_())==null?void 0:n.host)||"unknown"].join(":"):t}function Jw(n,t,r){const s=Ww(),a=Qw();return[[n,t].join("-"),[Vw,r].join("-"),s,a].join("/")}function Yw({protocol:n,version:t,relayUrl:r,sdkVersion:s,auth:a,projectId:c,useOnCloseEvent:f,bundleId:b}){const S=r.split("?"),v=Jw(n,t,s),E={auth:a,ua:v,projectId:c,useOnCloseEvent:f||void 0,origin:b||void 0},O=Gw(S[1]||"",E);return S[0]+"?"+O}function rd(n){return Object.fromEntries(n.entries())}function id(n){return new Map(Object.entries(n))}function Zw(n=ne.FIVE_MINUTES,t){const r=ne.toMiliseconds(n||ne.FIVE_MINUTES);let s,a,c;return{resolve:f=>{c&&s&&(clearTimeout(c),s(f))},reject:f=>{c&&a&&(clearTimeout(c),a(f))},done:()=>new Promise((f,b)=>{c=setTimeout(()=>{b(new Error(t))},r),s=f,a=b})}}function ss(n,t,r){return new Promise(async(s,a)=>{const c=setTimeout(()=>a(new Error(r)),t);try{const f=await n;s(f)}catch(f){a(f)}clearTimeout(c)})}function nd(n,t){if(typeof t=="string"&&t.startsWith(`${n}:`))return t;if(n.toLowerCase()==="topic"){if(typeof t!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${t}`}else if(n.toLowerCase()==="id"){if(typeof t!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${t}`}throw new Error(`Unknown expirer target type: ${n}`)}function Xw(n){return nd("topic",n)}function e1(n){return nd("id",n)}function t1(n){const[t,r]=n.split(":"),s={id:void 0,topic:void 0};if(t==="topic"&&typeof r=="string")s.topic=r;else if(t==="id"&&Number.isInteger(Number(r)))s.id=Number(r);else throw new Error(`Invalid target, expected id:number or topic:string, got ${t}:${r}`);return s}function Ia(n,t){return ne.fromMiliseconds((t||Date.now())+ne.toMiliseconds(n))}function kh(n){return Date.now()>=ne.toMiliseconds(n)}function Sc(n,t){return`${n}${t?`:${t}`:""}`}const r1="irn";function Yc(n){return(n==null?void 0:n.relay)||{protocol:r1}}function Sa(n){const t=R_[n];if(typeof t>"u")throw new Error(`Relay Protocol not supported: ${n}`);return t}var i1=Object.defineProperty,Vh=Object.getOwnPropertySymbols,n1=Object.prototype.hasOwnProperty,s1=Object.prototype.propertyIsEnumerable,Bh=(n,t,r)=>t in n?i1(n,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[t]=r,a1=(n,t)=>{for(var r in t||(t={}))n1.call(t,r)&&Bh(n,r,t[r]);if(Vh)for(var r of Vh(t))s1.call(t,r)&&Bh(n,r,t[r]);return n};function o1(n,t="-"){const r={},s="relay"+t;return Object.keys(n).forEach(a=>{if(a.startsWith(s)){const c=a.replace(s,""),f=n[a];r[c]=f}}),r}function Gh(n){n=n.includes("wc://")?n.replace("wc://",""):n,n=n.includes("wc:")?n.replace("wc:",""):n;const t=n.indexOf(":"),r=n.indexOf("?")!==-1?n.indexOf("?"):void 0,s=n.substring(0,t),a=n.substring(t+1,r).split("@"),c=typeof r<"u"?n.substring(r):"",f=ns.parse(c);return{protocol:s,topic:c1(a[0]),version:parseInt(a[1],10),symKey:f.symKey,relay:o1(f)}}function c1(n){return n.startsWith("//")?n.substring(2):n}function u1(n,t="-"){const r="relay",s={};return Object.keys(n).forEach(a=>{const c=r+t+a;n[a]&&(s[c]=n[a])}),s}function l1(n){return`${n.protocol}:${n.topic}@${n.version}?`+ns.stringify(a1({symKey:n.symKey},u1(n.relay)))}const h1={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},f1={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function He(n,t){const{message:r,code:s}=f1[n];return{message:t?`${r} ${t}`:r,code:s}}function Jn(n,t){const{message:r,code:s}=h1[n];return{message:t?`${r} ${t}`:r,code:s}}function d1(n,t){return Array.isArray(n)?typeof t<"u"&&n.length?n.every(t):!0:!1}function Na(n){return typeof n>"u"}function sd(n,t){return t&&Na(n)?!0:typeof n=="string"&&!!n.trim().length}function p1(n){if(sd(n,!1))try{return typeof new URL(n)<"u"}catch{return!1}return!1}function g1(n){var t;return(t=n==null?void 0:n.proposer)==null?void 0:t.publicKey}function y1(n){return n==null?void 0:n.topic}function xc(n){return typeof n<"u"&&typeof n!==null}function Wh(){const n=Ha();return new Promise(t=>{switch(n){case zr.browser:t(m1());break;case zr.reactNative:t(v1());break;case zr.node:t(_1());break;default:t(!0)}})}function m1(){return Fa()&&(navigator==null?void 0:navigator.onLine)}async function v1(){if(wn()&&typeof global<"u"&&global!=null&&global.NetInfo){const n=await(global==null?void 0:global.NetInfo.fetch());return n==null?void 0:n.isConnected}return!0}function _1(){return!0}function b1(n){switch(Ha()){case zr.browser:w1(n);break;case zr.reactNative:E1(n);break}}function w1(n){!wn()&&Fa()&&(window.addEventListener("online",()=>n(!0)),window.addEventListener("offline",()=>n(!1)))}function E1(n){wn()&&typeof global<"u"&&global!=null&&global.NetInfo&&(global==null||global.NetInfo.addEventListener(t=>n(t==null?void 0:t.isConnected)))}const I1=()=>typeof WebSocket<"u"?WebSocket:typeof global<"u"&&typeof global.WebSocket<"u"?global.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:require("ws"),S1=()=>typeof WebSocket<"u"||typeof global<"u"&&typeof global.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u",Qh=n=>n.split("?")[0],Jh=10,x1=I1();let P1=class{constructor(t){if(this.url=t,this.events=new Qr.EventEmitter,this.registering=!1,!wh(t))throw new Error(`Provided URL is not compatible with WebSocket connection: ${t}`);this.url=t}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}off(t,r){this.events.off(t,r)}removeListener(t,r){this.events.removeListener(t,r)}async open(t=this.url){await this.register(t)}async close(){return new Promise((t,r)=>{if(typeof this.socket>"u"){r(new Error("Connection already closed"));return}this.socket.onclose=s=>{this.onClose(s),t()},this.socket.close()})}async send(t){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(as(t))}catch(r){this.onError(t.id,r)}}register(t=this.url){if(!wh(t))throw new Error(`Provided URL is not compatible with WebSocket connection: ${t}`);if(this.registering){const r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((s,a)=>{this.events.once("register_error",c=>{this.resetMaxListeners(),a(c)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return a(new Error("WebSocket connection is missing or invalid"));s(this.socket)})})}return this.url=t,this.registering=!0,new Promise((r,s)=>{const a=new URLSearchParams(t).get("origin"),c=P_.isReactNative()?{headers:{origin:a}}:{rejectUnauthorized:!O_(t)},f=new x1(t,[],c);S1()?f.onerror=b=>{const S=b;s(this.emitError(S.error))}:f.on("error",b=>{s(this.emitError(b))}),f.onopen=()=>{this.onOpen(f),r(f)}})}onOpen(t){t.onmessage=r=>this.onPayload(r),t.onclose=r=>this.onClose(r),this.socket=t,this.registering=!1,this.events.emit("open")}onClose(t){this.socket=void 0,this.registering=!1,this.events.emit("close",t)}onPayload(t){if(typeof t.data>"u")return;const r=typeof t.data=="string"?Ma(t.data):t.data;this.events.emit("payload",r)}onError(t,r){const s=this.parseError(r),a=s.message||s.toString(),c=au(t,a);this.events.emit("payload",c)}parseError(t,r=this.url){return N_(t,Qh(r),"WS")}resetMaxListeners(){this.events.getMaxListeners()>Jh&&this.events.setMaxListeners(Jh)}emitError(t){const r=this.parseError(new Error((t==null?void 0:t.message)||`WebSocket connection failed for host: ${Qh(this.url)}`));return this.events.emit("register_error",r),r}};var Ta={exports:{}};Ta.exports;(function(n,t){var r=200,s="__lodash_hash_undefined__",a=1,c=2,f=9007199254740991,b="[object Arguments]",S="[object Array]",v="[object AsyncFunction]",E="[object Boolean]",O="[object Date]",R="[object Error]",z="[object Function]",q="[object GeneratorFunction]",W="[object Map]",ie="[object Number]",ce="[object Null]",l="[object Object]",p="[object Promise]",m="[object Proxy]",y="[object RegExp]",g="[object Set]",N="[object String]",P="[object Symbol]",Q="[object Undefined]",se="[object WeakMap]",Ee="[object ArrayBuffer]",Te="[object DataView]",tt="[object Float32Array]",L="[object Float64Array]",V="[object Int8Array]",Me="[object Int16Array]",Ae="[object Int32Array]",ee="[object Uint8Array]",Y="[object Uint8ClampedArray]",J="[object Uint16Array]",Z="[object Uint32Array]",lt=/[\\^$.*+?()[\]{}|]/g,Ke=/^\[object .+?Constructor\]$/,Fr=/^(?:0|[1-9]\d*)$/,be={};be[tt]=be[L]=be[V]=be[Me]=be[Ae]=be[ee]=be[Y]=be[J]=be[Z]=!0,be[b]=be[S]=be[Ee]=be[E]=be[Te]=be[O]=be[R]=be[z]=be[W]=be[ie]=be[l]=be[y]=be[g]=be[N]=be[se]=!1;var St=typeof pa=="object"&&pa&&pa.Object===Object&&pa,F=typeof self=="object"&&self&&self.Object===Object&&self,M=St||F||Function("return this")(),U=t&&!t.nodeType&&t,h=U&&!0&&n&&!n.nodeType&&n,A=h&&h.exports===U,ae=A&&St.process,de=function(){try{return ae&&ae.binding&&ae.binding("util")}catch{}}(),ve=de&&de.isTypedArray;function Re(I,C){for(var B=-1,te=I==null?0:I.length,Be=0,ge=[];++B<te;){var Xe=I[B];C(Xe,B,I)&&(ge[Be++]=Xe)}return ge}function $e(I,C){for(var B=-1,te=C.length,Be=I.length;++B<te;)I[Be+B]=C[B];return I}function Se(I,C){for(var B=-1,te=I==null?0:I.length;++B<te;)if(C(I[B],B,I))return!0;return!1}function xt(I,C){for(var B=-1,te=Array(I);++B<I;)te[B]=C(B);return te}function _t(I){return function(C){return I(C)}}function at(I,C){return I.has(C)}function Ue(I,C){return I==null?void 0:I[C]}function Je(I){var C=-1,B=Array(I.size);return I.forEach(function(te,Be){B[++C]=[Be,te]}),B}function Ye(I,C){return function(B){return I(C(B))}}function ot(I){var C=-1,B=Array(I.size);return I.forEach(function(te){B[++C]=te}),B}var ze=Array.prototype,Ze=Function.prototype,Ce=Object.prototype,ke=M["__core-js_shared__"],ht=Ze.toString,Le=Ce.hasOwnProperty,Pt=function(){var I=/[^.]+$/.exec(ke&&ke.keys&&ke.keys.IE_PROTO||"");return I?"Symbol(src)_1."+I:""}(),Dt=Ce.toString,Ft=RegExp("^"+ht.call(Le).replace(lt,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Ht=A?M.Buffer:void 0,Lt=M.Symbol,Yt=M.Uint8Array,ar=Ce.propertyIsEnumerable,Hr=ze.splice,Zt=Lt?Lt.toStringTag:void 0,Jr=Object.getOwnPropertySymbols,di=Ht?Ht.isBuffer:void 0,Ni=Ye(Object.keys,Object),ft=pr(M,"DataView"),rt=pr(M,"Map"),dt=pr(M,"Promise"),pt=pr(M,"Set"),ct=pr(M,"WeakMap"),it=pr(Object,"create"),Ot=Zr(ft),Nt=Zr(rt),gt=Zr(dt),Tt=Zr(pt),yt=Zr(ct),bt=Lt?Lt.prototype:void 0,mt=bt?bt.valueOf:void 0;function Qe(I){var C=-1,B=I==null?0:I.length;for(this.clear();++C<B;){var te=I[C];this.set(te[0],te[1])}}function At(){this.__data__=it?it(null):{},this.size=0}function Rt(I){var C=this.has(I)&&delete this.__data__[I];return this.size-=C?1:0,C}function Ba(I){var C=this.__data__;if(it){var B=C[I];return B===s?void 0:B}return Le.call(C,I)?C[I]:void 0}function Ga(I){var C=this.__data__;return it?C[I]!==void 0:Le.call(C,I)}function Wa(I,C){var B=this.__data__;return this.size+=this.has(I)?0:1,B[I]=it&&C===void 0?s:C,this}Qe.prototype.clear=At,Qe.prototype.delete=Rt,Qe.prototype.get=Ba,Qe.prototype.has=Ga,Qe.prototype.set=Wa;function wr(I){var C=-1,B=I==null?0:I.length;for(this.clear();++C<B;){var te=I[C];this.set(te[0],te[1])}}function Qa(){this.__data__=[],this.size=0}function Ja(I){var C=this.__data__,B=Ti(C,I);if(B<0)return!1;var te=C.length-1;return B==te?C.pop():Hr.call(C,B,1),--this.size,!0}function Ya(I){var C=this.__data__,B=Ti(C,I);return B<0?void 0:C[B][1]}function Za(I){return Ti(this.__data__,I)>-1}function Xa(I,C){var B=this.__data__,te=Ti(B,I);return te<0?(++this.size,B.push([I,C])):B[te][1]=C,this}wr.prototype.clear=Qa,wr.prototype.delete=Ja,wr.prototype.get=Ya,wr.prototype.has=Za,wr.prototype.set=Xa;function Yr(I){var C=-1,B=I==null?0:I.length;for(this.clear();++C<B;){var te=I[C];this.set(te[0],te[1])}}function Qi(){this.size=0,this.__data__={hash:new Qe,map:new(rt||wr),string:new Qe}}function eo(I){var C=pi(this,I).delete(I);return this.size-=C?1:0,C}function Ji(I){return pi(this,I).get(I)}function to(I){return pi(this,I).has(I)}function ro(I,C){var B=pi(this,I),te=B.size;return B.set(I,C),this.size+=B.size==te?0:1,this}Yr.prototype.clear=Qi,Yr.prototype.delete=eo,Yr.prototype.get=Ji,Yr.prototype.has=to,Yr.prototype.set=ro;function Yi(I){var C=-1,B=I==null?0:I.length;for(this.__data__=new Yr;++C<B;)this.add(I[C])}function ls(I){return this.__data__.set(I,s),this}function hs(I){return this.__data__.has(I)}Yi.prototype.add=Yi.prototype.push=ls,Yi.prototype.has=hs;function Cr(I){var C=this.__data__=new wr(I);this.size=C.size}function io(){this.__data__=new wr,this.size=0}function no(I){var C=this.__data__,B=C.delete(I);return this.size=C.size,B}function so(I){return this.__data__.get(I)}function ao(I){return this.__data__.has(I)}function fs(I,C){var B=this.__data__;if(B instanceof wr){var te=B.__data__;if(!rt||te.length<r-1)return te.push([I,C]),this.size=++B.size,this;B=this.__data__=new Yr(te)}return B.set(I,C),this.size=B.size,this}Cr.prototype.clear=io,Cr.prototype.delete=no,Cr.prototype.get=so,Cr.prototype.has=ao,Cr.prototype.set=fs;function ds(I,C){var B=en(I),te=!B&&xs(I),Be=!B&&!te&&xn(I),ge=!B&&!te&&!Be&&Ns(I),Xe=B||te||Be||ge,Ct=Xe?xt(I.length,String):[],Pe=Ct.length;for(var Ge in I)(C||Le.call(I,Ge))&&!(Xe&&(Ge=="length"||Be&&(Ge=="offset"||Ge=="parent")||ge&&(Ge=="buffer"||Ge=="byteLength"||Ge=="byteOffset")||bs(Ge,Pe)))&&Ct.push(Ge);return Ct}function Ti(I,C){for(var B=I.length;B--;)if(Ss(I[B][0],C))return B;return-1}function In(I,C,B){var te=C(I);return en(I)?te:$e(te,B(I))}function Ai(I){return I==null?I===void 0?Q:ce:Zt&&Zt in Object(I)?vs(I):uo(I)}function Sn(I){return Ci(I)&&Ai(I)==b}function Ri(I,C,B,te,Be){return I===C?!0:I==null||C==null||!Ci(I)&&!Ci(C)?I!==I&&C!==C:ps(I,C,B,te,Ri,Be)}function ps(I,C,B,te,Be,ge){var Xe=en(I),Ct=en(C),Pe=Xe?S:Kr(I),Ge=Ct?S:Kr(C);Pe=Pe==b?l:Pe,Ge=Ge==b?l:Ge;var wt=Pe==l,or=Ge==l,$t=Pe==Ge;if($t&&xn(I)){if(!xn(C))return!1;Xe=!0,wt=!1}if($t&&!wt)return ge||(ge=new Cr),Xe||Ns(I)?Zi(I,C,B,te,Be,ge):co(I,C,Pe,B,te,Be,ge);if(!(B&a)){var et=wt&&Le.call(I,"__wrapped__"),Xt=or&&Le.call(C,"__wrapped__");if(et||Xt){var $r=et?I.value():I,Er=Xt?C.value():C;return ge||(ge=new Cr),Be($r,Er,B,te,ge)}}return $t?(ge||(ge=new Cr),ms(I,C,B,te,Be,ge)):!1}function oo(I){if(!Os(I)||Es(I))return!1;var C=tn(I)?Ft:Ke;return C.test(Zr(I))}function gs(I){return Ci(I)&&Ps(I.length)&&!!be[Ai(I)]}function ys(I){if(!Is(I))return Ni(I);var C=[];for(var B in Object(I))Le.call(I,B)&&B!="constructor"&&C.push(B);return C}function Zi(I,C,B,te,Be,ge){var Xe=B&a,Ct=I.length,Pe=C.length;if(Ct!=Pe&&!(Xe&&Pe>Ct))return!1;var Ge=ge.get(I);if(Ge&&ge.get(C))return Ge==C;var wt=-1,or=!0,$t=B&c?new Yi:void 0;for(ge.set(I,C),ge.set(C,I);++wt<Ct;){var et=I[wt],Xt=C[wt];if(te)var $r=Xe?te(Xt,et,wt,C,I,ge):te(et,Xt,wt,I,C,ge);if($r!==void 0){if($r)continue;or=!1;break}if($t){if(!Se(C,function(Er,kr){if(!at($t,kr)&&(et===Er||Be(et,Er,B,te,ge)))return $t.push(kr)})){or=!1;break}}else if(!(et===Xt||Be(et,Xt,B,te,ge))){or=!1;break}}return ge.delete(I),ge.delete(C),or}function co(I,C,B,te,Be,ge,Xe){switch(B){case Te:if(I.byteLength!=C.byteLength||I.byteOffset!=C.byteOffset)return!1;I=I.buffer,C=C.buffer;case Ee:return!(I.byteLength!=C.byteLength||!ge(new Yt(I),new Yt(C)));case E:case O:case ie:return Ss(+I,+C);case R:return I.name==C.name&&I.message==C.message;case y:case N:return I==C+"";case W:var Ct=Je;case g:var Pe=te&a;if(Ct||(Ct=ot),I.size!=C.size&&!Pe)return!1;var Ge=Xe.get(I);if(Ge)return Ge==C;te|=c,Xe.set(I,C);var wt=Zi(Ct(I),Ct(C),te,Be,ge,Xe);return Xe.delete(I),wt;case P:if(mt)return mt.call(I)==mt.call(C)}return!1}function ms(I,C,B,te,Be,ge){var Xe=B&a,Ct=Xi(I),Pe=Ct.length,Ge=Xi(C),wt=Ge.length;if(Pe!=wt&&!Xe)return!1;for(var or=Pe;or--;){var $t=Ct[or];if(!(Xe?$t in C:Le.call(C,$t)))return!1}var et=ge.get(I);if(et&&ge.get(C))return et==C;var Xt=!0;ge.set(I,C),ge.set(C,I);for(var $r=Xe;++or<Pe;){$t=Ct[or];var Er=I[$t],kr=C[$t];if(te)var Pn=Xe?te(kr,Er,$t,C,I,ge):te(Er,kr,$t,I,C,ge);if(!(Pn===void 0?Er===kr||Be(Er,kr,B,te,ge):Pn)){Xt=!1;break}$r||($r=$t=="constructor")}if(Xt&&!$r){var $i=I.constructor,qt=C.constructor;$i!=qt&&"constructor"in I&&"constructor"in C&&!(typeof $i=="function"&&$i instanceof $i&&typeof qt=="function"&&qt instanceof qt)&&(Xt=!1)}return ge.delete(I),ge.delete(C),Xt}function Xi(I){return In(I,fo,_s)}function pi(I,C){var B=I.__data__;return ws(C)?B[typeof C=="string"?"string":"hash"]:B.map}function pr(I,C){var B=Ue(I,C);return oo(B)?B:void 0}function vs(I){var C=Le.call(I,Zt),B=I[Zt];try{I[Zt]=void 0;var te=!0}catch{}var Be=Dt.call(I);return te&&(C?I[Zt]=B:delete I[Zt]),Be}var _s=Jr?function(I){return I==null?[]:(I=Object(I),Re(Jr(I),function(C){return ar.call(I,C)}))}:Ve,Kr=Ai;(ft&&Kr(new ft(new ArrayBuffer(1)))!=Te||rt&&Kr(new rt)!=W||dt&&Kr(dt.resolve())!=p||pt&&Kr(new pt)!=g||ct&&Kr(new ct)!=se)&&(Kr=function(I){var C=Ai(I),B=C==l?I.constructor:void 0,te=B?Zr(B):"";if(te)switch(te){case Ot:return Te;case Nt:return W;case gt:return p;case Tt:return g;case yt:return se}return C});function bs(I,C){return C=C??f,!!C&&(typeof I=="number"||Fr.test(I))&&I>-1&&I%1==0&&I<C}function ws(I){var C=typeof I;return C=="string"||C=="number"||C=="symbol"||C=="boolean"?I!=="__proto__":I===null}function Es(I){return!!Pt&&Pt in I}function Is(I){var C=I&&I.constructor,B=typeof C=="function"&&C.prototype||Ce;return I===B}function uo(I){return Dt.call(I)}function Zr(I){if(I!=null){try{return ht.call(I)}catch{}try{return I+""}catch{}}return""}function Ss(I,C){return I===C||I!==I&&C!==C}var xs=Sn(function(){return arguments}())?Sn:function(I){return Ci(I)&&Le.call(I,"callee")&&!ar.call(I,"callee")},en=Array.isArray;function lo(I){return I!=null&&Ps(I.length)&&!tn(I)}var xn=di||Fe;function ho(I,C){return Ri(I,C)}function tn(I){if(!Os(I))return!1;var C=Ai(I);return C==z||C==q||C==v||C==m}function Ps(I){return typeof I=="number"&&I>-1&&I%1==0&&I<=f}function Os(I){var C=typeof I;return I!=null&&(C=="object"||C=="function")}function Ci(I){return I!=null&&typeof I=="object"}var Ns=ve?_t(ve):gs;function fo(I){return lo(I)?ds(I):ys(I)}function Ve(){return[]}function Fe(){return!1}n.exports=ho})(Ta,Ta.exports);var O1=Ta.exports;const N1=E_(O1);var T1={};function A1(n,t){if(n.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),s=0;s<r.length;s++)r[s]=255;for(var a=0;a<n.length;a++){var c=n.charAt(a),f=c.charCodeAt(0);if(r[f]!==255)throw new TypeError(c+" is ambiguous");r[f]=a}var b=n.length,S=n.charAt(0),v=Math.log(b)/Math.log(256),E=Math.log(256)/Math.log(b);function O(q){if(q instanceof Uint8Array||(ArrayBuffer.isView(q)?q=new Uint8Array(q.buffer,q.byteOffset,q.byteLength):Array.isArray(q)&&(q=Uint8Array.from(q))),!(q instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(q.length===0)return"";for(var W=0,ie=0,ce=0,l=q.length;ce!==l&&q[ce]===0;)ce++,W++;for(var p=(l-ce)*E+1>>>0,m=new Uint8Array(p);ce!==l;){for(var y=q[ce],g=0,N=p-1;(y!==0||g<ie)&&N!==-1;N--,g++)y+=256*m[N]>>>0,m[N]=y%b>>>0,y=y/b>>>0;if(y!==0)throw new Error("Non-zero carry");ie=g,ce++}for(var P=p-ie;P!==p&&m[P]===0;)P++;for(var Q=S.repeat(W);P<p;++P)Q+=n.charAt(m[P]);return Q}function R(q){if(typeof q!="string")throw new TypeError("Expected String");if(q.length===0)return new Uint8Array;var W=0;if(q[W]!==" "){for(var ie=0,ce=0;q[W]===S;)ie++,W++;for(var l=(q.length-W)*v+1>>>0,p=new Uint8Array(l);q[W];){var m=r[q.charCodeAt(W)];if(m===255)return;for(var y=0,g=l-1;(m!==0||y<ce)&&g!==-1;g--,y++)m+=b*p[g]>>>0,p[g]=m%256>>>0,m=m/256>>>0;if(m!==0)throw new Error("Non-zero carry");ce=y,W++}if(q[W]!==" "){for(var N=l-ce;N!==l&&p[N]===0;)N++;for(var P=new Uint8Array(ie+(l-N)),Q=ie;N!==l;)P[Q++]=p[N++];return P}}}function z(q){var W=R(q);if(W)return W;throw new Error(`Non-${t} character`)}return{encode:O,decodeUnsafe:R,decode:z}}var R1=A1,C1=R1;const ad=n=>{if(n instanceof Uint8Array&&n.constructor.name==="Uint8Array")return n;if(n instanceof ArrayBuffer)return new Uint8Array(n);if(ArrayBuffer.isView(n))return new Uint8Array(n.buffer,n.byteOffset,n.byteLength);throw new Error("Unknown type, must be binary type")},$1=n=>new TextEncoder().encode(n),D1=n=>new TextDecoder().decode(n);class U1{constructor(t,r,s){this.name=t,this.prefix=r,this.baseEncode=s}encode(t){if(t instanceof Uint8Array)return`${this.prefix}${this.baseEncode(t)}`;throw Error("Unknown type, must be binary type")}}class j1{constructor(t,r,s){if(this.name=t,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=s}decode(t){if(typeof t=="string"){if(t.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(t)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(t.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(t){return od(this,t)}}let L1=class{constructor(t){this.decoders=t}or(t){return od(this,t)}decode(t){const r=t[0],s=this.decoders[r];if(s)return s.decode(t);throw RangeError(`Unable to decode multibase string ${JSON.stringify(t)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const od=(n,t)=>new L1({...n.decoders||{[n.prefix]:n},...t.decoders||{[t.prefix]:t}});class q1{constructor(t,r,s,a){this.name=t,this.prefix=r,this.baseEncode=s,this.baseDecode=a,this.encoder=new U1(t,r,s),this.decoder=new j1(t,r,a)}encode(t){return this.encoder.encode(t)}decode(t){return this.decoder.decode(t)}}const Ka=({name:n,prefix:t,encode:r,decode:s})=>new q1(n,t,r,s),us=({prefix:n,name:t,alphabet:r})=>{const{encode:s,decode:a}=C1(r,t);return Ka({prefix:n,name:t,encode:s,decode:c=>ad(a(c))})},M1=(n,t,r,s)=>{const a={};for(let E=0;E<t.length;++E)a[t[E]]=E;let c=n.length;for(;n[c-1]==="=";)--c;const f=new Uint8Array(c*r/8|0);let b=0,S=0,v=0;for(let E=0;E<c;++E){const O=a[n[E]];if(O===void 0)throw new SyntaxError(`Non-${s} character`);S=S<<r|O,b+=r,b>=8&&(b-=8,f[v++]=255&S>>b)}if(b>=r||255&S<<8-b)throw new SyntaxError("Unexpected end of data");return f},z1=(n,t,r)=>{const s=t[t.length-1]==="=",a=(1<<r)-1;let c="",f=0,b=0;for(let S=0;S<n.length;++S)for(b=b<<8|n[S],f+=8;f>r;)f-=r,c+=t[a&b>>f];if(f&&(c+=t[a&b<<r-f]),s)for(;c.length*r&7;)c+="=";return c},Vt=({name:n,prefix:t,bitsPerChar:r,alphabet:s})=>Ka({prefix:t,name:n,encode(a){return z1(a,s,r)},decode(a){return M1(a,s,r,n)}}),F1=Ka({prefix:"\0",name:"identity",encode:n=>D1(n),decode:n=>$1(n)});var H1=Object.freeze({__proto__:null,identity:F1});const K1=Vt({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var k1=Object.freeze({__proto__:null,base2:K1});const V1=Vt({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var B1=Object.freeze({__proto__:null,base8:V1});const G1=us({prefix:"9",name:"base10",alphabet:"0123456789"});var W1=Object.freeze({__proto__:null,base10:G1});const Q1=Vt({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),J1=Vt({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var Y1=Object.freeze({__proto__:null,base16:Q1,base16upper:J1});const Z1=Vt({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),X1=Vt({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),eE=Vt({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),tE=Vt({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),rE=Vt({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),iE=Vt({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),nE=Vt({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),sE=Vt({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),aE=Vt({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var oE=Object.freeze({__proto__:null,base32:Z1,base32upper:X1,base32pad:eE,base32padupper:tE,base32hex:rE,base32hexupper:iE,base32hexpad:nE,base32hexpadupper:sE,base32z:aE});const cE=us({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),uE=us({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var lE=Object.freeze({__proto__:null,base36:cE,base36upper:uE});const hE=us({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),fE=us({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var dE=Object.freeze({__proto__:null,base58btc:hE,base58flickr:fE});const pE=Vt({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),gE=Vt({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),yE=Vt({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),mE=Vt({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var vE=Object.freeze({__proto__:null,base64:pE,base64pad:gE,base64url:yE,base64urlpad:mE});const cd=Array.from(""),_E=cd.reduce((n,t,r)=>(n[r]=t,n),[]),bE=cd.reduce((n,t,r)=>(n[t.codePointAt(0)]=r,n),[]);function wE(n){return n.reduce((t,r)=>(t+=_E[r],t),"")}function EE(n){const t=[];for(const r of n){const s=bE[r.codePointAt(0)];if(s===void 0)throw new Error(`Non-base256emoji character: ${r}`);t.push(s)}return new Uint8Array(t)}const IE=Ka({prefix:"",name:"base256emoji",encode:wE,decode:EE});var SE=Object.freeze({__proto__:null,base256emoji:IE}),xE=ud,Yh=128,PE=127,OE=~PE,NE=Math.pow(2,31);function ud(n,t,r){t=t||[],r=r||0;for(var s=r;n>=NE;)t[r++]=n&255|Yh,n/=128;for(;n&OE;)t[r++]=n&255|Yh,n>>>=7;return t[r]=n|0,ud.bytes=r-s+1,t}var TE=Zc,AE=128,Zh=127;function Zc(n,s){var r=0,s=s||0,a=0,c=s,f,b=n.length;do{if(c>=b)throw Zc.bytes=0,new RangeError("Could not decode varint");f=n[c++],r+=a<28?(f&Zh)<<a:(f&Zh)*Math.pow(2,a),a+=7}while(f>=AE);return Zc.bytes=c-s,r}var RE=Math.pow(2,7),CE=Math.pow(2,14),$E=Math.pow(2,21),DE=Math.pow(2,28),UE=Math.pow(2,35),jE=Math.pow(2,42),LE=Math.pow(2,49),qE=Math.pow(2,56),ME=Math.pow(2,63),zE=function(n){return n<RE?1:n<CE?2:n<$E?3:n<DE?4:n<UE?5:n<jE?6:n<LE?7:n<qE?8:n<ME?9:10},FE={encode:xE,decode:TE,encodingLength:zE},ld=FE;const Xh=(n,t,r=0)=>(ld.encode(n,t,r),t),ef=n=>ld.encodingLength(n),Xc=(n,t)=>{const r=t.byteLength,s=ef(n),a=s+ef(r),c=new Uint8Array(a+r);return Xh(n,c,0),Xh(r,c,s),c.set(t,a),new HE(n,r,t,c)};let HE=class{constructor(t,r,s,a){this.code=t,this.size=r,this.digest=s,this.bytes=a}};const hd=({name:n,code:t,encode:r})=>new KE(n,t,r);class KE{constructor(t,r,s){this.name=t,this.code=r,this.encode=s}digest(t){if(t instanceof Uint8Array){const r=this.encode(t);return r instanceof Uint8Array?Xc(this.code,r):r.then(s=>Xc(this.code,s))}else throw Error("Unknown type, must be binary type")}}const fd=n=>async t=>new Uint8Array(await crypto.subtle.digest(n,t)),kE=hd({name:"sha2-256",code:18,encode:fd("SHA-256")}),VE=hd({name:"sha2-512",code:19,encode:fd("SHA-512")});var BE=Object.freeze({__proto__:null,sha256:kE,sha512:VE});const dd=0,GE="identity",pd=ad,WE=n=>Xc(dd,pd(n)),QE={code:dd,name:GE,encode:pd,digest:WE};var JE=Object.freeze({__proto__:null,identity:QE});new TextEncoder,new TextDecoder;const tf={...H1,...k1,...B1,...W1,...Y1,...oE,...lE,...dE,...vE,...SE};({...BE,...JE});function gd(n){return globalThis.Buffer!=null?new Uint8Array(n.buffer,n.byteOffset,n.byteLength):n}function YE(n=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?gd(globalThis.Buffer.allocUnsafe(n)):new Uint8Array(n)}function yd(n,t,r,s){return{name:n,prefix:t,encoder:{name:n,prefix:t,encode:r},decoder:{decode:s}}}const rf=yd("utf8","u",n=>"u"+new TextDecoder("utf8").decode(n),n=>new TextEncoder().encode(n.substring(1))),Pc=yd("ascii","a",n=>{let t="a";for(let r=0;r<n.length;r++)t+=String.fromCharCode(n[r]);return t},n=>{n=n.substring(1);const t=YE(n.length);for(let r=0;r<n.length;r++)t[r]=n.charCodeAt(r);return t}),ZE={utf8:rf,"utf-8":rf,hex:tf.base16,latin1:Pc,ascii:Pc,binary:Pc,...tf};function XE(n,t="utf8"){const r=ZE[t];if(!r)throw new Error(`Unsupported encoding "${t}"`);return(t==="utf8"||t==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?gd(globalThis.Buffer.from(n,"utf-8")):r.decoder.decode(`${r.prefix}${n}`)}const md="wc",eI=2,gu="core",xi=`${md}@2:${gu}:`,tI={name:gu,logger:"error"},rI={database:":memory:"},iI="crypto",nf="client_ed25519_seed",nI=ne.ONE_DAY,sI="keychain",aI="0.3",oI="messages",cI="0.3",uI=ne.SIX_HOURS,lI="publisher",vd="irn",hI="error",_d="wss://relay.walletconnect.com",sf="wss://relay.walletconnect.org",fI="relayer",Wt={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},dI="_subscription",ci={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},pI=ne.ONE_SECOND,gI="2.10.6",yI=1e4,mI="0.3",vI="WALLETCONNECT_CLIENT_ID",Mr={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},_I="subscription",bI="0.3",wI=ne.FIVE_SECONDS*1e3,EI="pairing",II="0.3",kn={wc_pairingDelete:{req:{ttl:ne.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:ne.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:ne.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:ne.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:ne.ONE_DAY,prompt:!1,tag:0},res:{ttl:ne.ONE_DAY,prompt:!1,tag:0}}},Yn={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},Wr={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},SI="history",xI="0.3",PI="expirer",Ar={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},OI="0.3",Oc="verify-api",mn="https://verify.walletconnect.com",eu="https://verify.walletconnect.org",NI=[mn,eu];class TI{constructor(t,r){this.core=t,this.logger=r,this.keychain=new Map,this.name=sI,this.version=aI,this.initialized=!1,this.storagePrefix=xi,this.init=async()=>{if(!this.initialized){const s=await this.getKeyChain();typeof s<"u"&&(this.keychain=s),this.initialized=!0}},this.has=s=>(this.isInitialized(),this.keychain.has(s)),this.set=async(s,a)=>{this.isInitialized(),this.keychain.set(s,a),await this.persist()},this.get=s=>{this.isInitialized();const a=this.keychain.get(s);if(typeof a>"u"){const{message:c}=He("NO_MATCHING_KEY",`${this.name}: ${s}`);throw new Error(c)}return a},this.del=async s=>{this.isInitialized(),this.keychain.delete(s),await this.persist()},this.core=t,this.logger=Ne.generateChildLogger(r,this.name)}get context(){return Ne.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(t){await this.core.storage.setItem(this.storageKey,rd(t))}async getKeyChain(){const t=await this.core.storage.getItem(this.storageKey);return typeof t<"u"?id(t):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:t}=He("NOT_INITIALIZED",this.name);throw new Error(t)}}}class AI{constructor(t,r,s){this.core=t,this.logger=r,this.name=iI,this.initialized=!1,this.init=async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)},this.hasKeys=a=>(this.isInitialized(),this.keychain.has(a)),this.getClientId=async()=>{this.isInitialized();const a=await this.getClientSeed(),c=qh(a);return Zf(c.publicKey)},this.generateKeyPair=()=>{this.isInitialized();const a=$w();return this.setPrivateKey(a.publicKey,a.privateKey)},this.signJWT=async a=>{this.isInitialized();const c=await this.getClientSeed(),f=qh(c),b=Qc();return await Rw(b,a,nI,f)},this.generateSharedKey=(a,c,f)=>{this.isInitialized();const b=this.getPrivateKey(a),S=Dw(b,c);return this.setSymKey(S,f)},this.setSymKey=async(a,c)=>{this.isInitialized();const f=c||Uw(a);return await this.keychain.set(f,a),f},this.deleteKeyPair=async a=>{this.isInitialized(),await this.keychain.del(a)},this.deleteSymKey=async a=>{this.isInitialized(),await this.keychain.del(a)},this.encode=async(a,c,f)=>{this.isInitialized();const b=td(f),S=as(c);if(zh(b)){const R=b.senderPublicKey,z=b.receiverPublicKey;a=await this.generateSharedKey(R,z)}const v=this.getSymKey(a),{type:E,senderPublicKey:O}=b;return Lw({type:E,symKey:v,message:S,senderPublicKey:O})},this.decode=async(a,c,f)=>{this.isInitialized();const b=zw(c,f);if(zh(b)){const S=b.receiverPublicKey,v=b.senderPublicKey;a=await this.generateSharedKey(S,v)}try{const S=this.getSymKey(a),v=qw({symKey:S,encoded:c});return Ma(v)}catch(S){this.logger.error(`Failed to decode message from topic: '${a}', clientId: '${await this.getClientId()}'`),this.logger.error(S)}},this.getPayloadType=a=>{const c=Oa(a);return cs(c.type)},this.getPayloadSenderPublicKey=a=>{const c=Oa(a);return c.senderPublicKey?Jt(c.senderPublicKey,sr):void 0},this.core=t,this.logger=Ne.generateChildLogger(r,this.name),this.keychain=s||new TI(this.core,this.logger)}get context(){return Ne.getLoggerContext(this.logger)}async setPrivateKey(t,r){return await this.keychain.set(t,r),t}getPrivateKey(t){return this.keychain.get(t)}async getClientSeed(){let t="";try{t=this.keychain.get(nf)}catch{t=Qc(),await this.keychain.set(nf,t)}return XE(t,"base16")}getSymKey(t){return this.keychain.get(t)}isInitialized(){if(!this.initialized){const{message:t}=He("NOT_INITIALIZED",this.name);throw new Error(t)}}}class RI extends uw{constructor(t,r){super(t,r),this.logger=t,this.core=r,this.messages=new Map,this.name=oI,this.version=cI,this.initialized=!1,this.storagePrefix=xi,this.init=async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const s=await this.getRelayerMessages();typeof s<"u"&&(this.messages=s),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(s){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(s)}finally{this.initialized=!0}}},this.set=async(s,a)=>{this.isInitialized();const c=Jc(a);let f=this.messages.get(s);return typeof f>"u"&&(f={}),typeof f[c]<"u"||(f[c]=a,this.messages.set(s,f),await this.persist()),c},this.get=s=>{this.isInitialized();let a=this.messages.get(s);return typeof a>"u"&&(a={}),a},this.has=(s,a)=>{this.isInitialized();const c=this.get(s),f=Jc(a);return typeof c[f]<"u"},this.del=async s=>{this.isInitialized(),this.messages.delete(s),await this.persist()},this.logger=Ne.generateChildLogger(t,this.name),this.core=r}get context(){return Ne.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setRelayerMessages(t){await this.core.storage.setItem(this.storageKey,rd(t))}async getRelayerMessages(){const t=await this.core.storage.getItem(this.storageKey);return typeof t<"u"?id(t):void 0}async persist(){await this.setRelayerMessages(this.messages)}isInitialized(){if(!this.initialized){const{message:t}=He("NOT_INITIALIZED",this.name);throw new Error(t)}}}class CI extends lw{constructor(t,r){super(t,r),this.relayer=t,this.logger=r,this.events=new Qr.EventEmitter,this.name=lI,this.queue=new Map,this.publishTimeout=ne.toMiliseconds(ne.TEN_SECONDS),this.needsTransportRestart=!1,this.publish=async(s,a,c)=>{var f;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:s,message:a,opts:c}});try{const b=(c==null?void 0:c.ttl)||uI,S=Yc(c),v=(c==null?void 0:c.prompt)||!1,E=(c==null?void 0:c.tag)||0,O=(c==null?void 0:c.id)||T_().toString(),R={topic:s,message:a,opts:{ttl:b,relay:S,prompt:v,tag:E,id:O}},z=setTimeout(()=>this.queue.set(O,R),this.publishTimeout);try{await await ss(this.rpcPublish(s,a,b,S,v,E,O),this.publishTimeout,"Failed to publish payload, please try again."),this.removeRequestFromQueue(O),this.relayer.events.emit(Wt.publish,R)}catch(q){if(this.logger.debug("Publishing Payload stalled"),this.needsTransportRestart=!0,(f=c==null?void 0:c.internal)!=null&&f.throwOnFailedPublish)throw this.removeRequestFromQueue(O),q;return}finally{clearTimeout(z)}this.logger.debug("Successfully Published Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:s,message:a,opts:c}})}catch(b){throw this.logger.debug("Failed to Publish Payload"),this.logger.error(b),b}},this.on=(s,a)=>{this.events.on(s,a)},this.once=(s,a)=>{this.events.once(s,a)},this.off=(s,a)=>{this.events.off(s,a)},this.removeListener=(s,a)=>{this.events.removeListener(s,a)},this.relayer=t,this.logger=Ne.generateChildLogger(r,this.name),this.registerEventListeners()}get context(){return Ne.getLoggerContext(this.logger)}rpcPublish(t,r,s,a,c,f,b){var S,v,E,O;const R={method:Sa(a.protocol).publish,params:{topic:t,message:r,ttl:s,prompt:c,tag:f},id:b};return Na((S=R.params)==null?void 0:S.prompt)&&((v=R.params)==null||delete v.prompt),Na((E=R.params)==null?void 0:E.tag)&&((O=R.params)==null||delete O.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:R}),this.relayer.request(R)}removeRequestFromQueue(t){this.queue.delete(t)}checkQueue(){this.queue.forEach(async t=>{const{topic:r,message:s,opts:a}=t;await this.publish(r,s,a)})}registerEventListeners(){this.relayer.core.heartbeat.on(_n.HEARTBEAT_EVENTS.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(Wt.connection_stalled);return}this.checkQueue()}),this.relayer.on(Wt.message_ack,t=>{this.removeRequestFromQueue(t.id.toString())})}}class $I{constructor(){this.map=new Map,this.set=(t,r)=>{const s=this.get(t);this.exists(t,r)||this.map.set(t,[...s,r])},this.get=t=>this.map.get(t)||[],this.exists=(t,r)=>this.get(t).includes(r),this.delete=(t,r)=>{if(typeof r>"u"){this.map.delete(t);return}if(!this.map.has(t))return;const s=this.get(t);if(!this.exists(t,r))return;const a=s.filter(c=>c!==r);if(!a.length){this.map.delete(t);return}this.map.set(t,a)},this.clear=()=>{this.map.clear()}}get topics(){return Array.from(this.map.keys())}}var DI=Object.defineProperty,UI=Object.defineProperties,jI=Object.getOwnPropertyDescriptors,af=Object.getOwnPropertySymbols,LI=Object.prototype.hasOwnProperty,qI=Object.prototype.propertyIsEnumerable,of=(n,t,r)=>t in n?DI(n,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[t]=r,Vn=(n,t)=>{for(var r in t||(t={}))LI.call(t,r)&&of(n,r,t[r]);if(af)for(var r of af(t))qI.call(t,r)&&of(n,r,t[r]);return n},Nc=(n,t)=>UI(n,jI(t));class MI extends dw{constructor(t,r){super(t,r),this.relayer=t,this.logger=r,this.subscriptions=new Map,this.topicMap=new $I,this.events=new Qr.EventEmitter,this.name=_I,this.version=bI,this.pending=new Map,this.cached=[],this.initialized=!1,this.pendingSubscriptionWatchLabel="pending_sub_watch_label",this.pollingInterval=20,this.storagePrefix=xi,this.subscribeTimeout=1e4,this.restartInProgress=!1,this.batchSubscribeTopicsLimit=500,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),this.clientId=await this.relayer.core.crypto.getClientId())},this.subscribe=async(s,a)=>{await this.restartToComplete(),this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:s,opts:a}});try{const c=Yc(a),f={topic:s,relay:c};this.pending.set(s,f);const b=await this.rpcSubscribe(s,c);return this.onSubscribe(b,f),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:s,opts:a}}),b}catch(c){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(c),c}},this.unsubscribe=async(s,a)=>{await this.restartToComplete(),this.isInitialized(),typeof(a==null?void 0:a.id)<"u"?await this.unsubscribeById(s,a.id,a):await this.unsubscribeByTopic(s,a)},this.isSubscribed=async s=>this.topics.includes(s)?!0:await new Promise((a,c)=>{const f=new ne.Watch;f.start(this.pendingSubscriptionWatchLabel);const b=setInterval(()=>{!this.pending.has(s)&&this.topics.includes(s)&&(clearInterval(b),f.stop(this.pendingSubscriptionWatchLabel),a(!0)),f.elapsed(this.pendingSubscriptionWatchLabel)>=wI&&(clearInterval(b),f.stop(this.pendingSubscriptionWatchLabel),c(new Error("Subscription resolution timeout")))},this.pollingInterval)}).catch(()=>!1),this.on=(s,a)=>{this.events.on(s,a)},this.once=(s,a)=>{this.events.once(s,a)},this.off=(s,a)=>{this.events.off(s,a)},this.removeListener=(s,a)=>{this.events.removeListener(s,a)},this.restart=async()=>{this.restartInProgress=!0,await this.restore(),await this.reset(),this.restartInProgress=!1},this.relayer=t,this.logger=Ne.generateChildLogger(r,this.name),this.clientId=""}get context(){return Ne.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}hasSubscription(t,r){let s=!1;try{s=this.getSubscription(t).topic===r}catch{}return s}onEnable(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(t,r){const s=this.topicMap.get(t);await Promise.all(s.map(async a=>await this.unsubscribeById(t,a,r)))}async unsubscribeById(t,r,s){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:t,id:r,opts:s}});try{const a=Yc(s);await this.rpcUnsubscribe(t,r,a);const c=Jn("USER_DISCONNECTED",`${this.name}, ${t}`);await this.onUnsubscribe(t,r,c),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:t,id:r,opts:s}})}catch(a){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(a),a}}async rpcSubscribe(t,r){const s={method:Sa(r.protocol).subscribe,params:{topic:t}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s});try{await await ss(this.relayer.request(s),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(Wt.connection_stalled)}return Jc(t+this.clientId)}async rpcBatchSubscribe(t){if(!t.length)return;const r=t[0].relay,s={method:Sa(r.protocol).batchSubscribe,params:{topics:t.map(a=>a.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s});try{return await await ss(this.relayer.request(s),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Payload stalled"),this.relayer.events.emit(Wt.connection_stalled)}}rpcUnsubscribe(t,r,s){const a={method:Sa(s.protocol).unsubscribe,params:{topic:t,id:r}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:a}),this.relayer.request(a)}onSubscribe(t,r){this.setSubscription(t,Nc(Vn({},r),{id:t})),this.pending.delete(r.topic)}onBatchSubscribe(t){t.length&&t.forEach(r=>{this.setSubscription(r.id,Vn({},r)),this.pending.delete(r.topic)})}async onUnsubscribe(t,r,s){this.events.removeAllListeners(r),this.hasSubscription(r,t)&&this.deleteSubscription(r,s),await this.relayer.messages.del(t)}async setRelayerSubscriptions(t){await this.relayer.core.storage.setItem(this.storageKey,t)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(t,r){this.subscriptions.has(t)||(this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:t,subscription:r}),this.addSubscription(t,r))}addSubscription(t,r){this.subscriptions.set(t,Vn({},r)),this.topicMap.set(r.topic,t),this.events.emit(Mr.created,r)}getSubscription(t){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:t});const r=this.subscriptions.get(t);if(!r){const{message:s}=He("NO_MATCHING_KEY",`${this.name}: ${t}`);throw new Error(s)}return r}deleteSubscription(t,r){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:t,reason:r});const s=this.getSubscription(t);this.subscriptions.delete(t),this.topicMap.delete(s.topic,t),this.events.emit(Mr.deleted,Nc(Vn({},s),{reason:r}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(Mr.sync)}async reset(){if(this.cached.length){const t=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let r=0;r<t;r++){const s=this.cached.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(s)}}this.events.emit(Mr.resubscribed)}async restore(){try{const t=await this.getRelayerSubscriptions();if(typeof t>"u"||!t.length)return;if(this.subscriptions.size){const{message:r}=He("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(r)}this.cached=t,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(t){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(t)}}async batchSubscribe(t){if(!t.length)return;const r=await this.rpcBatchSubscribe(t);d1(r)&&this.onBatchSubscribe(r.map((s,a)=>Nc(Vn({},t[a]),{id:s})))}async onConnect(){this.restartInProgress||(await this.restart(),this.onEnable())}onDisconnect(){this.onDisable()}async checkPending(){if(!this.initialized||this.relayer.transportExplicitlyClosed)return;const t=[];this.pending.forEach(r=>{t.push(r)}),await this.batchSubscribe(t)}registerEventListeners(){this.relayer.core.heartbeat.on(_n.HEARTBEAT_EVENTS.pulse,async()=>{await this.checkPending()}),this.relayer.on(Wt.connect,async()=>{await this.onConnect()}),this.relayer.on(Wt.disconnect,()=>{this.onDisconnect()}),this.events.on(Mr.created,async t=>{const r=Mr.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),await this.persist()}),this.events.on(Mr.deleted,async t=>{const r=Mr.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),await this.persist()})}isInitialized(){if(!this.initialized){const{message:t}=He("NOT_INITIALIZED",this.name);throw new Error(t)}}async restartToComplete(){this.restartInProgress&&await new Promise(t=>{const r=setInterval(()=>{this.restartInProgress||(clearInterval(r),t())},this.pollingInterval)})}}var zI=Object.defineProperty,cf=Object.getOwnPropertySymbols,FI=Object.prototype.hasOwnProperty,HI=Object.prototype.propertyIsEnumerable,uf=(n,t,r)=>t in n?zI(n,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[t]=r,KI=(n,t)=>{for(var r in t||(t={}))FI.call(t,r)&&uf(n,r,t[r]);if(cf)for(var r of cf(t))HI.call(t,r)&&uf(n,r,t[r]);return n};class kI extends hw{constructor(t){super(t),this.protocol="wc",this.version=2,this.events=new Qr.EventEmitter,this.name=fI,this.transportExplicitlyClosed=!1,this.initialized=!1,this.connectionAttemptInProgress=!1,this.connectionStatusPollingInterval=20,this.staleConnectionErrors=["socket hang up","socket stalled"],this.hasExperiencedNetworkDisruption=!1,this.request=async r=>{this.logger.debug("Publishing Request Payload");try{return await this.toEstablishConnection(),await this.provider.request(r)}catch(s){throw this.logger.debug("Failed to Publish Request"),this.logger.error(s),s}},this.onPayloadHandler=r=>{this.onProviderPayload(r)},this.onConnectHandler=()=>{this.events.emit(Wt.connect)},this.onDisconnectHandler=()=>{this.onProviderDisconnect()},this.onProviderErrorHandler=r=>{this.logger.error(r),this.events.emit(Wt.error,r),this.logger.info("Fatal socket error received, closing transport"),this.transportClose()},this.registerProviderListeners=()=>{this.provider.on(ci.payload,this.onPayloadHandler),this.provider.on(ci.connect,this.onConnectHandler),this.provider.on(ci.disconnect,this.onDisconnectHandler),this.provider.on(ci.error,this.onProviderErrorHandler)},this.core=t.core,this.logger=typeof t.logger<"u"&&typeof t.logger!="string"?Ne.generateChildLogger(t.logger,this.name):Ne.pino(Ne.getDefaultLoggerOptions({level:t.logger||hI})),this.messages=new RI(this.logger,t.core),this.subscriber=new MI(this,this.logger),this.publisher=new CI(this,this.logger),this.relayUrl=(t==null?void 0:t.relayUrl)||_d,this.projectId=t.projectId,this.bundleId=Bw(),this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await this.createProvider(),await Promise.all([this.messages.init(),this.subscriber.init()]);try{await this.transportOpen()}catch{this.logger.warn(`Connection via ${this.relayUrl} failed, attempting to connect via failover domain ${sf}...`),await this.restartTransport(sf)}this.initialized=!0,setTimeout(async()=>{this.subscriber.topics.length===0&&(this.logger.info("No topics subscribed to after init, closing transport"),await this.transportClose(),this.transportExplicitlyClosed=!1)},yI)}get context(){return Ne.getLoggerContext(this.logger)}get connected(){return this.provider.connection.connected}get connecting(){return this.provider.connection.connecting}async publish(t,r,s){this.isInitialized(),await this.publisher.publish(t,r,s),await this.recordMessageEvent({topic:t,message:r,publishedAt:Date.now()})}async subscribe(t,r){var s;this.isInitialized();let a=((s=this.subscriber.topicMap.get(t))==null?void 0:s[0])||"";if(a)return a;let c;const f=b=>{b.topic===t&&(this.subscriber.off(Mr.created,f),c())};return await Promise.all([new Promise(b=>{c=b,this.subscriber.on(Mr.created,f)}),new Promise(async b=>{a=await this.subscriber.subscribe(t,r),b()})]),a}async unsubscribe(t,r){this.isInitialized(),await this.subscriber.unsubscribe(t,r)}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}off(t,r){this.events.off(t,r)}removeListener(t,r){this.events.removeListener(t,r)}async transportClose(){this.transportExplicitlyClosed=!0,this.hasExperiencedNetworkDisruption&&this.connected?await ss(this.provider.disconnect(),1e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.connected&&await this.provider.disconnect()}async transportOpen(t){if(this.transportExplicitlyClosed=!1,await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress){t&&t!==this.relayUrl&&(this.relayUrl=t,await this.transportClose(),await this.createProvider()),this.connectionAttemptInProgress=!0;try{await Promise.all([new Promise(r=>{if(!this.initialized)return r();this.subscriber.once(Mr.resubscribed,()=>{r()})}),new Promise(async(r,s)=>{try{await ss(this.provider.connect(),1e4,`Socket stalled when trying to connect to ${this.relayUrl}`)}catch(a){s(a);return}r()})])}catch(r){this.logger.error(r);const s=r;if(!this.isConnectionStalled(s.message))throw r;this.provider.events.emit(ci.disconnect)}finally{this.connectionAttemptInProgress=!1,this.hasExperiencedNetworkDisruption=!1}}}async restartTransport(t){await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress&&(this.relayUrl=t||this.relayUrl,await this.transportClose(),await this.createProvider(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await Wh())throw new Error("No internet connection detected. Please restart your network and try again.")}isConnectionStalled(t){return this.staleConnectionErrors.some(r=>t.includes(r))}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const t=await this.core.crypto.signJWT(this.relayUrl);this.provider=new hi(new P1(Yw({sdkVersion:gI,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:t,useOnCloseEvent:!0,bundleId:this.bundleId}))),this.registerProviderListeners()}async recordMessageEvent(t){const{topic:r,message:s}=t;await this.messages.set(r,s)}async shouldIgnoreMessageEvent(t){const{topic:r,message:s}=t;if(!s||s.length===0)return this.logger.debug(`Ignoring invalid/empty message: ${s}`),!0;if(!await this.subscriber.isSubscribed(r))return this.logger.debug(`Ignoring message for non-subscribed topic ${r}`),!0;const a=this.messages.has(r,s);return a&&this.logger.debug(`Ignoring duplicate message: ${s}`),a}async onProviderPayload(t){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:t}),ou(t)){if(!t.method.endsWith(dI))return;const r=t.params,{topic:s,message:a,publishedAt:c}=r.data,f={topic:s,message:a,publishedAt:c};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(KI({type:"event",event:r.id},f)),this.events.emit(r.id,f),await this.acknowledgePayload(t),await this.onMessageEvent(f)}else cu(t)&&this.events.emit(Wt.message_ack,t)}async onMessageEvent(t){await this.shouldIgnoreMessageEvent(t)||(this.events.emit(Wt.message,t),await this.recordMessageEvent(t))}async acknowledgePayload(t){const r=uu(t.id,!0);await this.provider.connection.send(r)}unregisterProviderListeners(){this.provider.off(ci.payload,this.onPayloadHandler),this.provider.off(ci.connect,this.onConnectHandler),this.provider.off(ci.disconnect,this.onDisconnectHandler),this.provider.off(ci.error,this.onProviderErrorHandler)}async registerEventListeners(){this.events.on(Wt.connection_stalled,()=>{this.restartTransport().catch(r=>this.logger.error(r))});let t=await Wh();b1(async r=>{this.initialized&&t!==r&&(t=r,r?await this.restartTransport().catch(s=>this.logger.error(s)):(this.hasExperiencedNetworkDisruption=!0,await this.transportClose().catch(s=>this.logger.error(s))))})}onProviderDisconnect(){this.events.emit(Wt.disconnect),this.attemptToReconnect()}attemptToReconnect(){this.transportExplicitlyClosed||(this.logger.info("attemptToReconnect called. Connecting..."),setTimeout(async()=>{await this.restartTransport().catch(t=>this.logger.error(t))},ne.toMiliseconds(pI)))}isInitialized(){if(!this.initialized){const{message:t}=He("NOT_INITIALIZED",this.name);throw new Error(t)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectionAttemptInProgress)return await new Promise(t=>{const r=setInterval(()=>{this.connected&&(clearInterval(r),t())},this.connectionStatusPollingInterval)});await this.restartTransport()}}}var VI=Object.defineProperty,lf=Object.getOwnPropertySymbols,BI=Object.prototype.hasOwnProperty,GI=Object.prototype.propertyIsEnumerable,hf=(n,t,r)=>t in n?VI(n,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[t]=r,ff=(n,t)=>{for(var r in t||(t={}))BI.call(t,r)&&hf(n,r,t[r]);if(lf)for(var r of lf(t))GI.call(t,r)&&hf(n,r,t[r]);return n};class ka extends fw{constructor(t,r,s,a=xi,c=void 0){super(t,r,s,a),this.core=t,this.logger=r,this.name=s,this.map=new Map,this.version=mI,this.cached=[],this.initialized=!1,this.storagePrefix=xi,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(f=>{this.getKey&&f!==null&&!Na(f)?this.map.set(this.getKey(f),f):g1(f)?this.map.set(f.id,f):y1(f)&&this.map.set(f.topic,f)}),this.cached=[],this.initialized=!0)},this.set=async(f,b)=>{this.isInitialized(),this.map.has(f)?await this.update(f,b):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:f,value:b}),this.map.set(f,b),await this.persist())},this.get=f=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:f}),this.getData(f)),this.getAll=f=>(this.isInitialized(),f?this.values.filter(b=>Object.keys(f).every(S=>N1(b[S],f[S]))):this.values),this.update=async(f,b)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:f,update:b});const S=ff(ff({},this.getData(f)),b);this.map.set(f,S),await this.persist()},this.delete=async(f,b)=>{this.isInitialized(),this.map.has(f)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:f,reason:b}),this.map.delete(f),await this.persist())},this.logger=Ne.generateChildLogger(r,this.name),this.storagePrefix=a,this.getKey=c}get context(){return Ne.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}async setDataStore(t){await this.core.storage.setItem(this.storageKey,t)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(t){const r=this.map.get(t);if(!r){const{message:s}=He("NO_MATCHING_KEY",`${this.name}: ${t}`);throw this.logger.error(s),new Error(s)}return r}async persist(){await this.setDataStore(this.values)}async restore(){try{const t=await this.getDataStore();if(typeof t>"u"||!t.length)return;if(this.map.size){const{message:r}=He("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=t,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(t){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(t)}}isInitialized(){if(!this.initialized){const{message:t}=He("NOT_INITIALIZED",this.name);throw new Error(t)}}}class WI{constructor(t,r){this.core=t,this.logger=r,this.name=EI,this.version=II,this.events=new su,this.initialized=!1,this.storagePrefix=xi,this.ignoredPayloadTypes=[bn],this.registeredMethods=[],this.init=async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))},this.register=({methods:s})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...s])]},this.create=async()=>{this.isInitialized();const s=Qc(),a=await this.core.crypto.setSymKey(s),c=Ia(ne.FIVE_MINUTES),f={protocol:vd},b={topic:a,expiry:c,relay:f,active:!1},S=l1({protocol:this.core.protocol,version:this.core.version,topic:a,symKey:s,relay:f});return await this.pairings.set(a,b),await this.core.relayer.subscribe(a),this.core.expirer.set(a,c),{topic:a,uri:S}},this.pair=async s=>{this.isInitialized(),this.isValidPair(s);const{topic:a,symKey:c,relay:f}=Gh(s.uri);let b;if(this.pairings.keys.includes(a)&&(b=this.pairings.get(a),b.active))throw new Error(`Pairing already exists: ${a}. Please try again with a new connection URI.`);const S=Ia(ne.FIVE_MINUTES),v={topic:a,relay:f,expiry:S,active:!1};return await this.pairings.set(a,v),this.core.expirer.set(a,S),s.activatePairing&&await this.activate({topic:a}),this.events.emit(Yn.create,v),this.core.crypto.keychain.has(a)||(await this.core.crypto.setSymKey(c,a),await this.core.relayer.subscribe(a,{relay:f})),v},this.activate=async({topic:s})=>{this.isInitialized();const a=Ia(ne.THIRTY_DAYS);await this.pairings.update(s,{active:!0,expiry:a}),this.core.expirer.set(s,a)},this.ping=async s=>{this.isInitialized(),await this.isValidPing(s);const{topic:a}=s;if(this.pairings.keys.includes(a)){const c=await this.sendRequest(a,"wc_pairingPing",{}),{done:f,resolve:b,reject:S}=Zw();this.events.once(Sc("pairing_ping",c),({error:v})=>{v?S(v):b()}),await f()}},this.updateExpiry=async({topic:s,expiry:a})=>{this.isInitialized(),await this.pairings.update(s,{expiry:a})},this.updateMetadata=async({topic:s,metadata:a})=>{this.isInitialized(),await this.pairings.update(s,{peerMetadata:a})},this.getPairings=()=>(this.isInitialized(),this.pairings.values),this.disconnect=async s=>{this.isInitialized(),await this.isValidDisconnect(s);const{topic:a}=s;this.pairings.keys.includes(a)&&(await this.sendRequest(a,"wc_pairingDelete",Jn("USER_DISCONNECTED")),await this.deletePairing(a))},this.sendRequest=async(s,a,c)=>{const f=es(a,c),b=await this.core.crypto.encode(s,f),S=kn[a].req;return this.core.history.set(s,f),this.core.relayer.publish(s,b,S),f.id},this.sendResult=async(s,a,c)=>{const f=uu(s,c),b=await this.core.crypto.encode(a,f),S=await this.core.history.get(a,s),v=kn[S.request.method].res;await this.core.relayer.publish(a,b,v),await this.core.history.resolve(f)},this.sendError=async(s,a,c)=>{const f=au(s,c),b=await this.core.crypto.encode(a,f),S=await this.core.history.get(a,s),v=kn[S.request.method]?kn[S.request.method].res:kn.unregistered_method.res;await this.core.relayer.publish(a,b,v),await this.core.history.resolve(f)},this.deletePairing=async(s,a)=>{await this.core.relayer.unsubscribe(s),await Promise.all([this.pairings.delete(s,Jn("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(s),a?Promise.resolve():this.core.expirer.del(s)])},this.cleanup=async()=>{const s=this.pairings.getAll().filter(a=>kh(a.expiry));await Promise.all(s.map(a=>this.deletePairing(a.topic)))},this.onRelayEventRequest=s=>{const{topic:a,payload:c}=s;switch(c.method){case"wc_pairingPing":return this.onPairingPingRequest(a,c);case"wc_pairingDelete":return this.onPairingDeleteRequest(a,c);default:return this.onUnknownRpcMethodRequest(a,c)}},this.onRelayEventResponse=async s=>{const{topic:a,payload:c}=s,f=(await this.core.history.get(a,c.id)).request.method;switch(f){case"wc_pairingPing":return this.onPairingPingResponse(a,c);default:return this.onUnknownRpcMethodResponse(f)}},this.onPairingPingRequest=async(s,a)=>{const{id:c}=a;try{this.isValidPing({topic:s}),await this.sendResult(c,s,!0),this.events.emit(Yn.ping,{id:c,topic:s})}catch(f){await this.sendError(c,s,f),this.logger.error(f)}},this.onPairingPingResponse=(s,a)=>{const{id:c}=a;setTimeout(()=>{Si(a)?this.events.emit(Sc("pairing_ping",c),{}):li(a)&&this.events.emit(Sc("pairing_ping",c),{error:a.error})},500)},this.onPairingDeleteRequest=async(s,a)=>{const{id:c}=a;try{this.isValidDisconnect({topic:s}),await this.deletePairing(s),this.events.emit(Yn.delete,{id:c,topic:s})}catch(f){await this.sendError(c,s,f),this.logger.error(f)}},this.onUnknownRpcMethodRequest=async(s,a)=>{const{id:c,method:f}=a;try{if(this.registeredMethods.includes(f))return;const b=Jn("WC_METHOD_UNSUPPORTED",f);await this.sendError(c,s,b),this.logger.error(b)}catch(b){await this.sendError(c,s,b),this.logger.error(b)}},this.onUnknownRpcMethodResponse=s=>{this.registeredMethods.includes(s)||this.logger.error(Jn("WC_METHOD_UNSUPPORTED",s))},this.isValidPair=s=>{var a;if(!xc(s)){const{message:f}=He("MISSING_OR_INVALID",`pair() params: ${s}`);throw new Error(f)}if(!p1(s.uri)){const{message:f}=He("MISSING_OR_INVALID",`pair() uri: ${s.uri}`);throw new Error(f)}const c=Gh(s.uri);if(!((a=c==null?void 0:c.relay)!=null&&a.protocol)){const{message:f}=He("MISSING_OR_INVALID","pair() uri#relay-protocol");throw new Error(f)}if(!(c!=null&&c.symKey)){const{message:f}=He("MISSING_OR_INVALID","pair() uri#symKey");throw new Error(f)}},this.isValidPing=async s=>{if(!xc(s)){const{message:c}=He("MISSING_OR_INVALID",`ping() params: ${s}`);throw new Error(c)}const{topic:a}=s;await this.isValidPairingTopic(a)},this.isValidDisconnect=async s=>{if(!xc(s)){const{message:c}=He("MISSING_OR_INVALID",`disconnect() params: ${s}`);throw new Error(c)}const{topic:a}=s;await this.isValidPairingTopic(a)},this.isValidPairingTopic=async s=>{if(!sd(s,!1)){const{message:a}=He("MISSING_OR_INVALID",`pairing topic should be a string: ${s}`);throw new Error(a)}if(!this.pairings.keys.includes(s)){const{message:a}=He("NO_MATCHING_KEY",`pairing topic doesn't exist: ${s}`);throw new Error(a)}if(kh(this.pairings.get(s).expiry)){await this.deletePairing(s);const{message:a}=He("EXPIRED",`pairing topic: ${s}`);throw new Error(a)}},this.core=t,this.logger=Ne.generateChildLogger(r,this.name),this.pairings=new ka(this.core,this.logger,this.name,this.storagePrefix)}get context(){return Ne.getLoggerContext(this.logger)}isInitialized(){if(!this.initialized){const{message:t}=He("NOT_INITIALIZED",this.name);throw new Error(t)}}registerRelayerEvents(){this.core.relayer.on(Wt.message,async t=>{const{topic:r,message:s}=t;if(!this.pairings.keys.includes(r)||this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(s)))return;const a=await this.core.crypto.decode(r,s);try{ou(a)?(this.core.history.set(r,a),this.onRelayEventRequest({topic:r,payload:a})):cu(a)&&(await this.core.history.resolve(a),await this.onRelayEventResponse({topic:r,payload:a}),this.core.history.delete(r,a.id))}catch(c){this.logger.error(c)}})}registerExpirerEvents(){this.core.expirer.on(Ar.expired,async t=>{const{topic:r}=t1(t.target);r&&this.pairings.keys.includes(r)&&(await this.deletePairing(r,!0),this.events.emit(Yn.expire,{topic:r}))})}}let QI=class extends cw{constructor(t,r){super(t,r),this.core=t,this.logger=r,this.records=new Map,this.events=new Qr.EventEmitter,this.name=SI,this.version=xI,this.cached=[],this.initialized=!1,this.storagePrefix=xi,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(s=>this.records.set(s.id,s)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.set=(s,a,c)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:s,request:a,chainId:c}),this.records.has(a.id))return;const f={id:a.id,topic:s,request:{method:a.method,params:a.params||null},chainId:c,expiry:Ia(ne.THIRTY_DAYS)};this.records.set(f.id,f),this.events.emit(Wr.created,f)},this.resolve=async s=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:s}),!this.records.has(s.id))return;const a=await this.getRecord(s.id);typeof a.response>"u"&&(a.response=li(s)?{error:s.error}:{result:s.result},this.records.set(a.id,a),this.events.emit(Wr.updated,a))},this.get=async(s,a)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:s,id:a}),await this.getRecord(a)),this.delete=(s,a)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:a}),this.values.forEach(c=>{if(c.topic===s){if(typeof a<"u"&&c.id!==a)return;this.records.delete(c.id),this.events.emit(Wr.deleted,c)}})},this.exists=async(s,a)=>(this.isInitialized(),this.records.has(a)?(await this.getRecord(a)).topic===s:!1),this.on=(s,a)=>{this.events.on(s,a)},this.once=(s,a)=>{this.events.once(s,a)},this.off=(s,a)=>{this.events.off(s,a)},this.removeListener=(s,a)=>{this.events.removeListener(s,a)},this.logger=Ne.generateChildLogger(r,this.name)}get context(){return Ne.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const t=[];return this.values.forEach(r=>{if(typeof r.response<"u")return;const s={topic:r.topic,request:es(r.request.method,r.request.params,r.id),chainId:r.chainId};return t.push(s)}),t}async setJsonRpcRecords(t){await this.core.storage.setItem(this.storageKey,t)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(t){this.isInitialized();const r=this.records.get(t);if(!r){const{message:s}=He("NO_MATCHING_KEY",`${this.name}: ${t}`);throw new Error(s)}return r}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(Wr.sync)}async restore(){try{const t=await this.getJsonRpcRecords();if(typeof t>"u"||!t.length)return;if(this.records.size){const{message:r}=He("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=t,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(t){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(t)}}registerEventListeners(){this.events.on(Wr.created,t=>{const r=Wr.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:t}),this.persist()}),this.events.on(Wr.updated,t=>{const r=Wr.updated;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:t}),this.persist()}),this.events.on(Wr.deleted,t=>{const r=Wr.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:t}),this.persist()}),this.core.heartbeat.on(_n.HEARTBEAT_EVENTS.pulse,()=>{this.cleanup()})}cleanup(){try{this.records.forEach(t=>{ne.toMiliseconds(t.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${t.id}`),this.delete(t.topic,t.id))})}catch(t){this.logger.warn(t)}}isInitialized(){if(!this.initialized){const{message:t}=He("NOT_INITIALIZED",this.name);throw new Error(t)}}},JI=class extends pw{constructor(t,r){super(t,r),this.core=t,this.logger=r,this.expirations=new Map,this.events=new Qr.EventEmitter,this.name=PI,this.version=OI,this.cached=[],this.initialized=!1,this.storagePrefix=xi,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(s=>this.expirations.set(s.target,s)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.has=s=>{try{const a=this.formatTarget(s);return typeof this.getExpiration(a)<"u"}catch{return!1}},this.set=(s,a)=>{this.isInitialized();const c=this.formatTarget(s),f={target:c,expiry:a};this.expirations.set(c,f),this.checkExpiry(c,f),this.events.emit(Ar.created,{target:c,expiration:f})},this.get=s=>{this.isInitialized();const a=this.formatTarget(s);return this.getExpiration(a)},this.del=s=>{if(this.isInitialized(),this.has(s)){const a=this.formatTarget(s),c=this.getExpiration(a);this.expirations.delete(a),this.events.emit(Ar.deleted,{target:a,expiration:c})}},this.on=(s,a)=>{this.events.on(s,a)},this.once=(s,a)=>{this.events.once(s,a)},this.off=(s,a)=>{this.events.off(s,a)},this.removeListener=(s,a)=>{this.events.removeListener(s,a)},this.logger=Ne.generateChildLogger(r,this.name)}get context(){return Ne.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(t){if(typeof t=="string")return Xw(t);if(typeof t=="number")return e1(t);const{message:r}=He("UNKNOWN_TYPE",`Target type: ${typeof t}`);throw new Error(r)}async setExpirations(t){await this.core.storage.setItem(this.storageKey,t)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(Ar.sync)}async restore(){try{const t=await this.getExpirations();if(typeof t>"u"||!t.length)return;if(this.expirations.size){const{message:r}=He("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=t,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(t){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(t)}}getExpiration(t){const r=this.expirations.get(t);if(!r){const{message:s}=He("NO_MATCHING_KEY",`${this.name}: ${t}`);throw this.logger.error(s),new Error(s)}return r}checkExpiry(t,r){const{expiry:s}=r;ne.toMiliseconds(s)-Date.now()<=0&&this.expire(t,r)}expire(t,r){this.expirations.delete(t),this.events.emit(Ar.expired,{target:t,expiration:r})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((t,r)=>this.checkExpiry(r,t))}registerEventListeners(){this.core.heartbeat.on(_n.HEARTBEAT_EVENTS.pulse,()=>this.checkExpirations()),this.events.on(Ar.created,t=>{const r=Ar.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),this.persist()}),this.events.on(Ar.expired,t=>{const r=Ar.expired;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),this.persist()}),this.events.on(Ar.deleted,t=>{const r=Ar.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),this.persist()})}isInitialized(){if(!this.initialized){const{message:t}=He("NOT_INITIALIZED",this.name);throw new Error(t)}}};class YI extends gw{constructor(t,r){super(t,r),this.projectId=t,this.logger=r,this.name=Oc,this.initialized=!1,this.queue=[],this.verifyDisabled=!1,this.init=async s=>{if(this.verifyDisabled||wn()||!Fa())return;const a=this.getVerifyUrl(s==null?void 0:s.verifyUrl);this.verifyUrl!==a&&this.removeIframe(),this.verifyUrl=a;try{await this.createIframe()}catch(c){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(c)}if(!this.initialized){this.removeIframe(),this.verifyUrl=eu;try{await this.createIframe()}catch(c){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(c),this.verifyDisabled=!0}}},this.register=async s=>{this.initialized?this.sendPost(s.attestationId):(this.addToQueue(s.attestationId),await this.init())},this.resolve=async s=>{if(this.isDevEnv)return"";const a=this.getVerifyUrl(s==null?void 0:s.verifyUrl);let c;try{c=await this.fetchAttestation(s.attestationId,a)}catch(f){this.logger.info(`failed to resolve attestation: ${s.attestationId} from url: ${a}`),this.logger.info(f),c=await this.fetchAttestation(s.attestationId,eu)}return c},this.fetchAttestation=async(s,a)=>{this.logger.info(`resolving attestation: ${s} from url: ${a}`);const c=this.startAbortTimer(ne.ONE_SECOND*2),f=await fetch(`${a}/attestation/${s}`,{signal:this.abortController.signal});return clearTimeout(c),f.status===200?await f.json():void 0},this.addToQueue=s=>{this.queue.push(s)},this.processQueue=()=>{this.queue.length!==0&&(this.queue.forEach(s=>this.sendPost(s)),this.queue=[])},this.sendPost=s=>{var a;try{if(!this.iframe)return;(a=this.iframe.contentWindow)==null||a.postMessage(s,"*"),this.logger.info(`postMessage sent: ${s} ${this.verifyUrl}`)}catch{}},this.createIframe=async()=>{let s;const a=c=>{c.data==="verify_ready"&&(this.initialized=!0,this.processQueue(),window.removeEventListener("message",a),s())};await Promise.race([new Promise(c=>{if(document.getElementById(Oc))return c();window.addEventListener("message",a);const f=document.createElement("iframe");f.id=Oc,f.src=`${this.verifyUrl}/${this.projectId}`,f.style.display="none",document.body.append(f),this.iframe=f,s=c}),new Promise((c,f)=>setTimeout(()=>{window.removeEventListener("message",a),f("verify iframe load timeout")},ne.toMiliseconds(ne.FIVE_SECONDS)))])},this.removeIframe=()=>{this.iframe&&(this.iframe.remove(),this.iframe=void 0,this.initialized=!1)},this.getVerifyUrl=s=>{let a=s||mn;return NI.includes(a)||(this.logger.info(`verify url: ${a}, not included in trusted list, assigning default: ${mn}`),a=mn),a},this.logger=Ne.generateChildLogger(r,this.name),this.verifyUrl=mn,this.abortController=new AbortController,this.isDevEnv=pu()&&T1.IS_VITEST}get context(){return Ne.getLoggerContext(this.logger)}startAbortTimer(t){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),ne.toMiliseconds(t))}}var ZI=Object.defineProperty,df=Object.getOwnPropertySymbols,XI=Object.prototype.hasOwnProperty,eS=Object.prototype.propertyIsEnumerable,pf=(n,t,r)=>t in n?ZI(n,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[t]=r,gf=(n,t)=>{for(var r in t||(t={}))XI.call(t,r)&&pf(n,r,t[r]);if(df)for(var r of df(t))eS.call(t,r)&&pf(n,r,t[r]);return n};let tS=class bd extends ow{constructor(t){super(t),this.protocol=md,this.version=eI,this.name=gu,this.events=new Qr.EventEmitter,this.initialized=!1,this.on=(s,a)=>this.events.on(s,a),this.once=(s,a)=>this.events.once(s,a),this.off=(s,a)=>this.events.off(s,a),this.removeListener=(s,a)=>this.events.removeListener(s,a),this.projectId=t==null?void 0:t.projectId,this.relayUrl=(t==null?void 0:t.relayUrl)||_d,this.customStoragePrefix=t!=null&&t.customStoragePrefix?`:${t.customStoragePrefix}`:"";const r=typeof(t==null?void 0:t.logger)<"u"&&typeof(t==null?void 0:t.logger)!="string"?t.logger:Ne.pino(Ne.getDefaultLoggerOptions({level:(t==null?void 0:t.logger)||tI.logger}));this.logger=Ne.generateChildLogger(r,this.name),this.heartbeat=new _n.HeartBeat,this.crypto=new AI(this,this.logger,t==null?void 0:t.keychain),this.history=new QI(this,this.logger),this.expirer=new JI(this,this.logger),this.storage=t!=null&&t.storage?t.storage:new hb(gf(gf({},rI),t==null?void 0:t.storageOptions)),this.relayer=new kI({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new WI(this,this.logger),this.verify=new YI(this.projectId||"",this.logger)}static async init(t){const r=new bd(t);await r.initialize();const s=await r.crypto.getClientId();return await r.storage.setItem(vI,s),r}get context(){return Ne.getLoggerContext(this.logger)}async start(){this.initialized||await this.initialize()}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.initialized=!0,this.logger.info("Core Initialization Success")}catch(t){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,t),this.logger.error(t.message),t}}};const rS=tS;var iS={};(function(n){const t=Da,r=Ua,s=Ca,a=$a,c=l=>l==null,f=Symbol("encodeFragmentIdentifier");function b(l){switch(l.arrayFormat){case"index":return p=>(m,y)=>{const g=m.length;return y===void 0||l.skipNull&&y===null||l.skipEmptyString&&y===""?m:y===null?[...m,[E(p,l),"[",g,"]"].join("")]:[...m,[E(p,l),"[",E(g,l),"]=",E(y,l)].join("")]};case"bracket":return p=>(m,y)=>y===void 0||l.skipNull&&y===null||l.skipEmptyString&&y===""?m:y===null?[...m,[E(p,l),"[]"].join("")]:[...m,[E(p,l),"[]=",E(y,l)].join("")];case"colon-list-separator":return p=>(m,y)=>y===void 0||l.skipNull&&y===null||l.skipEmptyString&&y===""?m:y===null?[...m,[E(p,l),":list="].join("")]:[...m,[E(p,l),":list=",E(y,l)].join("")];case"comma":case"separator":case"bracket-separator":{const p=l.arrayFormat==="bracket-separator"?"[]=":"=";return m=>(y,g)=>g===void 0||l.skipNull&&g===null||l.skipEmptyString&&g===""?y:(g=g===null?"":g,y.length===0?[[E(m,l),p,E(g,l)].join("")]:[[y,E(g,l)].join(l.arrayFormatSeparator)])}default:return p=>(m,y)=>y===void 0||l.skipNull&&y===null||l.skipEmptyString&&y===""?m:y===null?[...m,E(p,l)]:[...m,[E(p,l),"=",E(y,l)].join("")]}}function S(l){let p;switch(l.arrayFormat){case"index":return(m,y,g)=>{if(p=/\[(\d*)\]$/.exec(m),m=m.replace(/\[\d*\]$/,""),!p){g[m]=y;return}g[m]===void 0&&(g[m]={}),g[m][p[1]]=y};case"bracket":return(m,y,g)=>{if(p=/(\[\])$/.exec(m),m=m.replace(/\[\]$/,""),!p){g[m]=y;return}if(g[m]===void 0){g[m]=[y];return}g[m]=[].concat(g[m],y)};case"colon-list-separator":return(m,y,g)=>{if(p=/(:list)$/.exec(m),m=m.replace(/:list$/,""),!p){g[m]=y;return}if(g[m]===void 0){g[m]=[y];return}g[m]=[].concat(g[m],y)};case"comma":case"separator":return(m,y,g)=>{const N=typeof y=="string"&&y.includes(l.arrayFormatSeparator),P=typeof y=="string"&&!N&&O(y,l).includes(l.arrayFormatSeparator);y=P?O(y,l):y;const Q=N||P?y.split(l.arrayFormatSeparator).map(se=>O(se,l)):y===null?y:O(y,l);g[m]=Q};case"bracket-separator":return(m,y,g)=>{const N=/(\[\])$/.test(m);if(m=m.replace(/\[\]$/,""),!N){g[m]=y&&O(y,l);return}const P=y===null?[]:y.split(l.arrayFormatSeparator).map(Q=>O(Q,l));if(g[m]===void 0){g[m]=P;return}g[m]=[].concat(g[m],P)};default:return(m,y,g)=>{if(g[m]===void 0){g[m]=y;return}g[m]=[].concat(g[m],y)}}}function v(l){if(typeof l!="string"||l.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function E(l,p){return p.encode?p.strict?t(l):encodeURIComponent(l):l}function O(l,p){return p.decode?r(l):l}function R(l){return Array.isArray(l)?l.sort():typeof l=="object"?R(Object.keys(l)).sort((p,m)=>Number(p)-Number(m)).map(p=>l[p]):l}function z(l){const p=l.indexOf("#");return p!==-1&&(l=l.slice(0,p)),l}function q(l){let p="";const m=l.indexOf("#");return m!==-1&&(p=l.slice(m)),p}function W(l){l=z(l);const p=l.indexOf("?");return p===-1?"":l.slice(p+1)}function ie(l,p){return p.parseNumbers&&!Number.isNaN(Number(l))&&typeof l=="string"&&l.trim()!==""?l=Number(l):p.parseBooleans&&l!==null&&(l.toLowerCase()==="true"||l.toLowerCase()==="false")&&(l=l.toLowerCase()==="true"),l}function ce(l,p){p=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},p),v(p.arrayFormatSeparator);const m=S(p),y=Object.create(null);if(typeof l!="string"||(l=l.trim().replace(/^[?#&]/,""),!l))return y;for(const g of l.split("&")){if(g==="")continue;let[N,P]=s(p.decode?g.replace(/\+/g," "):g,"=");P=P===void 0?null:["comma","separator","bracket-separator"].includes(p.arrayFormat)?P:O(P,p),m(O(N,p),P,y)}for(const g of Object.keys(y)){const N=y[g];if(typeof N=="object"&&N!==null)for(const P of Object.keys(N))N[P]=ie(N[P],p);else y[g]=ie(N,p)}return p.sort===!1?y:(p.sort===!0?Object.keys(y).sort():Object.keys(y).sort(p.sort)).reduce((g,N)=>{const P=y[N];return P&&typeof P=="object"&&!Array.isArray(P)?g[N]=R(P):g[N]=P,g},Object.create(null))}n.extract=W,n.parse=ce,n.stringify=(l,p)=>{if(!l)return"";p=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},p),v(p.arrayFormatSeparator);const m=P=>p.skipNull&&c(l[P])||p.skipEmptyString&&l[P]==="",y=b(p),g={};for(const P of Object.keys(l))m(P)||(g[P]=l[P]);const N=Object.keys(g);return p.sort!==!1&&N.sort(p.sort),N.map(P=>{const Q=l[P];return Q===void 0?"":Q===null?E(P,p):Array.isArray(Q)?Q.length===0&&p.arrayFormat==="bracket-separator"?E(P,p)+"[]":Q.reduce(y(P),[]).join("&"):E(P,p)+"="+E(Q,p)}).filter(P=>P.length>0).join("&")},n.parseUrl=(l,p)=>{p=Object.assign({decode:!0},p);const[m,y]=s(l,"#");return Object.assign({url:m.split("?")[0]||"",query:ce(W(l),p)},p&&p.parseFragmentIdentifier&&y?{fragmentIdentifier:O(y,p)}:{})},n.stringifyUrl=(l,p)=>{p=Object.assign({encode:!0,strict:!0,[f]:!0},p);const m=z(l.url).split("?")[0]||"",y=n.extract(l.url),g=n.parse(y,{sort:!1}),N=Object.assign(g,l.query);let P=n.stringify(N,p);P&&(P=`?${P}`);let Q=q(l.url);return l.fragmentIdentifier&&(Q=`#${p[f]?E(l.fragmentIdentifier,p):l.fragmentIdentifier}`),`${m}${P}${Q}`},n.pick=(l,p,m)=>{m=Object.assign({parseFragmentIdentifier:!0,[f]:!1},m);const{url:y,query:g,fragmentIdentifier:N}=n.parseUrl(l,m);return n.stringifyUrl({url:y,query:a(g,p),fragmentIdentifier:N},m)},n.exclude=(l,p,m)=>{const y=Array.isArray(p)?g=>!p.includes(g):(g,N)=>!p(g,N);return n.pick(l,y,m)}})(iS);function wd(n,t){return n.includes(":")?[n]:t.chains||[]}const nS="base16",sS="utf8",aS=1;function Tc(n){const t=La.hash(nr(n,sS));return Jt(t,nS)}const oS="ReactNative",vn={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"};function Ed(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}function cS(){return!qf()&&!!qa()&&navigator.product===oS}function yu(){return!Ed()&&!!qa()}function uS(){return cS()?vn.reactNative:Ed()?vn.node:yu()?vn.browser:vn.unknown}function lS(){return I_()||{name:"",description:"",url:"",icons:[""]}}function Vi(n,t){return n.filter(r=>t.includes(r)).length===n.length}function Bn(n=ne.FIVE_MINUTES,t){const r=ne.toMiliseconds(n||ne.FIVE_MINUTES);let s,a,c;return{resolve:f=>{c&&s&&(clearTimeout(c),s(f))},reject:f=>{c&&a&&(clearTimeout(c),a(f))},done:()=>new Promise((f,b)=>{c=setTimeout(()=>{b(new Error(t))},r),s=f,a=b})}}function hS(n){const[t,r]=n.split(":"),s={id:void 0,topic:void 0};if(t==="topic"&&typeof r=="string")s.topic=r;else if(t==="id"&&Number.isInteger(Number(r)))s.id=Number(r);else throw new Error(`Invalid target, expected id:number or topic:string, got ${t}:${r}`);return s}function ki(n,t){return ne.fromMiliseconds((t||Date.now())+ne.toMiliseconds(n))}function yn(n){return Date.now()>=ne.toMiliseconds(n)}function kt(n,t){return`${n}${t?`:${t}`:""}`}async function fS({id:n,topic:t,wcDeepLink:r}){try{if(!r)return;const s=typeof r=="string"?JSON.parse(r):r;let a=s==null?void 0:s.href;if(typeof a!="string")return;a.endsWith("/")&&(a=a.slice(0,-1));const c=`${a}/wc?requestId=${n}&sessionTopic=${t}`,f=uS();f===vn.browser?c.startsWith("https://")?window.open(c,"_blank","noreferrer noopener"):window.open(c,"_self","noreferrer noopener"):f===vn.reactNative&&typeof(global==null?void 0:global.Linking)<"u"&&await global.Linking.openURL(c)}catch(s){console.error(s)}}async function dS(n,t){try{return await n.getItem(t)||(yu()?localStorage.getItem(t):void 0)}catch(r){console.error(r)}}function En(n){const t=[];return n.forEach(r=>{const[s,a]=r.split(":");t.push(`${s}:${a}`)}),t}function pS(n){const t=[];return Object.values(n).forEach(r=>{t.push(...En(r.accounts))}),t}function gS(n,t){const r=[];return Object.values(n).forEach(s=>{En(s.accounts).includes(t)&&r.push(...s.methods)}),r}function yS(n,t){const r=[];return Object.values(n).forEach(s=>{En(s.accounts).includes(t)&&r.push(...s.events)}),r}function mS(n,t){const r=xa(n,t);if(r)throw new Error(r.message);const s={};for(const[a,c]of Object.entries(n))s[a]={methods:c.methods,events:c.events,chains:c.accounts.map(f=>`${f.split(":")[0]}:${f.split(":")[1]}`)};return s}const vS={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},_S={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function fe(n,t){const{message:r,code:s}=_S[n];return{message:t?`${r} ${t}`:r,code:s}}function br(n,t){const{message:r,code:s}=vS[n];return{message:t?`${r} ${t}`:r,code:s}}function Va(n,t){return Array.isArray(n)?typeof t<"u"&&n.length?n.every(t):!0:!1}function ts(n){return Object.getPrototypeOf(n)===Object.prototype&&Object.keys(n).length}function Rr(n){return typeof n>"u"}function Qt(n,t){return t&&Rr(n)?!0:typeof n=="string"&&!!n.trim().length}function mu(n,t){return t&&Rr(n)?!0:typeof n=="number"&&!isNaN(n)}function bS(n,t){const{requiredNamespaces:r}=t,s=Object.keys(n.namespaces),a=Object.keys(r);let c=!0;return Vi(a,s)?(s.forEach(f=>{const{accounts:b,methods:S,events:v}=n.namespaces[f],E=En(b),O=r[f];(!Vi(wd(f,O),E)||!Vi(O.methods,S)||!Vi(O.events,v))&&(c=!1)}),c):!1}function Aa(n){return Qt(n,!1)&&n.includes(":")?n.split(":").length===2:!1}function wS(n){if(Qt(n,!1)&&n.includes(":")){const t=n.split(":");if(t.length===3){const r=t[0]+":"+t[1];return!!t[2]&&Aa(r)}}return!1}function ES(n,t){let r=null;return Qt(n==null?void 0:n.publicKey,!1)||(r=fe("MISSING_OR_INVALID",`${t} controller public key should be a string`)),r}function yf(n){let t=!0;return Va(n)?n.length&&(t=n.every(r=>Qt(r,!1))):t=!1,t}function IS(n,t,r){let s=null;return Va(t)&&t.length?t.forEach(a=>{s||Aa(a)||(s=br("UNSUPPORTED_CHAINS",`${r}, chain ${a} should be a string and conform to "namespace:chainId" format`))}):Aa(n)||(s=br("UNSUPPORTED_CHAINS",`${r}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),s}function SS(n,t,r){let s=null;return Object.entries(n).forEach(([a,c])=>{if(s)return;const f=IS(a,wd(a,c),`${t} ${r}`);f&&(s=f)}),s}function xS(n,t){let r=null;return Va(n)?n.forEach(s=>{r||wS(s)||(r=br("UNSUPPORTED_ACCOUNTS",`${t}, account ${s} should be a string and conform to "namespace:chainId:address" format`))}):r=br("UNSUPPORTED_ACCOUNTS",`${t}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),r}function PS(n,t){let r=null;return Object.values(n).forEach(s=>{if(r)return;const a=xS(s==null?void 0:s.accounts,`${t} namespace`);a&&(r=a)}),r}function OS(n,t){let r=null;return yf(n==null?void 0:n.methods)?yf(n==null?void 0:n.events)||(r=br("UNSUPPORTED_EVENTS",`${t}, events should be an array of strings or empty array for no events`)):r=br("UNSUPPORTED_METHODS",`${t}, methods should be an array of strings or empty array for no methods`),r}function Id(n,t){let r=null;return Object.values(n).forEach(s=>{if(r)return;const a=OS(s,`${t}, namespace`);a&&(r=a)}),r}function NS(n,t,r){let s=null;if(n&&ts(n)){const a=Id(n,t);a&&(s=a);const c=SS(n,t,r);c&&(s=c)}else s=fe("MISSING_OR_INVALID",`${t}, ${r} should be an object with data`);return s}function xa(n,t){let r=null;if(n&&ts(n)){const s=Id(n,t);s&&(r=s);const a=PS(n,t);a&&(r=a)}else r=fe("MISSING_OR_INVALID",`${t}, namespaces should be an object with data`);return r}function Sd(n){return Qt(n.protocol,!0)}function TS(n,t){let r=!1;return t&&!n?r=!0:n&&Va(n)&&n.length&&n.forEach(s=>{r=Sd(s)}),r}function AS(n){return typeof n=="number"}function qr(n){return typeof n<"u"&&typeof n!==null}function RS(n){return!(!n||typeof n!="object"||!n.code||!mu(n.code,!1)||!n.message||!Qt(n.message,!1))}function CS(n){return!(Rr(n)||!Qt(n.method,!1))}function $S(n){return!(Rr(n)||Rr(n.result)&&Rr(n.error)||!mu(n.id,!1)||!Qt(n.jsonrpc,!1))}function DS(n){return!(Rr(n)||!Qt(n.name,!1))}function mf(n,t){return!(!Aa(t)||!pS(n).includes(t))}function US(n,t,r){return Qt(r,!1)?gS(n,t).includes(r):!1}function jS(n,t,r){return Qt(r,!1)?yS(n,t).includes(r):!1}function vf(n,t,r){let s=null;const a=LS(n),c=qS(t),f=Object.keys(a),b=Object.keys(c),S=_f(Object.keys(n)),v=_f(Object.keys(t)),E=S.filter(O=>!v.includes(O));return E.length&&(s=fe("NON_CONFORMING_NAMESPACES",`${r} namespaces keys don't satisfy requiredNamespaces.
      Required: ${E.toString()}
      Received: ${Object.keys(t).toString()}`)),Vi(f,b)||(s=fe("NON_CONFORMING_NAMESPACES",`${r} namespaces chains don't satisfy required namespaces.
      Required: ${f.toString()}
      Approved: ${b.toString()}`)),Object.keys(t).forEach(O=>{if(!O.includes(":")||s)return;const R=En(t[O].accounts);R.includes(O)||(s=fe("NON_CONFORMING_NAMESPACES",`${r} namespaces accounts don't satisfy namespace accounts for ${O}
        Required: ${O}
        Approved: ${R.toString()}`))}),f.forEach(O=>{s||(Vi(a[O].methods,c[O].methods)?Vi(a[O].events,c[O].events)||(s=fe("NON_CONFORMING_NAMESPACES",`${r} namespaces events don't satisfy namespace events for ${O}`)):s=fe("NON_CONFORMING_NAMESPACES",`${r} namespaces methods don't satisfy namespace methods for ${O}`))}),s}function LS(n){const t={};return Object.keys(n).forEach(r=>{var s;r.includes(":")?t[r]=n[r]:(s=n[r].chains)==null||s.forEach(a=>{t[a]={methods:n[r].methods,events:n[r].events}})}),t}function _f(n){return[...new Set(n.map(t=>t.includes(":")?t.split(":")[0]:t))]}function qS(n){const t={};return Object.keys(n).forEach(r=>{if(r.includes(":"))t[r]=n[r];else{const s=En(n[r].accounts);s==null||s.forEach(a=>{t[a]={accounts:n[r].accounts.filter(c=>c.includes(`${a}:`)),methods:n[r].methods,events:n[r].events}})}}),t}function MS(n,t){return mu(n,!1)&&n<=t.max&&n>=t.min}const Ac={};class ma{static get(t){return Ac[t]}static set(t,r){Ac[t]=r}static delete(t){delete Ac[t]}}const xd="wc",Pd=2,Od="client",vu=`${xd}@${Pd}:${Od}:`,Rc={name:Od,logger:"error",controller:!1,relayUrl:"wss://relay.walletconnect.com"},bf="WALLETCONNECT_DEEPLINK_CHOICE",zS="proposal",Nd="Proposal expired",FS="session",va=ne.SEVEN_DAYS,HS="engine",Gn={wc_sessionPropose:{req:{ttl:ne.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:ne.FIVE_MINUTES,prompt:!1,tag:1101}},wc_sessionSettle:{req:{ttl:ne.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:ne.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:ne.ONE_DAY,prompt:!1,tag:1104},res:{ttl:ne.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:ne.ONE_DAY,prompt:!1,tag:1106},res:{ttl:ne.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:ne.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:ne.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:ne.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:ne.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:ne.ONE_DAY,prompt:!1,tag:1112},res:{ttl:ne.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:ne.THIRTY_SECONDS,prompt:!1,tag:1114},res:{ttl:ne.THIRTY_SECONDS,prompt:!1,tag:1115}}},Cc={min:ne.FIVE_MINUTES,max:ne.SEVEN_DAYS},ui={idle:"IDLE",active:"ACTIVE"},KS="request",kS=["wc_sessionPropose","wc_sessionRequest","wc_authRequest"];var VS=Object.defineProperty,BS=Object.defineProperties,GS=Object.getOwnPropertyDescriptors,wf=Object.getOwnPropertySymbols,WS=Object.prototype.hasOwnProperty,QS=Object.prototype.propertyIsEnumerable,Ef=(n,t,r)=>t in n?VS(n,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[t]=r,fr=(n,t)=>{for(var r in t||(t={}))WS.call(t,r)&&Ef(n,r,t[r]);if(wf)for(var r of wf(t))QS.call(t,r)&&Ef(n,r,t[r]);return n},Wn=(n,t)=>BS(n,GS(t));class JS extends mw{constructor(t){super(t),this.name=HS,this.events=new su,this.initialized=!1,this.ignoredPayloadTypes=[aS],this.requestQueue={state:ui.idle,queue:[]},this.sessionRequestQueue={state:ui.idle,queue:[]},this.requestQueueDelay=ne.ONE_SECOND,this.init=async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),this.client.core.pairing.register({methods:Object.keys(Gn)}),this.initialized=!0,setTimeout(()=>{this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},ne.toMiliseconds(this.requestQueueDelay)))},this.connect=async r=>{await this.isInitialized();const s=Wn(fr({},r),{requiredNamespaces:r.requiredNamespaces||{},optionalNamespaces:r.optionalNamespaces||{}});await this.isValidConnect(s);const{pairingTopic:a,requiredNamespaces:c,optionalNamespaces:f,sessionProperties:b,relays:S}=s;let v=a,E,O=!1;if(v&&(O=this.client.core.pairing.pairings.get(v).active),!v||!O){const{topic:p,uri:m}=await this.client.core.pairing.create();v=p,E=m}const R=await this.client.core.crypto.generateKeyPair(),z=fr({requiredNamespaces:c,optionalNamespaces:f,relays:S??[{protocol:vd}],proposer:{publicKey:R,metadata:this.client.metadata}},b&&{sessionProperties:b}),{reject:q,resolve:W,done:ie}=Bn(ne.FIVE_MINUTES,Nd);if(this.events.once(kt("session_connect"),async({error:p,session:m})=>{if(p)q(p);else if(m){m.self.publicKey=R;const y=Wn(fr({},m),{requiredNamespaces:m.requiredNamespaces,optionalNamespaces:m.optionalNamespaces});await this.client.session.set(m.topic,y),await this.setExpiry(m.topic,m.expiry),v&&await this.client.core.pairing.updateMetadata({topic:v,metadata:m.peer.metadata}),W(y)}}),!v){const{message:p}=fe("NO_MATCHING_KEY",`connect() pairing topic: ${v}`);throw new Error(p)}const ce=await this.sendRequest({topic:v,method:"wc_sessionPropose",params:z}),l=ki(ne.FIVE_MINUTES);return await this.setProposal(ce,fr({id:ce,expiry:l},z)),{uri:E,approval:ie}},this.pair=async r=>(await this.isInitialized(),await this.client.core.pairing.pair(r)),this.approve=async r=>{await this.isInitialized(),await this.isValidApprove(r);const{id:s,relayProtocol:a,namespaces:c,sessionProperties:f}=r,b=this.client.proposal.get(s);let{pairingTopic:S,proposer:v,requiredNamespaces:E,optionalNamespaces:O}=b;S=S||"",ts(E)||(E=mS(c,"approve()"));const R=await this.client.core.crypto.generateKeyPair(),z=v.publicKey,q=await this.client.core.crypto.generateSharedKey(R,z);S&&s&&(await this.client.core.pairing.updateMetadata({topic:S,metadata:v.metadata}),await this.sendResult({id:s,topic:S,result:{relay:{protocol:a??"irn"},responderPublicKey:R}}),await this.client.proposal.delete(s,br("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:S}));const W=fr({relay:{protocol:a??"irn"},namespaces:c,requiredNamespaces:E,optionalNamespaces:O,pairingTopic:S,controller:{publicKey:R,metadata:this.client.metadata},expiry:ki(va)},f&&{sessionProperties:f});await this.client.core.relayer.subscribe(q),await this.sendRequest({topic:q,method:"wc_sessionSettle",params:W,throwOnFailedPublish:!0});const ie=Wn(fr({},W),{topic:q,pairingTopic:S,acknowledged:!1,self:W.controller,peer:{publicKey:v.publicKey,metadata:v.metadata},controller:R});return await this.client.session.set(q,ie),await this.setExpiry(q,ki(va)),{topic:q,acknowledged:()=>new Promise(ce=>setTimeout(()=>ce(this.client.session.get(q)),500))}},this.reject=async r=>{await this.isInitialized(),await this.isValidReject(r);const{id:s,reason:a}=r,{pairingTopic:c}=this.client.proposal.get(s);c&&(await this.sendError(s,c,a),await this.client.proposal.delete(s,br("USER_DISCONNECTED")))},this.update=async r=>{await this.isInitialized(),await this.isValidUpdate(r);const{topic:s,namespaces:a}=r,c=await this.sendRequest({topic:s,method:"wc_sessionUpdate",params:{namespaces:a}}),{done:f,resolve:b,reject:S}=Bn();return this.events.once(kt("session_update",c),({error:v})=>{v?S(v):b()}),await this.client.session.update(s,{namespaces:a}),{acknowledged:f}},this.extend=async r=>{await this.isInitialized(),await this.isValidExtend(r);const{topic:s}=r,a=await this.sendRequest({topic:s,method:"wc_sessionExtend",params:{}}),{done:c,resolve:f,reject:b}=Bn();return this.events.once(kt("session_extend",a),({error:S})=>{S?b(S):f()}),await this.setExpiry(s,ki(va)),{acknowledged:c}},this.request=async r=>{await this.isInitialized(),await this.isValidRequest(r);const{chainId:s,request:a,topic:c,expiry:f}=r,b=A_(),{done:S,resolve:v,reject:E}=Bn(f,"Request expired. Please try again.");return this.events.once(kt("session_request",b),({error:O,result:R})=>{O?E(O):v(R)}),await Promise.all([new Promise(async O=>{await this.sendRequest({clientRpcId:b,topic:c,method:"wc_sessionRequest",params:{request:a,chainId:s},expiry:f,throwOnFailedPublish:!0}).catch(R=>E(R)),this.client.events.emit("session_request_sent",{topic:c,request:a,chainId:s,id:b}),O()}),new Promise(async O=>{const R=await dS(this.client.core.storage,bf);fS({id:b,topic:c,wcDeepLink:R}),O()}),S()]).then(O=>O[2])},this.respond=async r=>{await this.isInitialized(),await this.isValidRespond(r);const{topic:s,response:a}=r,{id:c}=a;Si(a)?await this.sendResult({id:c,topic:s,result:a.result,throwOnFailedPublish:!0}):li(a)&&await this.sendError(c,s,a.error),this.cleanupAfterResponse(r)},this.ping=async r=>{await this.isInitialized(),await this.isValidPing(r);const{topic:s}=r;if(this.client.session.keys.includes(s)){const a=await this.sendRequest({topic:s,method:"wc_sessionPing",params:{}}),{done:c,resolve:f,reject:b}=Bn();this.events.once(kt("session_ping",a),({error:S})=>{S?b(S):f()}),await c()}else this.client.core.pairing.pairings.keys.includes(s)&&await this.client.core.pairing.ping({topic:s})},this.emit=async r=>{await this.isInitialized(),await this.isValidEmit(r);const{topic:s,event:a,chainId:c}=r;await this.sendRequest({topic:s,method:"wc_sessionEvent",params:{event:a,chainId:c}})},this.disconnect=async r=>{await this.isInitialized(),await this.isValidDisconnect(r);const{topic:s}=r;this.client.session.keys.includes(s)?(await this.sendRequest({topic:s,method:"wc_sessionDelete",params:br("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession(s)):await this.client.core.pairing.disconnect({topic:s})},this.find=r=>(this.isInitialized(),this.client.session.getAll().filter(s=>bS(s,r))),this.getPendingSessionRequests=()=>(this.isInitialized(),this.client.pendingRequest.getAll()),this.cleanupDuplicatePairings=async r=>{if(r.pairingTopic)try{const s=this.client.core.pairing.pairings.get(r.pairingTopic),a=this.client.core.pairing.pairings.getAll().filter(c=>{var f,b;return((f=c.peerMetadata)==null?void 0:f.url)&&((b=c.peerMetadata)==null?void 0:b.url)===r.peer.metadata.url&&c.topic&&c.topic!==s.topic});if(a.length===0)return;this.client.logger.info(`Cleaning up ${a.length} duplicate pairing(s)`),await Promise.all(a.map(c=>this.client.core.pairing.disconnect({topic:c.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(s){this.client.logger.error(s)}},this.deleteSession=async(r,s)=>{const{self:a}=this.client.session.get(r);await this.client.core.relayer.unsubscribe(r),this.client.session.delete(r,br("USER_DISCONNECTED")),this.client.core.crypto.keychain.has(a.publicKey)&&await this.client.core.crypto.deleteKeyPair(a.publicKey),this.client.core.crypto.keychain.has(r)&&await this.client.core.crypto.deleteSymKey(r),s||this.client.core.expirer.del(r),this.client.core.storage.removeItem(bf).catch(c=>this.client.logger.warn(c))},this.deleteProposal=async(r,s)=>{await Promise.all([this.client.proposal.delete(r,br("USER_DISCONNECTED")),s?Promise.resolve():this.client.core.expirer.del(r)])},this.deletePendingSessionRequest=async(r,s,a=!1)=>{await Promise.all([this.client.pendingRequest.delete(r,s),a?Promise.resolve():this.client.core.expirer.del(r)]),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(c=>c.id!==r),a&&(this.sessionRequestQueue.state=ui.idle)},this.setExpiry=async(r,s)=>{this.client.session.keys.includes(r)&&await this.client.session.update(r,{expiry:s}),this.client.core.expirer.set(r,s)},this.setProposal=async(r,s)=>{await this.client.proposal.set(r,s),this.client.core.expirer.set(r,s.expiry)},this.setPendingSessionRequest=async r=>{const s=Gn.wc_sessionRequest.req.ttl,{id:a,topic:c,params:f,verifyContext:b}=r;await this.client.pendingRequest.set(a,{id:a,topic:c,params:f,verifyContext:b}),s&&this.client.core.expirer.set(a,ki(s))},this.sendRequest=async r=>{const{topic:s,method:a,params:c,expiry:f,relayRpcId:b,clientRpcId:S,throwOnFailedPublish:v}=r,E=es(a,c,S);if(yu()&&kS.includes(a)){const z=Tc(JSON.stringify(E));this.client.core.verify.register({attestationId:z})}const O=await this.client.core.crypto.encode(s,E),R=Gn[a].req;return f&&(R.ttl=f),b&&(R.id=b),this.client.core.history.set(s,E),v?(R.internal=Wn(fr({},R.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(s,O,R)):this.client.core.relayer.publish(s,O,R).catch(z=>this.client.logger.error(z)),E.id},this.sendResult=async r=>{const{id:s,topic:a,result:c,throwOnFailedPublish:f}=r,b=uu(s,c),S=await this.client.core.crypto.encode(a,b),v=await this.client.core.history.get(a,s),E=Gn[v.request.method].res;f?(E.internal=Wn(fr({},E.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(a,S,E)):this.client.core.relayer.publish(a,S,E).catch(O=>this.client.logger.error(O)),await this.client.core.history.resolve(b)},this.sendError=async(r,s,a)=>{const c=au(r,a),f=await this.client.core.crypto.encode(s,c),b=await this.client.core.history.get(s,r),S=Gn[b.request.method].res;this.client.core.relayer.publish(s,f,S),await this.client.core.history.resolve(c)},this.cleanup=async()=>{const r=[],s=[];this.client.session.getAll().forEach(a=>{yn(a.expiry)&&r.push(a.topic)}),this.client.proposal.getAll().forEach(a=>{yn(a.expiry)&&s.push(a.id)}),await Promise.all([...r.map(a=>this.deleteSession(a)),...s.map(a=>this.deleteProposal(a))])},this.onRelayEventRequest=async r=>{this.requestQueue.queue.push(r),await this.processRequestsQueue()},this.processRequestsQueue=async()=>{if(this.requestQueue.state===ui.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=ui.active;const r=this.requestQueue.queue.shift();if(r)try{this.processRequest(r),await new Promise(s=>setTimeout(s,300))}catch(s){this.client.logger.warn(s)}}this.requestQueue.state=ui.idle},this.processRequest=r=>{const{topic:s,payload:a}=r,c=a.method;switch(c){case"wc_sessionPropose":return this.onSessionProposeRequest(s,a);case"wc_sessionSettle":return this.onSessionSettleRequest(s,a);case"wc_sessionUpdate":return this.onSessionUpdateRequest(s,a);case"wc_sessionExtend":return this.onSessionExtendRequest(s,a);case"wc_sessionPing":return this.onSessionPingRequest(s,a);case"wc_sessionDelete":return this.onSessionDeleteRequest(s,a);case"wc_sessionRequest":return this.onSessionRequest(s,a);case"wc_sessionEvent":return this.onSessionEventRequest(s,a);default:return this.client.logger.info(`Unsupported request method ${c}`)}},this.onRelayEventResponse=async r=>{const{topic:s,payload:a}=r,c=(await this.client.core.history.get(s,a.id)).request.method;switch(c){case"wc_sessionPropose":return this.onSessionProposeResponse(s,a);case"wc_sessionSettle":return this.onSessionSettleResponse(s,a);case"wc_sessionUpdate":return this.onSessionUpdateResponse(s,a);case"wc_sessionExtend":return this.onSessionExtendResponse(s,a);case"wc_sessionPing":return this.onSessionPingResponse(s,a);case"wc_sessionRequest":return this.onSessionRequestResponse(s,a);default:return this.client.logger.info(`Unsupported response method ${c}`)}},this.onRelayEventUnknownPayload=r=>{const{topic:s}=r,{message:a}=fe("MISSING_OR_INVALID",`Decoded payload on topic ${s} is not identifiable as a JSON-RPC request or a response.`);throw new Error(a)},this.onSessionProposeRequest=async(r,s)=>{const{params:a,id:c}=s;try{this.isValidConnect(fr({},s.params));const f=ki(ne.FIVE_MINUTES),b=fr({id:c,pairingTopic:r,expiry:f},a);await this.setProposal(c,b);const S=Tc(JSON.stringify(s)),v=await this.getVerifyContext(S,b.proposer.metadata);this.client.events.emit("session_proposal",{id:c,params:b,verifyContext:v})}catch(f){await this.sendError(c,r,f),this.client.logger.error(f)}},this.onSessionProposeResponse=async(r,s)=>{const{id:a}=s;if(Si(s)){const{result:c}=s;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:c});const f=this.client.proposal.get(a);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:f});const b=f.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:b});const S=c.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:S});const v=await this.client.core.crypto.generateSharedKey(b,S);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",sessionTopic:v});const E=await this.client.core.relayer.subscribe(v);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:E}),await this.client.core.pairing.activate({topic:r})}else li(s)&&(await this.client.proposal.delete(a,br("USER_DISCONNECTED")),this.events.emit(kt("session_connect"),{error:s.error}))},this.onSessionSettleRequest=async(r,s)=>{const{id:a,params:c}=s;try{this.isValidSessionSettleRequest(c);const{relay:f,controller:b,expiry:S,namespaces:v,requiredNamespaces:E,optionalNamespaces:O,sessionProperties:R,pairingTopic:z}=s.params,q=fr({topic:r,relay:f,expiry:S,namespaces:v,acknowledged:!0,pairingTopic:z,requiredNamespaces:E,optionalNamespaces:O,controller:b.publicKey,self:{publicKey:"",metadata:this.client.metadata},peer:{publicKey:b.publicKey,metadata:b.metadata}},R&&{sessionProperties:R});await this.sendResult({id:s.id,topic:r,result:!0}),this.events.emit(kt("session_connect"),{session:q}),this.cleanupDuplicatePairings(q)}catch(f){await this.sendError(a,r,f),this.client.logger.error(f)}},this.onSessionSettleResponse=async(r,s)=>{const{id:a}=s;Si(s)?(await this.client.session.update(r,{acknowledged:!0}),this.events.emit(kt("session_approve",a),{})):li(s)&&(await this.client.session.delete(r,br("USER_DISCONNECTED")),this.events.emit(kt("session_approve",a),{error:s.error}))},this.onSessionUpdateRequest=async(r,s)=>{const{params:a,id:c}=s;try{const f=`${r}_session_update`,b=ma.get(f);if(b&&this.isRequestOutOfSync(b,c)){this.client.logger.info(`Discarding out of sync request - ${c}`);return}this.isValidUpdate(fr({topic:r},a)),await this.client.session.update(r,{namespaces:a.namespaces}),await this.sendResult({id:c,topic:r,result:!0}),this.client.events.emit("session_update",{id:c,topic:r,params:a}),ma.set(f,c)}catch(f){await this.sendError(c,r,f),this.client.logger.error(f)}},this.isRequestOutOfSync=(r,s)=>parseInt(s.toString().slice(0,-3))<=parseInt(r.toString().slice(0,-3)),this.onSessionUpdateResponse=(r,s)=>{const{id:a}=s;Si(s)?this.events.emit(kt("session_update",a),{}):li(s)&&this.events.emit(kt("session_update",a),{error:s.error})},this.onSessionExtendRequest=async(r,s)=>{const{id:a}=s;try{this.isValidExtend({topic:r}),await this.setExpiry(r,ki(va)),await this.sendResult({id:a,topic:r,result:!0}),this.client.events.emit("session_extend",{id:a,topic:r})}catch(c){await this.sendError(a,r,c),this.client.logger.error(c)}},this.onSessionExtendResponse=(r,s)=>{const{id:a}=s;Si(s)?this.events.emit(kt("session_extend",a),{}):li(s)&&this.events.emit(kt("session_extend",a),{error:s.error})},this.onSessionPingRequest=async(r,s)=>{const{id:a}=s;try{this.isValidPing({topic:r}),await this.sendResult({id:a,topic:r,result:!0}),this.client.events.emit("session_ping",{id:a,topic:r})}catch(c){await this.sendError(a,r,c),this.client.logger.error(c)}},this.onSessionPingResponse=(r,s)=>{const{id:a}=s;setTimeout(()=>{Si(s)?this.events.emit(kt("session_ping",a),{}):li(s)&&this.events.emit(kt("session_ping",a),{error:s.error})},500)},this.onSessionDeleteRequest=async(r,s)=>{const{id:a}=s;try{this.isValidDisconnect({topic:r,reason:s.params}),await Promise.all([new Promise(c=>{this.client.core.relayer.once(Wt.publish,async()=>{c(await this.deleteSession(r))})}),this.sendResult({id:a,topic:r,result:!0})]),this.client.events.emit("session_delete",{id:a,topic:r})}catch(c){this.client.logger.error(c)}},this.onSessionRequest=async(r,s)=>{const{id:a,params:c}=s;try{this.isValidRequest(fr({topic:r},c));const f=Tc(JSON.stringify(es("wc_sessionRequest",c,a))),b=this.client.session.get(r),S=await this.getVerifyContext(f,b.peer.metadata),v={id:a,topic:r,params:c,verifyContext:S};await this.setPendingSessionRequest(v),this.addSessionRequestToSessionRequestQueue(v),this.processSessionRequestQueue()}catch(f){await this.sendError(a,r,f),this.client.logger.error(f)}},this.onSessionRequestResponse=(r,s)=>{const{id:a}=s;Si(s)?this.events.emit(kt("session_request",a),{result:s.result}):li(s)&&this.events.emit(kt("session_request",a),{error:s.error})},this.onSessionEventRequest=async(r,s)=>{const{id:a,params:c}=s;try{const f=`${r}_session_event_${c.event.name}`,b=ma.get(f);if(b&&this.isRequestOutOfSync(b,a)){this.client.logger.info(`Discarding out of sync request - ${a}`);return}this.isValidEmit(fr({topic:r},c)),this.client.events.emit("session_event",{id:a,topic:r,params:c}),ma.set(f,a)}catch(f){await this.sendError(a,r,f),this.client.logger.error(f)}},this.addSessionRequestToSessionRequestQueue=r=>{this.sessionRequestQueue.queue.push(r)},this.cleanupAfterResponse=r=>{this.deletePendingSessionRequest(r.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=ui.idle,this.processSessionRequestQueue()},ne.toMiliseconds(this.requestQueueDelay))},this.processSessionRequestQueue=()=>{if(this.sessionRequestQueue.state===ui.active){this.client.logger.info("session request queue is already active.");return}const r=this.sessionRequestQueue.queue[0];if(!r){this.client.logger.info("session request queue is empty.");return}try{this.sessionRequestQueue.state=ui.active,this.client.events.emit("session_request",r)}catch(s){this.client.logger.error(s)}},this.onPairingCreated=r=>{if(r.active)return;const s=this.client.proposal.getAll().find(a=>a.pairingTopic===r.topic);s&&this.onSessionProposeRequest(r.topic,es("wc_sessionPropose",{requiredNamespaces:s.requiredNamespaces,optionalNamespaces:s.optionalNamespaces,relays:s.relays,proposer:s.proposer,sessionProperties:s.sessionProperties},s.id))},this.isValidConnect=async r=>{if(!qr(r)){const{message:S}=fe("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(r)}`);throw new Error(S)}const{pairingTopic:s,requiredNamespaces:a,optionalNamespaces:c,sessionProperties:f,relays:b}=r;if(Rr(s)||await this.isValidPairingTopic(s),!TS(b,!0)){const{message:S}=fe("MISSING_OR_INVALID",`connect() relays: ${b}`);throw new Error(S)}!Rr(a)&&ts(a)!==0&&this.validateNamespaces(a,"requiredNamespaces"),!Rr(c)&&ts(c)!==0&&this.validateNamespaces(c,"optionalNamespaces"),Rr(f)||this.validateSessionProps(f,"sessionProperties")},this.validateNamespaces=(r,s)=>{const a=NS(r,"connect()",s);if(a)throw new Error(a.message)},this.isValidApprove=async r=>{if(!qr(r))throw new Error(fe("MISSING_OR_INVALID",`approve() params: ${r}`).message);const{id:s,namespaces:a,relayProtocol:c,sessionProperties:f}=r;await this.isValidProposalId(s);const b=this.client.proposal.get(s),S=xa(a,"approve()");if(S)throw new Error(S.message);const v=vf(b.requiredNamespaces,a,"approve()");if(v)throw new Error(v.message);if(!Qt(c,!0)){const{message:E}=fe("MISSING_OR_INVALID",`approve() relayProtocol: ${c}`);throw new Error(E)}Rr(f)||this.validateSessionProps(f,"sessionProperties")},this.isValidReject=async r=>{if(!qr(r)){const{message:c}=fe("MISSING_OR_INVALID",`reject() params: ${r}`);throw new Error(c)}const{id:s,reason:a}=r;if(await this.isValidProposalId(s),!RS(a)){const{message:c}=fe("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(a)}`);throw new Error(c)}},this.isValidSessionSettleRequest=r=>{if(!qr(r)){const{message:v}=fe("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${r}`);throw new Error(v)}const{relay:s,controller:a,namespaces:c,expiry:f}=r;if(!Sd(s)){const{message:v}=fe("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(v)}const b=ES(a,"onSessionSettleRequest()");if(b)throw new Error(b.message);const S=xa(c,"onSessionSettleRequest()");if(S)throw new Error(S.message);if(yn(f)){const{message:v}=fe("EXPIRED","onSessionSettleRequest()");throw new Error(v)}},this.isValidUpdate=async r=>{if(!qr(r)){const{message:S}=fe("MISSING_OR_INVALID",`update() params: ${r}`);throw new Error(S)}const{topic:s,namespaces:a}=r;await this.isValidSessionTopic(s);const c=this.client.session.get(s),f=xa(a,"update()");if(f)throw new Error(f.message);const b=vf(c.requiredNamespaces,a,"update()");if(b)throw new Error(b.message)},this.isValidExtend=async r=>{if(!qr(r)){const{message:a}=fe("MISSING_OR_INVALID",`extend() params: ${r}`);throw new Error(a)}const{topic:s}=r;await this.isValidSessionTopic(s)},this.isValidRequest=async r=>{if(!qr(r)){const{message:S}=fe("MISSING_OR_INVALID",`request() params: ${r}`);throw new Error(S)}const{topic:s,request:a,chainId:c,expiry:f}=r;await this.isValidSessionTopic(s);const{namespaces:b}=this.client.session.get(s);if(!mf(b,c)){const{message:S}=fe("MISSING_OR_INVALID",`request() chainId: ${c}`);throw new Error(S)}if(!CS(a)){const{message:S}=fe("MISSING_OR_INVALID",`request() ${JSON.stringify(a)}`);throw new Error(S)}if(!US(b,c,a.method)){const{message:S}=fe("MISSING_OR_INVALID",`request() method: ${a.method}`);throw new Error(S)}if(f&&!MS(f,Cc)){const{message:S}=fe("MISSING_OR_INVALID",`request() expiry: ${f}. Expiry must be a number (in seconds) between ${Cc.min} and ${Cc.max}`);throw new Error(S)}},this.isValidRespond=async r=>{if(!qr(r)){const{message:c}=fe("MISSING_OR_INVALID",`respond() params: ${r}`);throw new Error(c)}const{topic:s,response:a}=r;if(await this.isValidSessionTopic(s),!$S(a)){const{message:c}=fe("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(a)}`);throw new Error(c)}},this.isValidPing=async r=>{if(!qr(r)){const{message:a}=fe("MISSING_OR_INVALID",`ping() params: ${r}`);throw new Error(a)}const{topic:s}=r;await this.isValidSessionOrPairingTopic(s)},this.isValidEmit=async r=>{if(!qr(r)){const{message:b}=fe("MISSING_OR_INVALID",`emit() params: ${r}`);throw new Error(b)}const{topic:s,event:a,chainId:c}=r;await this.isValidSessionTopic(s);const{namespaces:f}=this.client.session.get(s);if(!mf(f,c)){const{message:b}=fe("MISSING_OR_INVALID",`emit() chainId: ${c}`);throw new Error(b)}if(!DS(a)){const{message:b}=fe("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(a)}`);throw new Error(b)}if(!jS(f,c,a.name)){const{message:b}=fe("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(a)}`);throw new Error(b)}},this.isValidDisconnect=async r=>{if(!qr(r)){const{message:a}=fe("MISSING_OR_INVALID",`disconnect() params: ${r}`);throw new Error(a)}const{topic:s}=r;await this.isValidSessionOrPairingTopic(s)},this.getVerifyContext=async(r,s)=>{const a={verified:{verifyUrl:s.verifyUrl||mn,validation:"UNKNOWN",origin:s.url||""}};try{const c=await this.client.core.verify.resolve({attestationId:r,verifyUrl:s.verifyUrl});c&&(a.verified.origin=c.origin,a.verified.isScam=c.isScam,a.verified.validation=c.origin===new URL(s.url).origin?"VALID":"INVALID")}catch(c){this.client.logger.info(c)}return this.client.logger.info(`Verify context: ${JSON.stringify(a)}`),a},this.validateSessionProps=(r,s)=>{Object.values(r).forEach(a=>{if(!Qt(a,!1)){const{message:c}=fe("MISSING_OR_INVALID",`${s} must be in Record<string, string> format. Received: ${JSON.stringify(a)}`);throw new Error(c)}})}}async isInitialized(){if(!this.initialized){const{message:t}=fe("NOT_INITIALIZED",this.name);throw new Error(t)}await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(Wt.message,async t=>{const{topic:r,message:s}=t;if(this.ignoredPayloadTypes.includes(this.client.core.crypto.getPayloadType(s)))return;const a=await this.client.core.crypto.decode(r,s);try{ou(a)?(this.client.core.history.set(r,a),this.onRelayEventRequest({topic:r,payload:a})):cu(a)?(await this.client.core.history.resolve(a),await this.onRelayEventResponse({topic:r,payload:a}),this.client.core.history.delete(r,a.id)):this.onRelayEventUnknownPayload({topic:r,payload:a})}catch(c){this.client.logger.error(c)}})}registerExpirerEvents(){this.client.core.expirer.on(Ar.expired,async t=>{const{topic:r,id:s}=hS(t.target);if(s&&this.client.pendingRequest.keys.includes(s))return await this.deletePendingSessionRequest(s,fe("EXPIRED"),!0);r?this.client.session.keys.includes(r)&&(await this.deleteSession(r,!0),this.client.events.emit("session_expire",{topic:r})):s&&(await this.deleteProposal(s,!0),this.client.events.emit("proposal_expire",{id:s}))})}registerPairingEvents(){this.client.core.pairing.events.on(Yn.create,t=>this.onPairingCreated(t))}isValidPairingTopic(t){if(!Qt(t,!1)){const{message:r}=fe("MISSING_OR_INVALID",`pairing topic should be a string: ${t}`);throw new Error(r)}if(!this.client.core.pairing.pairings.keys.includes(t)){const{message:r}=fe("NO_MATCHING_KEY",`pairing topic doesn't exist: ${t}`);throw new Error(r)}if(yn(this.client.core.pairing.pairings.get(t).expiry)){const{message:r}=fe("EXPIRED",`pairing topic: ${t}`);throw new Error(r)}}async isValidSessionTopic(t){if(!Qt(t,!1)){const{message:r}=fe("MISSING_OR_INVALID",`session topic should be a string: ${t}`);throw new Error(r)}if(!this.client.session.keys.includes(t)){const{message:r}=fe("NO_MATCHING_KEY",`session topic doesn't exist: ${t}`);throw new Error(r)}if(yn(this.client.session.get(t).expiry)){await this.deleteSession(t);const{message:r}=fe("EXPIRED",`session topic: ${t}`);throw new Error(r)}}async isValidSessionOrPairingTopic(t){if(this.client.session.keys.includes(t))await this.isValidSessionTopic(t);else if(this.client.core.pairing.pairings.keys.includes(t))this.isValidPairingTopic(t);else if(Qt(t,!1)){const{message:r}=fe("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${t}`);throw new Error(r)}else{const{message:r}=fe("MISSING_OR_INVALID",`session or pairing topic should be a string: ${t}`);throw new Error(r)}}async isValidProposalId(t){if(!AS(t)){const{message:r}=fe("MISSING_OR_INVALID",`proposal id should be a number: ${t}`);throw new Error(r)}if(!this.client.proposal.keys.includes(t)){const{message:r}=fe("NO_MATCHING_KEY",`proposal id doesn't exist: ${t}`);throw new Error(r)}if(yn(this.client.proposal.get(t).expiry)){await this.deleteProposal(t);const{message:r}=fe("EXPIRED",`proposal id: ${t}`);throw new Error(r)}}}class YS extends ka{constructor(t,r){super(t,r,zS,vu),this.core=t,this.logger=r}}class ZS extends ka{constructor(t,r){super(t,r,FS,vu),this.core=t,this.logger=r}}class XS extends ka{constructor(t,r){super(t,r,KS,vu,s=>s.id),this.core=t,this.logger=r}}let ex=class Td extends yw{constructor(t){super(t),this.protocol=xd,this.version=Pd,this.name=Rc.name,this.events=new Qr.EventEmitter,this.on=(s,a)=>this.events.on(s,a),this.once=(s,a)=>this.events.once(s,a),this.off=(s,a)=>this.events.off(s,a),this.removeListener=(s,a)=>this.events.removeListener(s,a),this.removeAllListeners=s=>this.events.removeAllListeners(s),this.connect=async s=>{try{return await this.engine.connect(s)}catch(a){throw this.logger.error(a.message),a}},this.pair=async s=>{try{return await this.engine.pair(s)}catch(a){throw this.logger.error(a.message),a}},this.approve=async s=>{try{return await this.engine.approve(s)}catch(a){throw this.logger.error(a.message),a}},this.reject=async s=>{try{return await this.engine.reject(s)}catch(a){throw this.logger.error(a.message),a}},this.update=async s=>{try{return await this.engine.update(s)}catch(a){throw this.logger.error(a.message),a}},this.extend=async s=>{try{return await this.engine.extend(s)}catch(a){throw this.logger.error(a.message),a}},this.request=async s=>{try{return await this.engine.request(s)}catch(a){throw this.logger.error(a.message),a}},this.respond=async s=>{try{return await this.engine.respond(s)}catch(a){throw this.logger.error(a.message),a}},this.ping=async s=>{try{return await this.engine.ping(s)}catch(a){throw this.logger.error(a.message),a}},this.emit=async s=>{try{return await this.engine.emit(s)}catch(a){throw this.logger.error(a.message),a}},this.disconnect=async s=>{try{return await this.engine.disconnect(s)}catch(a){throw this.logger.error(a.message),a}},this.find=s=>{try{return this.engine.find(s)}catch(a){throw this.logger.error(a.message),a}},this.getPendingSessionRequests=()=>{try{return this.engine.getPendingSessionRequests()}catch(s){throw this.logger.error(s.message),s}},this.name=(t==null?void 0:t.name)||Rc.name,this.metadata=(t==null?void 0:t.metadata)||lS();const r=typeof(t==null?void 0:t.logger)<"u"&&typeof(t==null?void 0:t.logger)!="string"?t.logger:Ne.pino(Ne.getDefaultLoggerOptions({level:(t==null?void 0:t.logger)||Rc.logger}));this.core=(t==null?void 0:t.core)||new rS(t),this.logger=Ne.generateChildLogger(r,this.name),this.session=new ZS(this.core,this.logger),this.proposal=new YS(this.core,this.logger),this.pendingRequest=new XS(this.core,this.logger),this.engine=new JS(this)}static async init(t){const r=new Td(t);return await r.initialize(),r}get context(){return Ne.getLoggerContext(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.engine.init(),this.core.verify.init({verifyUrl:this.metadata.verifyUrl}),this.logger.info("SignClient Initialization Success")}catch(t){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(t.message),t}}};var tx={};(function(n){const t=Da,r=Ua,s=Ca,a=$a,c=l=>l==null,f=Symbol("encodeFragmentIdentifier");function b(l){switch(l.arrayFormat){case"index":return p=>(m,y)=>{const g=m.length;return y===void 0||l.skipNull&&y===null||l.skipEmptyString&&y===""?m:y===null?[...m,[E(p,l),"[",g,"]"].join("")]:[...m,[E(p,l),"[",E(g,l),"]=",E(y,l)].join("")]};case"bracket":return p=>(m,y)=>y===void 0||l.skipNull&&y===null||l.skipEmptyString&&y===""?m:y===null?[...m,[E(p,l),"[]"].join("")]:[...m,[E(p,l),"[]=",E(y,l)].join("")];case"colon-list-separator":return p=>(m,y)=>y===void 0||l.skipNull&&y===null||l.skipEmptyString&&y===""?m:y===null?[...m,[E(p,l),":list="].join("")]:[...m,[E(p,l),":list=",E(y,l)].join("")];case"comma":case"separator":case"bracket-separator":{const p=l.arrayFormat==="bracket-separator"?"[]=":"=";return m=>(y,g)=>g===void 0||l.skipNull&&g===null||l.skipEmptyString&&g===""?y:(g=g===null?"":g,y.length===0?[[E(m,l),p,E(g,l)].join("")]:[[y,E(g,l)].join(l.arrayFormatSeparator)])}default:return p=>(m,y)=>y===void 0||l.skipNull&&y===null||l.skipEmptyString&&y===""?m:y===null?[...m,E(p,l)]:[...m,[E(p,l),"=",E(y,l)].join("")]}}function S(l){let p;switch(l.arrayFormat){case"index":return(m,y,g)=>{if(p=/\[(\d*)\]$/.exec(m),m=m.replace(/\[\d*\]$/,""),!p){g[m]=y;return}g[m]===void 0&&(g[m]={}),g[m][p[1]]=y};case"bracket":return(m,y,g)=>{if(p=/(\[\])$/.exec(m),m=m.replace(/\[\]$/,""),!p){g[m]=y;return}if(g[m]===void 0){g[m]=[y];return}g[m]=[].concat(g[m],y)};case"colon-list-separator":return(m,y,g)=>{if(p=/(:list)$/.exec(m),m=m.replace(/:list$/,""),!p){g[m]=y;return}if(g[m]===void 0){g[m]=[y];return}g[m]=[].concat(g[m],y)};case"comma":case"separator":return(m,y,g)=>{const N=typeof y=="string"&&y.includes(l.arrayFormatSeparator),P=typeof y=="string"&&!N&&O(y,l).includes(l.arrayFormatSeparator);y=P?O(y,l):y;const Q=N||P?y.split(l.arrayFormatSeparator).map(se=>O(se,l)):y===null?y:O(y,l);g[m]=Q};case"bracket-separator":return(m,y,g)=>{const N=/(\[\])$/.test(m);if(m=m.replace(/\[\]$/,""),!N){g[m]=y&&O(y,l);return}const P=y===null?[]:y.split(l.arrayFormatSeparator).map(Q=>O(Q,l));if(g[m]===void 0){g[m]=P;return}g[m]=[].concat(g[m],P)};default:return(m,y,g)=>{if(g[m]===void 0){g[m]=y;return}g[m]=[].concat(g[m],y)}}}function v(l){if(typeof l!="string"||l.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function E(l,p){return p.encode?p.strict?t(l):encodeURIComponent(l):l}function O(l,p){return p.decode?r(l):l}function R(l){return Array.isArray(l)?l.sort():typeof l=="object"?R(Object.keys(l)).sort((p,m)=>Number(p)-Number(m)).map(p=>l[p]):l}function z(l){const p=l.indexOf("#");return p!==-1&&(l=l.slice(0,p)),l}function q(l){let p="";const m=l.indexOf("#");return m!==-1&&(p=l.slice(m)),p}function W(l){l=z(l);const p=l.indexOf("?");return p===-1?"":l.slice(p+1)}function ie(l,p){return p.parseNumbers&&!Number.isNaN(Number(l))&&typeof l=="string"&&l.trim()!==""?l=Number(l):p.parseBooleans&&l!==null&&(l.toLowerCase()==="true"||l.toLowerCase()==="false")&&(l=l.toLowerCase()==="true"),l}function ce(l,p){p=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},p),v(p.arrayFormatSeparator);const m=S(p),y=Object.create(null);if(typeof l!="string"||(l=l.trim().replace(/^[?#&]/,""),!l))return y;for(const g of l.split("&")){if(g==="")continue;let[N,P]=s(p.decode?g.replace(/\+/g," "):g,"=");P=P===void 0?null:["comma","separator","bracket-separator"].includes(p.arrayFormat)?P:O(P,p),m(O(N,p),P,y)}for(const g of Object.keys(y)){const N=y[g];if(typeof N=="object"&&N!==null)for(const P of Object.keys(N))N[P]=ie(N[P],p);else y[g]=ie(N,p)}return p.sort===!1?y:(p.sort===!0?Object.keys(y).sort():Object.keys(y).sort(p.sort)).reduce((g,N)=>{const P=y[N];return P&&typeof P=="object"&&!Array.isArray(P)?g[N]=R(P):g[N]=P,g},Object.create(null))}n.extract=W,n.parse=ce,n.stringify=(l,p)=>{if(!l)return"";p=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},p),v(p.arrayFormatSeparator);const m=P=>p.skipNull&&c(l[P])||p.skipEmptyString&&l[P]==="",y=b(p),g={};for(const P of Object.keys(l))m(P)||(g[P]=l[P]);const N=Object.keys(g);return p.sort!==!1&&N.sort(p.sort),N.map(P=>{const Q=l[P];return Q===void 0?"":Q===null?E(P,p):Array.isArray(Q)?Q.length===0&&p.arrayFormat==="bracket-separator"?E(P,p)+"[]":Q.reduce(y(P),[]).join("&"):E(P,p)+"="+E(Q,p)}).filter(P=>P.length>0).join("&")},n.parseUrl=(l,p)=>{p=Object.assign({decode:!0},p);const[m,y]=s(l,"#");return Object.assign({url:m.split("?")[0]||"",query:ce(W(l),p)},p&&p.parseFragmentIdentifier&&y?{fragmentIdentifier:O(y,p)}:{})},n.stringifyUrl=(l,p)=>{p=Object.assign({encode:!0,strict:!0,[f]:!0},p);const m=z(l.url).split("?")[0]||"",y=n.extract(l.url),g=n.parse(y,{sort:!1}),N=Object.assign(g,l.query);let P=n.stringify(N,p);P&&(P=`?${P}`);let Q=q(l.url);return l.fragmentIdentifier&&(Q=`#${p[f]?E(l.fragmentIdentifier,p):l.fragmentIdentifier}`),`${m}${P}${Q}`},n.pick=(l,p,m)=>{m=Object.assign({parseFragmentIdentifier:!0,[f]:!1},m);const{url:y,query:g,fragmentIdentifier:N}=n.parseUrl(l,m);return n.stringifyUrl({url:y,query:a(g,p),fragmentIdentifier:N},m)},n.exclude=(l,p,m)=>{const y=Array.isArray(p)?g=>!p.includes(g):(g,N)=>!p(g,N);return n.pick(l,y,m)}})(tx);const rx=":";function ix(n){const[t,r]=n.split(rx);return{namespace:t,reference:r}}function $c(n=[],t=[]){return[...new Set([...n,...t])]}function _u(n){return n.includes(":")}function Zn(n){return _u(n)?n.split(":")[0]:n}const nx={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}};function If(n,t){const{message:r,code:s}=nx[n];return{message:t?`${r} ${t}`:r,code:s}}function Sf(n,t){return Array.isArray(n)?typeof t<"u"&&n.length?n.every(t):!0:!1}function sx(n){return Object.getPrototypeOf(n)===Object.prototype&&Object.keys(n).length}const xf="error",ax="wss://relay.walletconnect.com",ox="wc",cx="universal_provider",Pf=`${ox}@2:${cx}:`,ux="https://rpc.walletconnect.com/v1/",fi={DEFAULT_CHAIN_CHANGED:"default_chain_changed"};var Qn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},tu={exports:{}};/**
* @license
* Lodash <https://lodash.com/>
* Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
* Released under MIT license <https://lodash.com/license>
* Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
* Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
*/(function(n,t){(function(){var r,s="4.17.21",a=200,c="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",f="Expected a function",b="Invalid `variable` option passed into `_.template`",S="__lodash_hash_undefined__",v=500,E="__lodash_placeholder__",O=1,R=2,z=4,q=1,W=2,ie=1,ce=2,l=4,p=8,m=16,y=32,g=64,N=128,P=256,Q=512,se=30,Ee="...",Te=800,tt=16,L=1,V=2,Me=3,Ae=1/0,ee=9007199254740991,Y=17976931348623157e292,J=0/0,Z=4294967295,lt=Z-1,Ke=Z>>>1,Fr=[["ary",N],["bind",ie],["bindKey",ce],["curry",p],["curryRight",m],["flip",Q],["partial",y],["partialRight",g],["rearg",P]],be="[object Arguments]",St="[object Array]",F="[object AsyncFunction]",M="[object Boolean]",U="[object Date]",h="[object DOMException]",A="[object Error]",ae="[object Function]",de="[object GeneratorFunction]",ve="[object Map]",Re="[object Number]",$e="[object Null]",Se="[object Object]",xt="[object Promise]",_t="[object Proxy]",at="[object RegExp]",Ue="[object Set]",Je="[object String]",Ye="[object Symbol]",ot="[object Undefined]",ze="[object WeakMap]",Ze="[object WeakSet]",Ce="[object ArrayBuffer]",ke="[object DataView]",ht="[object Float32Array]",Le="[object Float64Array]",Pt="[object Int8Array]",Dt="[object Int16Array]",Ft="[object Int32Array]",Ht="[object Uint8Array]",Lt="[object Uint8ClampedArray]",Yt="[object Uint16Array]",ar="[object Uint32Array]",Hr=/\b__p \+= '';/g,Zt=/\b(__p \+=) '' \+/g,Jr=/(__e\(.*?\)|\b__t\)) \+\n'';/g,di=/&(?:amp|lt|gt|quot|#39);/g,Ni=/[&<>"']/g,ft=RegExp(di.source),rt=RegExp(Ni.source),dt=/<%-([\s\S]+?)%>/g,pt=/<%([\s\S]+?)%>/g,ct=/<%=([\s\S]+?)%>/g,it=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Ot=/^\w*$/,Nt=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,gt=/[\\^$.*+?()[\]{}|]/g,Tt=RegExp(gt.source),yt=/^\s+/,bt=/\s/,mt=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,Qe=/\{\n\/\* \[wrapped with (.+)\] \*/,At=/,? & /,Rt=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Ba=/[()=,{}\[\]\/\s]/,Ga=/\\(\\)?/g,Wa=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,wr=/\w*$/,Qa=/^[-+]0x[0-9a-f]+$/i,Ja=/^0b[01]+$/i,Ya=/^\[object .+?Constructor\]$/,Za=/^0o[0-7]+$/i,Xa=/^(?:0|[1-9]\d*)$/,Yr=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Qi=/($^)/,eo=/['\n\r\u2028\u2029\\]/g,Ji="\\ud800-\\udfff",to="\\u0300-\\u036f",ro="\\ufe20-\\ufe2f",Yi="\\u20d0-\\u20ff",ls=to+ro+Yi,hs="\\u2700-\\u27bf",Cr="a-z\\xdf-\\xf6\\xf8-\\xff",io="\\xac\\xb1\\xd7\\xf7",no="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",so="\\u2000-\\u206f",ao=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",fs="A-Z\\xc0-\\xd6\\xd8-\\xde",ds="\\ufe0e\\ufe0f",Ti=io+no+so+ao,In="[']",Ai="["+Ji+"]",Sn="["+Ti+"]",Ri="["+ls+"]",ps="\\d+",oo="["+hs+"]",gs="["+Cr+"]",ys="[^"+Ji+Ti+ps+hs+Cr+fs+"]",Zi="\\ud83c[\\udffb-\\udfff]",co="(?:"+Ri+"|"+Zi+")",ms="[^"+Ji+"]",Xi="(?:\\ud83c[\\udde6-\\uddff]){2}",pi="[\\ud800-\\udbff][\\udc00-\\udfff]",pr="["+fs+"]",vs="\\u200d",_s="(?:"+gs+"|"+ys+")",Kr="(?:"+pr+"|"+ys+")",bs="(?:"+In+"(?:d|ll|m|re|s|t|ve))?",ws="(?:"+In+"(?:D|LL|M|RE|S|T|VE))?",Es=co+"?",Is="["+ds+"]?",uo="(?:"+vs+"(?:"+[ms,Xi,pi].join("|")+")"+Is+Es+")*",Zr="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Ss="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",xs=Is+Es+uo,en="(?:"+[oo,Xi,pi].join("|")+")"+xs,lo="(?:"+[ms+Ri+"?",Ri,Xi,pi,Ai].join("|")+")",xn=RegExp(In,"g"),ho=RegExp(Ri,"g"),tn=RegExp(Zi+"(?="+Zi+")|"+lo+xs,"g"),Ps=RegExp([pr+"?"+gs+"+"+bs+"(?="+[Sn,pr,"$"].join("|")+")",Kr+"+"+ws+"(?="+[Sn,pr+_s,"$"].join("|")+")",pr+"?"+_s+"+"+bs,pr+"+"+ws,Ss,Zr,ps,en].join("|"),"g"),Os=RegExp("["+vs+Ji+ls+ds+"]"),Ci=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Ns=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],fo=-1,Ve={};Ve[ht]=Ve[Le]=Ve[Pt]=Ve[Dt]=Ve[Ft]=Ve[Ht]=Ve[Lt]=Ve[Yt]=Ve[ar]=!0,Ve[be]=Ve[St]=Ve[Ce]=Ve[M]=Ve[ke]=Ve[U]=Ve[A]=Ve[ae]=Ve[ve]=Ve[Re]=Ve[Se]=Ve[at]=Ve[Ue]=Ve[Je]=Ve[ze]=!1;var Fe={};Fe[be]=Fe[St]=Fe[Ce]=Fe[ke]=Fe[M]=Fe[U]=Fe[ht]=Fe[Le]=Fe[Pt]=Fe[Dt]=Fe[Ft]=Fe[ve]=Fe[Re]=Fe[Se]=Fe[at]=Fe[Ue]=Fe[Je]=Fe[Ye]=Fe[Ht]=Fe[Lt]=Fe[Yt]=Fe[ar]=!0,Fe[A]=Fe[ae]=Fe[ze]=!1;var I={:"A",:"A",:"A",:"A",:"A",:"A",:"a",:"a",:"a",:"a",:"a",:"a",:"C",:"c",:"D",:"d",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"N",:"n",:"O",:"O",:"O",:"O",:"O",:"O",:"o",:"o",:"o",:"o",:"o",:"o",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"Y",:"y",:"y",:"Ae",:"ae",:"Th",:"th",:"ss",:"A",:"A",:"A",:"a",:"a",:"a",:"C",:"C",:"C",:"C",:"c",:"c",:"c",:"c",:"D",:"D",:"d",:"d",:"E",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"e",:"G",:"G",:"G",:"G",:"g",:"g",:"g",:"g",:"H",:"H",:"h",:"h",:"I",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"i",:"J",:"j",:"K",:"k",:"k",:"L",:"L",:"L",:"L",:"L",:"l",:"l",:"l",:"l",:"l",:"N",:"N",:"N",:"N",:"n",:"n",:"n",:"n",:"O",:"O",:"O",:"o",:"o",:"o",:"R",:"R",:"R",:"r",:"r",:"r",:"S",:"S",:"S",:"S",:"s",:"s",:"s",:"s",:"T",:"T",:"T",:"t",:"t",:"t",:"U",:"U",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"u",:"u",:"W",:"w",:"Y",:"y",:"Y",:"Z",:"Z",:"Z",:"z",:"z",:"z",:"IJ",:"ij",:"Oe",:"oe",:"'n",:"s"},C={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},B={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},te={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Be=parseFloat,ge=parseInt,Xe=typeof Qn=="object"&&Qn&&Qn.Object===Object&&Qn,Ct=typeof self=="object"&&self&&self.Object===Object&&self,Pe=Xe||Ct||Function("return this")(),Ge=t&&!t.nodeType&&t,wt=Ge&&!0&&n&&!n.nodeType&&n,or=wt&&wt.exports===Ge,$t=or&&Xe.process,et=function(){try{var $=wt&&wt.require&&wt.require("util").types;return $||$t&&$t.binding&&$t.binding("util")}catch{}}(),Xt=et&&et.isArrayBuffer,$r=et&&et.isDate,Er=et&&et.isMap,kr=et&&et.isRegExp,Pn=et&&et.isSet,$i=et&&et.isTypedArray;function qt($,H,j){switch(j.length){case 0:return $.call(H);case 1:return $.call(H,j[0]);case 2:return $.call(H,j[0],j[1]);case 3:return $.call(H,j[0],j[1],j[2])}return $.apply(H,j)}function Cd($,H,j,re){for(var pe=-1,De=$==null?0:$.length;++pe<De;){var Ut=$[pe];H(re,Ut,j(Ut),$)}return re}function Ir($,H){for(var j=-1,re=$==null?0:$.length;++j<re&&H($[j],j,$)!==!1;);return $}function $d($,H){for(var j=$==null?0:$.length;j--&&H($[j],j,$)!==!1;);return $}function Eu($,H){for(var j=-1,re=$==null?0:$.length;++j<re;)if(!H($[j],j,$))return!1;return!0}function gi($,H){for(var j=-1,re=$==null?0:$.length,pe=0,De=[];++j<re;){var Ut=$[j];H(Ut,j,$)&&(De[pe++]=Ut)}return De}function Ts($,H){var j=$==null?0:$.length;return!!j&&rn($,H,0)>-1}function po($,H,j){for(var re=-1,pe=$==null?0:$.length;++re<pe;)if(j(H,$[re]))return!0;return!1}function nt($,H){for(var j=-1,re=$==null?0:$.length,pe=Array(re);++j<re;)pe[j]=H($[j],j,$);return pe}function yi($,H){for(var j=-1,re=H.length,pe=$.length;++j<re;)$[pe+j]=H[j];return $}function go($,H,j,re){var pe=-1,De=$==null?0:$.length;for(re&&De&&(j=$[++pe]);++pe<De;)j=H(j,$[pe],pe,$);return j}function Dd($,H,j,re){var pe=$==null?0:$.length;for(re&&pe&&(j=$[--pe]);pe--;)j=H(j,$[pe],pe,$);return j}function yo($,H){for(var j=-1,re=$==null?0:$.length;++j<re;)if(H($[j],j,$))return!0;return!1}var Ud=mo("length");function jd($){return $.split("")}function Ld($){return $.match(Rt)||[]}function Iu($,H,j){var re;return j($,function(pe,De,Ut){if(H(pe,De,Ut))return re=De,!1}),re}function As($,H,j,re){for(var pe=$.length,De=j+(re?1:-1);re?De--:++De<pe;)if(H($[De],De,$))return De;return-1}function rn($,H,j){return H===H?Qd($,H,j):As($,Su,j)}function qd($,H,j,re){for(var pe=j-1,De=$.length;++pe<De;)if(re($[pe],H))return pe;return-1}function Su($){return $!==$}function xu($,H){var j=$==null?0:$.length;return j?_o($,H)/j:J}function mo($){return function(H){return H==null?r:H[$]}}function vo($){return function(H){return $==null?r:$[H]}}function Pu($,H,j,re,pe){return pe($,function(De,Ut,We){j=re?(re=!1,De):H(j,De,Ut,We)}),j}function Md($,H){var j=$.length;for($.sort(H);j--;)$[j]=$[j].value;return $}function _o($,H){for(var j,re=-1,pe=$.length;++re<pe;){var De=H($[re]);De!==r&&(j=j===r?De:j+De)}return j}function bo($,H){for(var j=-1,re=Array($);++j<$;)re[j]=H(j);return re}function zd($,H){return nt(H,function(j){return[j,$[j]]})}function Ou($){return $&&$.slice(0,Ru($)+1).replace(yt,"")}function gr($){return function(H){return $(H)}}function wo($,H){return nt(H,function(j){return $[j]})}function On($,H){return $.has(H)}function Nu($,H){for(var j=-1,re=$.length;++j<re&&rn(H,$[j],0)>-1;);return j}function Tu($,H){for(var j=$.length;j--&&rn(H,$[j],0)>-1;);return j}function Fd($,H){for(var j=$.length,re=0;j--;)$[j]===H&&++re;return re}var Hd=vo(I),Kd=vo(C);function kd($){return"\\"+te[$]}function Vd($,H){return $==null?r:$[H]}function nn($){return Os.test($)}function Bd($){return Ci.test($)}function Gd($){for(var H,j=[];!(H=$.next()).done;)j.push(H.value);return j}function Eo($){var H=-1,j=Array($.size);return $.forEach(function(re,pe){j[++H]=[pe,re]}),j}function Au($,H){return function(j){return $(H(j))}}function mi($,H){for(var j=-1,re=$.length,pe=0,De=[];++j<re;){var Ut=$[j];(Ut===H||Ut===E)&&($[j]=E,De[pe++]=j)}return De}function Rs($){var H=-1,j=Array($.size);return $.forEach(function(re){j[++H]=re}),j}function Wd($){var H=-1,j=Array($.size);return $.forEach(function(re){j[++H]=[re,re]}),j}function Qd($,H,j){for(var re=j-1,pe=$.length;++re<pe;)if($[re]===H)return re;return-1}function Jd($,H,j){for(var re=j+1;re--;)if($[re]===H)return re;return re}function sn($){return nn($)?Zd($):Ud($)}function Dr($){return nn($)?Xd($):jd($)}function Ru($){for(var H=$.length;H--&&bt.test($.charAt(H)););return H}var Yd=vo(B);function Zd($){for(var H=tn.lastIndex=0;tn.test($);)++H;return H}function Xd($){return $.match(tn)||[]}function ep($){return $.match(Ps)||[]}var tp=function $(H){H=H==null?Pe:an.defaults(Pe.Object(),H,an.pick(Pe,Ns));var j=H.Array,re=H.Date,pe=H.Error,De=H.Function,Ut=H.Math,We=H.Object,Io=H.RegExp,rp=H.String,Sr=H.TypeError,Cs=j.prototype,ip=De.prototype,on=We.prototype,$s=H["__core-js_shared__"],Ds=ip.toString,qe=on.hasOwnProperty,np=0,Cu=function(){var e=/[^.]+$/.exec($s&&$s.keys&&$s.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),Us=on.toString,sp=Ds.call(We),ap=Pe._,op=Io("^"+Ds.call(qe).replace(gt,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),js=or?H.Buffer:r,vi=H.Symbol,Ls=H.Uint8Array,$u=js?js.allocUnsafe:r,qs=Au(We.getPrototypeOf,We),Du=We.create,Uu=on.propertyIsEnumerable,Ms=Cs.splice,ju=vi?vi.isConcatSpreadable:r,Nn=vi?vi.iterator:r,Di=vi?vi.toStringTag:r,zs=function(){try{var e=Mi(We,"defineProperty");return e({},"",{}),e}catch{}}(),cp=H.clearTimeout!==Pe.clearTimeout&&H.clearTimeout,up=re&&re.now!==Pe.Date.now&&re.now,lp=H.setTimeout!==Pe.setTimeout&&H.setTimeout,Fs=Ut.ceil,Hs=Ut.floor,So=We.getOwnPropertySymbols,hp=js?js.isBuffer:r,Lu=H.isFinite,fp=Cs.join,dp=Au(We.keys,We),jt=Ut.max,Bt=Ut.min,pp=re.now,gp=H.parseInt,qu=Ut.random,yp=Cs.reverse,xo=Mi(H,"DataView"),Tn=Mi(H,"Map"),Po=Mi(H,"Promise"),cn=Mi(H,"Set"),An=Mi(H,"WeakMap"),Rn=Mi(We,"create"),Ks=An&&new An,un={},mp=zi(xo),vp=zi(Tn),_p=zi(Po),bp=zi(cn),wp=zi(An),ks=vi?vi.prototype:r,Cn=ks?ks.valueOf:r,Mu=ks?ks.toString:r;function _(e){if(vt(e)&&!ye(e)&&!(e instanceof xe)){if(e instanceof xr)return e;if(qe.call(e,"__wrapped__"))return zl(e)}return new xr(e)}var ln=function(){function e(){}return function(i){if(!ut(i))return{};if(Du)return Du(i);e.prototype=i;var o=new e;return e.prototype=r,o}}();function Vs(){}function xr(e,i){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!i,this.__index__=0,this.__values__=r}_.templateSettings={escape:dt,evaluate:pt,interpolate:ct,variable:"",imports:{_}},_.prototype=Vs.prototype,_.prototype.constructor=_,xr.prototype=ln(Vs.prototype),xr.prototype.constructor=xr;function xe(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=Z,this.__views__=[]}function Ep(){var e=new xe(this.__wrapped__);return e.__actions__=cr(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=cr(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=cr(this.__views__),e}function Ip(){if(this.__filtered__){var e=new xe(this);e.__dir__=-1,e.__filtered__=!0}else e=this.clone(),e.__dir__*=-1;return e}function Sp(){var e=this.__wrapped__.value(),i=this.__dir__,o=ye(e),u=i<0,d=o?e.length:0,w=jg(0,d,this.__views__),x=w.start,T=w.end,D=T-x,K=u?T:x-1,k=this.__iteratees__,G=k.length,X=0,oe=Bt(D,this.__takeCount__);if(!o||!u&&d==D&&oe==D)return ul(e,this.__actions__);var le=[];e:for(;D--&&X<oe;){K+=i;for(var _e=-1,he=e[K];++_e<G;){var Ie=k[_e],Oe=Ie.iteratee,vr=Ie.type,rr=Oe(he);if(vr==V)he=rr;else if(!rr){if(vr==L)continue e;break e}}le[X++]=he}return le}xe.prototype=ln(Vs.prototype),xe.prototype.constructor=xe;function Ui(e){var i=-1,o=e==null?0:e.length;for(this.clear();++i<o;){var u=e[i];this.set(u[0],u[1])}}function xp(){this.__data__=Rn?Rn(null):{},this.size=0}function Pp(e){var i=this.has(e)&&delete this.__data__[e];return this.size-=i?1:0,i}function Op(e){var i=this.__data__;if(Rn){var o=i[e];return o===S?r:o}return qe.call(i,e)?i[e]:r}function Np(e){var i=this.__data__;return Rn?i[e]!==r:qe.call(i,e)}function Tp(e,i){var o=this.__data__;return this.size+=this.has(e)?0:1,o[e]=Rn&&i===r?S:i,this}Ui.prototype.clear=xp,Ui.prototype.delete=Pp,Ui.prototype.get=Op,Ui.prototype.has=Np,Ui.prototype.set=Tp;function Xr(e){var i=-1,o=e==null?0:e.length;for(this.clear();++i<o;){var u=e[i];this.set(u[0],u[1])}}function Ap(){this.__data__=[],this.size=0}function Rp(e){var i=this.__data__,o=Bs(i,e);if(o<0)return!1;var u=i.length-1;return o==u?i.pop():Ms.call(i,o,1),--this.size,!0}function Cp(e){var i=this.__data__,o=Bs(i,e);return o<0?r:i[o][1]}function $p(e){return Bs(this.__data__,e)>-1}function Dp(e,i){var o=this.__data__,u=Bs(o,e);return u<0?(++this.size,o.push([e,i])):o[u][1]=i,this}Xr.prototype.clear=Ap,Xr.prototype.delete=Rp,Xr.prototype.get=Cp,Xr.prototype.has=$p,Xr.prototype.set=Dp;function ei(e){var i=-1,o=e==null?0:e.length;for(this.clear();++i<o;){var u=e[i];this.set(u[0],u[1])}}function Up(){this.size=0,this.__data__={hash:new Ui,map:new(Tn||Xr),string:new Ui}}function jp(e){var i=na(this,e).delete(e);return this.size-=i?1:0,i}function Lp(e){return na(this,e).get(e)}function qp(e){return na(this,e).has(e)}function Mp(e,i){var o=na(this,e),u=o.size;return o.set(e,i),this.size+=o.size==u?0:1,this}ei.prototype.clear=Up,ei.prototype.delete=jp,ei.prototype.get=Lp,ei.prototype.has=qp,ei.prototype.set=Mp;function ji(e){var i=-1,o=e==null?0:e.length;for(this.__data__=new ei;++i<o;)this.add(e[i])}function zp(e){return this.__data__.set(e,S),this}function Fp(e){return this.__data__.has(e)}ji.prototype.add=ji.prototype.push=zp,ji.prototype.has=Fp;function Ur(e){var i=this.__data__=new Xr(e);this.size=i.size}function Hp(){this.__data__=new Xr,this.size=0}function Kp(e){var i=this.__data__,o=i.delete(e);return this.size=i.size,o}function kp(e){return this.__data__.get(e)}function Vp(e){return this.__data__.has(e)}function Bp(e,i){var o=this.__data__;if(o instanceof Xr){var u=o.__data__;if(!Tn||u.length<a-1)return u.push([e,i]),this.size=++o.size,this;o=this.__data__=new ei(u)}return o.set(e,i),this.size=o.size,this}Ur.prototype.clear=Hp,Ur.prototype.delete=Kp,Ur.prototype.get=kp,Ur.prototype.has=Vp,Ur.prototype.set=Bp;function zu(e,i){var o=ye(e),u=!o&&Fi(e),d=!o&&!u&&Ii(e),w=!o&&!u&&!d&&pn(e),x=o||u||d||w,T=x?bo(e.length,rp):[],D=T.length;for(var K in e)(i||qe.call(e,K))&&!(x&&(K=="length"||d&&(K=="offset"||K=="parent")||w&&(K=="buffer"||K=="byteLength"||K=="byteOffset")||ni(K,D)))&&T.push(K);return T}function Fu(e){var i=e.length;return i?e[Lo(0,i-1)]:r}function Gp(e,i){return sa(cr(e),Li(i,0,e.length))}function Wp(e){return sa(cr(e))}function Oo(e,i,o){(o!==r&&!jr(e[i],o)||o===r&&!(i in e))&&ti(e,i,o)}function $n(e,i,o){var u=e[i];(!(qe.call(e,i)&&jr(u,o))||o===r&&!(i in e))&&ti(e,i,o)}function Bs(e,i){for(var o=e.length;o--;)if(jr(e[o][0],i))return o;return-1}function Qp(e,i,o,u){return _i(e,function(d,w,x){i(u,d,o(d),x)}),u}function Hu(e,i){return e&&Br(i,Mt(i),e)}function Jp(e,i){return e&&Br(i,lr(i),e)}function ti(e,i,o){i=="__proto__"&&zs?zs(e,i,{configurable:!0,enumerable:!0,value:o,writable:!0}):e[i]=o}function No(e,i){for(var o=-1,u=i.length,d=j(u),w=e==null;++o<u;)d[o]=w?r:cc(e,i[o]);return d}function Li(e,i,o){return e===e&&(o!==r&&(e=e<=o?e:o),i!==r&&(e=e>=i?e:i)),e}function Pr(e,i,o,u,d,w){var x,T=i&O,D=i&R,K=i&z;if(o&&(x=d?o(e,u,d,w):o(e)),x!==r)return x;if(!ut(e))return e;var k=ye(e);if(k){if(x=qg(e),!T)return cr(e,x)}else{var G=Gt(e),X=G==ae||G==de;if(Ii(e))return fl(e,T);if(G==Se||G==be||X&&!d){if(x=D||X?{}:Rl(e),!T)return D?Og(e,Jp(x,e)):Pg(e,Hu(x,e))}else{if(!Fe[G])return d?e:{};x=Mg(e,G,T)}}w||(w=new Ur);var oe=w.get(e);if(oe)return oe;w.set(e,x),ah(e)?e.forEach(function(he){x.add(Pr(he,i,o,he,e,w))}):nh(e)&&e.forEach(function(he,Ie){x.set(Ie,Pr(he,i,o,Ie,e,w))});var le=K?D?Wo:Go:D?lr:Mt,_e=k?r:le(e);return Ir(_e||e,function(he,Ie){_e&&(Ie=he,he=e[Ie]),$n(x,Ie,Pr(he,i,o,Ie,e,w))}),x}function Yp(e){var i=Mt(e);return function(o){return Ku(o,e,i)}}function Ku(e,i,o){var u=o.length;if(e==null)return!u;for(e=We(e);u--;){var d=o[u],w=i[d],x=e[d];if(x===r&&!(d in e)||!w(x))return!1}return!0}function ku(e,i,o){if(typeof e!="function")throw new Sr(f);return zn(function(){e.apply(r,o)},i)}function Dn(e,i,o,u){var d=-1,w=Ts,x=!0,T=e.length,D=[],K=i.length;if(!T)return D;o&&(i=nt(i,gr(o))),u?(w=po,x=!1):i.length>=a&&(w=On,x=!1,i=new ji(i));e:for(;++d<T;){var k=e[d],G=o==null?k:o(k);if(k=u||k!==0?k:0,x&&G===G){for(var X=K;X--;)if(i[X]===G)continue e;D.push(k)}else w(i,G,u)||D.push(k)}return D}var _i=ml(Vr),Vu=ml(Ao,!0);function Zp(e,i){var o=!0;return _i(e,function(u,d,w){return o=!!i(u,d,w),o}),o}function Gs(e,i,o){for(var u=-1,d=e.length;++u<d;){var w=e[u],x=i(w);if(x!=null&&(T===r?x===x&&!mr(x):o(x,T)))var T=x,D=w}return D}function Xp(e,i,o,u){var d=e.length;for(o=me(o),o<0&&(o=-o>d?0:d+o),u=u===r||u>d?d:me(u),u<0&&(u+=d),u=o>u?0:ch(u);o<u;)e[o++]=i;return e}function Bu(e,i){var o=[];return _i(e,function(u,d,w){i(u,d,w)&&o.push(u)}),o}function Kt(e,i,o,u,d){var w=-1,x=e.length;for(o||(o=Fg),d||(d=[]);++w<x;){var T=e[w];i>0&&o(T)?i>1?Kt(T,i-1,o,u,d):yi(d,T):u||(d[d.length]=T)}return d}var To=vl(),Gu=vl(!0);function Vr(e,i){return e&&To(e,i,Mt)}function Ao(e,i){return e&&Gu(e,i,Mt)}function Ws(e,i){return gi(i,function(o){return si(e[o])})}function qi(e,i){i=wi(i,e);for(var o=0,u=i.length;e!=null&&o<u;)e=e[Gr(i[o++])];return o&&o==u?e:r}function Wu(e,i,o){var u=i(e);return ye(e)?u:yi(u,o(e))}function er(e){return e==null?e===r?ot:$e:Di&&Di in We(e)?Ug(e):Wg(e)}function Ro(e,i){return e>i}function eg(e,i){return e!=null&&qe.call(e,i)}function tg(e,i){return e!=null&&i in We(e)}function rg(e,i,o){return e>=Bt(i,o)&&e<jt(i,o)}function Co(e,i,o){for(var u=o?po:Ts,d=e[0].length,w=e.length,x=w,T=j(w),D=1/0,K=[];x--;){var k=e[x];x&&i&&(k=nt(k,gr(i))),D=Bt(k.length,D),T[x]=!o&&(i||d>=120&&k.length>=120)?new ji(x&&k):r}k=e[0];var G=-1,X=T[0];e:for(;++G<d&&K.length<D;){var oe=k[G],le=i?i(oe):oe;if(oe=o||oe!==0?oe:0,!(X?On(X,le):u(K,le,o))){for(x=w;--x;){var _e=T[x];if(!(_e?On(_e,le):u(e[x],le,o)))continue e}X&&X.push(le),K.push(oe)}}return K}function ig(e,i,o,u){return Vr(e,function(d,w,x){i(u,o(d),w,x)}),u}function Un(e,i,o){i=wi(i,e),e=Ul(e,i);var u=e==null?e:e[Gr(Nr(i))];return u==null?r:qt(u,e,o)}function Qu(e){return vt(e)&&er(e)==be}function ng(e){return vt(e)&&er(e)==Ce}function sg(e){return vt(e)&&er(e)==U}function jn(e,i,o,u,d){return e===i?!0:e==null||i==null||!vt(e)&&!vt(i)?e!==e&&i!==i:ag(e,i,o,u,jn,d)}function ag(e,i,o,u,d,w){var x=ye(e),T=ye(i),D=x?St:Gt(e),K=T?St:Gt(i);D=D==be?Se:D,K=K==be?Se:K;var k=D==Se,G=K==Se,X=D==K;if(X&&Ii(e)){if(!Ii(i))return!1;x=!0,k=!1}if(X&&!k)return w||(w=new Ur),x||pn(e)?Nl(e,i,o,u,d,w):$g(e,i,D,o,u,d,w);if(!(o&q)){var oe=k&&qe.call(e,"__wrapped__"),le=G&&qe.call(i,"__wrapped__");if(oe||le){var _e=oe?e.value():e,he=le?i.value():i;return w||(w=new Ur),d(_e,he,o,u,w)}}return X?(w||(w=new Ur),Dg(e,i,o,u,d,w)):!1}function og(e){return vt(e)&&Gt(e)==ve}function $o(e,i,o,u){var d=o.length,w=d,x=!u;if(e==null)return!w;for(e=We(e);d--;){var T=o[d];if(x&&T[2]?T[1]!==e[T[0]]:!(T[0]in e))return!1}for(;++d<w;){T=o[d];var D=T[0],K=e[D],k=T[1];if(x&&T[2]){if(K===r&&!(D in e))return!1}else{var G=new Ur;if(u)var X=u(K,k,D,e,i,G);if(!(X===r?jn(k,K,q|W,u,G):X))return!1}}return!0}function Ju(e){if(!ut(e)||Kg(e))return!1;var i=si(e)?op:Ya;return i.test(zi(e))}function cg(e){return vt(e)&&er(e)==at}function ug(e){return vt(e)&&Gt(e)==Ue}function lg(e){return vt(e)&&ha(e.length)&&!!Ve[er(e)]}function Yu(e){return typeof e=="function"?e:e==null?hr:typeof e=="object"?ye(e)?el(e[0],e[1]):Xu(e):_h(e)}function Do(e){if(!Mn(e))return dp(e);var i=[];for(var o in We(e))qe.call(e,o)&&o!="constructor"&&i.push(o);return i}function hg(e){if(!ut(e))return Gg(e);var i=Mn(e),o=[];for(var u in e)u=="constructor"&&(i||!qe.call(e,u))||o.push(u);return o}function Uo(e,i){return e<i}function Zu(e,i){var o=-1,u=ur(e)?j(e.length):[];return _i(e,function(d,w,x){u[++o]=i(d,w,x)}),u}function Xu(e){var i=Jo(e);return i.length==1&&i[0][2]?$l(i[0][0],i[0][1]):function(o){return o===e||$o(o,e,i)}}function el(e,i){return Zo(e)&&Cl(i)?$l(Gr(e),i):function(o){var u=cc(o,e);return u===r&&u===i?uc(o,e):jn(i,u,q|W)}}function Qs(e,i,o,u,d){e!==i&&To(i,function(w,x){if(d||(d=new Ur),ut(w))fg(e,i,x,o,Qs,u,d);else{var T=u?u(ec(e,x),w,x+"",e,i,d):r;T===r&&(T=w),Oo(e,x,T)}},lr)}function fg(e,i,o,u,d,w,x){var T=ec(e,o),D=ec(i,o),K=x.get(D);if(K){Oo(e,o,K);return}var k=w?w(T,D,o+"",e,i,x):r,G=k===r;if(G){var X=ye(D),oe=!X&&Ii(D),le=!X&&!oe&&pn(D);k=D,X||oe||le?ye(T)?k=T:Et(T)?k=cr(T):oe?(G=!1,k=fl(D,!0)):le?(G=!1,k=dl(D,!0)):k=[]:Fn(D)||Fi(D)?(k=T,Fi(T)?k=uh(T):(!ut(T)||si(T))&&(k=Rl(D))):G=!1}G&&(x.set(D,k),d(k,D,u,w,x),x.delete(D)),Oo(e,o,k)}function tl(e,i){var o=e.length;if(o)return i+=i<0?o:0,ni(i,o)?e[i]:r}function rl(e,i,o){i.length?i=nt(i,function(w){return ye(w)?function(x){return qi(x,w.length===1?w[0]:w)}:w}):i=[hr];var u=-1;i=nt(i,gr(ue()));var d=Zu(e,function(w,x,T){var D=nt(i,function(K){return K(w)});return{criteria:D,index:++u,value:w}});return Md(d,function(w,x){return xg(w,x,o)})}function dg(e,i){return il(e,i,function(o,u){return uc(e,u)})}function il(e,i,o){for(var u=-1,d=i.length,w={};++u<d;){var x=i[u],T=qi(e,x);o(T,x)&&Ln(w,wi(x,e),T)}return w}function pg(e){return function(i){return qi(i,e)}}function jo(e,i,o,u){var d=u?qd:rn,w=-1,x=i.length,T=e;for(e===i&&(i=cr(i)),o&&(T=nt(e,gr(o)));++w<x;)for(var D=0,K=i[w],k=o?o(K):K;(D=d(T,k,D,u))>-1;)T!==e&&Ms.call(T,D,1),Ms.call(e,D,1);return e}function nl(e,i){for(var o=e?i.length:0,u=o-1;o--;){var d=i[o];if(o==u||d!==w){var w=d;ni(d)?Ms.call(e,d,1):zo(e,d)}}return e}function Lo(e,i){return e+Hs(qu()*(i-e+1))}function gg(e,i,o,u){for(var d=-1,w=jt(Fs((i-e)/(o||1)),0),x=j(w);w--;)x[u?w:++d]=e,e+=o;return x}function qo(e,i){var o="";if(!e||i<1||i>ee)return o;do i%2&&(o+=e),i=Hs(i/2),i&&(e+=e);while(i);return o}function we(e,i){return tc(Dl(e,i,hr),e+"")}function yg(e){return Fu(gn(e))}function mg(e,i){var o=gn(e);return sa(o,Li(i,0,o.length))}function Ln(e,i,o,u){if(!ut(e))return e;i=wi(i,e);for(var d=-1,w=i.length,x=w-1,T=e;T!=null&&++d<w;){var D=Gr(i[d]),K=o;if(D==="__proto__"||D==="constructor"||D==="prototype")return e;if(d!=x){var k=T[D];K=u?u(k,D,T):r,K===r&&(K=ut(k)?k:ni(i[d+1])?[]:{})}$n(T,D,K),T=T[D]}return e}var sl=Ks?function(e,i){return Ks.set(e,i),e}:hr,vg=zs?function(e,i){return zs(e,"toString",{configurable:!0,enumerable:!1,value:hc(i),writable:!0})}:hr;function _g(e){return sa(gn(e))}function Or(e,i,o){var u=-1,d=e.length;i<0&&(i=-i>d?0:d+i),o=o>d?d:o,o<0&&(o+=d),d=i>o?0:o-i>>>0,i>>>=0;for(var w=j(d);++u<d;)w[u]=e[u+i];return w}function bg(e,i){var o;return _i(e,function(u,d,w){return o=i(u,d,w),!o}),!!o}function Js(e,i,o){var u=0,d=e==null?u:e.length;if(typeof i=="number"&&i===i&&d<=Ke){for(;u<d;){var w=u+d>>>1,x=e[w];x!==null&&!mr(x)&&(o?x<=i:x<i)?u=w+1:d=w}return d}return Mo(e,i,hr,o)}function Mo(e,i,o,u){var d=0,w=e==null?0:e.length;if(w===0)return 0;i=o(i);for(var x=i!==i,T=i===null,D=mr(i),K=i===r;d<w;){var k=Hs((d+w)/2),G=o(e[k]),X=G!==r,oe=G===null,le=G===G,_e=mr(G);if(x)var he=u||le;else K?he=le&&(u||X):T?he=le&&X&&(u||!oe):D?he=le&&X&&!oe&&(u||!_e):oe||_e?he=!1:he=u?G<=i:G<i;he?d=k+1:w=k}return Bt(w,lt)}function al(e,i){for(var o=-1,u=e.length,d=0,w=[];++o<u;){var x=e[o],T=i?i(x):x;if(!o||!jr(T,D)){var D=T;w[d++]=x===0?0:x}}return w}function ol(e){return typeof e=="number"?e:mr(e)?J:+e}function yr(e){if(typeof e=="string")return e;if(ye(e))return nt(e,yr)+"";if(mr(e))return Mu?Mu.call(e):"";var i=e+"";return i=="0"&&1/e==-Ae?"-0":i}function bi(e,i,o){var u=-1,d=Ts,w=e.length,x=!0,T=[],D=T;if(o)x=!1,d=po;else if(w>=a){var K=i?null:Rg(e);if(K)return Rs(K);x=!1,d=On,D=new ji}else D=i?[]:T;e:for(;++u<w;){var k=e[u],G=i?i(k):k;if(k=o||k!==0?k:0,x&&G===G){for(var X=D.length;X--;)if(D[X]===G)continue e;i&&D.push(G),T.push(k)}else d(D,G,o)||(D!==T&&D.push(G),T.push(k))}return T}function zo(e,i){return i=wi(i,e),e=Ul(e,i),e==null||delete e[Gr(Nr(i))]}function cl(e,i,o,u){return Ln(e,i,o(qi(e,i)),u)}function Ys(e,i,o,u){for(var d=e.length,w=u?d:-1;(u?w--:++w<d)&&i(e[w],w,e););return o?Or(e,u?0:w,u?w+1:d):Or(e,u?w+1:0,u?d:w)}function ul(e,i){var o=e;return o instanceof xe&&(o=o.value()),go(i,function(u,d){return d.func.apply(d.thisArg,yi([u],d.args))},o)}function Fo(e,i,o){var u=e.length;if(u<2)return u?bi(e[0]):[];for(var d=-1,w=j(u);++d<u;)for(var x=e[d],T=-1;++T<u;)T!=d&&(w[d]=Dn(w[d]||x,e[T],i,o));return bi(Kt(w,1),i,o)}function ll(e,i,o){for(var u=-1,d=e.length,w=i.length,x={};++u<d;){var T=u<w?i[u]:r;o(x,e[u],T)}return x}function Ho(e){return Et(e)?e:[]}function Ko(e){return typeof e=="function"?e:hr}function wi(e,i){return ye(e)?e:Zo(e,i)?[e]:Ml(je(e))}var wg=we;function Ei(e,i,o){var u=e.length;return o=o===r?u:o,!i&&o>=u?e:Or(e,i,o)}var hl=cp||function(e){return Pe.clearTimeout(e)};function fl(e,i){if(i)return e.slice();var o=e.length,u=$u?$u(o):new e.constructor(o);return e.copy(u),u}function ko(e){var i=new e.constructor(e.byteLength);return new Ls(i).set(new Ls(e)),i}function Eg(e,i){var o=i?ko(e.buffer):e.buffer;return new e.constructor(o,e.byteOffset,e.byteLength)}function Ig(e){var i=new e.constructor(e.source,wr.exec(e));return i.lastIndex=e.lastIndex,i}function Sg(e){return Cn?We(Cn.call(e)):{}}function dl(e,i){var o=i?ko(e.buffer):e.buffer;return new e.constructor(o,e.byteOffset,e.length)}function pl(e,i){if(e!==i){var o=e!==r,u=e===null,d=e===e,w=mr(e),x=i!==r,T=i===null,D=i===i,K=mr(i);if(!T&&!K&&!w&&e>i||w&&x&&D&&!T&&!K||u&&x&&D||!o&&D||!d)return 1;if(!u&&!w&&!K&&e<i||K&&o&&d&&!u&&!w||T&&o&&d||!x&&d||!D)return-1}return 0}function xg(e,i,o){for(var u=-1,d=e.criteria,w=i.criteria,x=d.length,T=o.length;++u<x;){var D=pl(d[u],w[u]);if(D){if(u>=T)return D;var K=o[u];return D*(K=="desc"?-1:1)}}return e.index-i.index}function gl(e,i,o,u){for(var d=-1,w=e.length,x=o.length,T=-1,D=i.length,K=jt(w-x,0),k=j(D+K),G=!u;++T<D;)k[T]=i[T];for(;++d<x;)(G||d<w)&&(k[o[d]]=e[d]);for(;K--;)k[T++]=e[d++];return k}function yl(e,i,o,u){for(var d=-1,w=e.length,x=-1,T=o.length,D=-1,K=i.length,k=jt(w-T,0),G=j(k+K),X=!u;++d<k;)G[d]=e[d];for(var oe=d;++D<K;)G[oe+D]=i[D];for(;++x<T;)(X||d<w)&&(G[oe+o[x]]=e[d++]);return G}function cr(e,i){var o=-1,u=e.length;for(i||(i=j(u));++o<u;)i[o]=e[o];return i}function Br(e,i,o,u){var d=!o;o||(o={});for(var w=-1,x=i.length;++w<x;){var T=i[w],D=u?u(o[T],e[T],T,o,e):r;D===r&&(D=e[T]),d?ti(o,T,D):$n(o,T,D)}return o}function Pg(e,i){return Br(e,Yo(e),i)}function Og(e,i){return Br(e,Tl(e),i)}function Zs(e,i){return function(o,u){var d=ye(o)?Cd:Qp,w=i?i():{};return d(o,e,ue(u,2),w)}}function hn(e){return we(function(i,o){var u=-1,d=o.length,w=d>1?o[d-1]:r,x=d>2?o[2]:r;for(w=e.length>3&&typeof w=="function"?(d--,w):r,x&&tr(o[0],o[1],x)&&(w=d<3?r:w,d=1),i=We(i);++u<d;){var T=o[u];T&&e(i,T,u,w)}return i})}function ml(e,i){return function(o,u){if(o==null)return o;if(!ur(o))return e(o,u);for(var d=o.length,w=i?d:-1,x=We(o);(i?w--:++w<d)&&u(x[w],w,x)!==!1;);return o}}function vl(e){return function(i,o,u){for(var d=-1,w=We(i),x=u(i),T=x.length;T--;){var D=x[e?T:++d];if(o(w[D],D,w)===!1)break}return i}}function Ng(e,i,o){var u=i&ie,d=qn(e);function w(){var x=this&&this!==Pe&&this instanceof w?d:e;return x.apply(u?o:this,arguments)}return w}function _l(e){return function(i){i=je(i);var o=nn(i)?Dr(i):r,u=o?o[0]:i.charAt(0),d=o?Ei(o,1).join(""):i.slice(1);return u[e]()+d}}function fn(e){return function(i){return go(mh(yh(i).replace(xn,"")),e,"")}}function qn(e){return function(){var i=arguments;switch(i.length){case 0:return new e;case 1:return new e(i[0]);case 2:return new e(i[0],i[1]);case 3:return new e(i[0],i[1],i[2]);case 4:return new e(i[0],i[1],i[2],i[3]);case 5:return new e(i[0],i[1],i[2],i[3],i[4]);case 6:return new e(i[0],i[1],i[2],i[3],i[4],i[5]);case 7:return new e(i[0],i[1],i[2],i[3],i[4],i[5],i[6])}var o=ln(e.prototype),u=e.apply(o,i);return ut(u)?u:o}}function Tg(e,i,o){var u=qn(e);function d(){for(var w=arguments.length,x=j(w),T=w,D=dn(d);T--;)x[T]=arguments[T];var K=w<3&&x[0]!==D&&x[w-1]!==D?[]:mi(x,D);if(w-=K.length,w<o)return Sl(e,i,Xs,d.placeholder,r,x,K,r,r,o-w);var k=this&&this!==Pe&&this instanceof d?u:e;return qt(k,this,x)}return d}function bl(e){return function(i,o,u){var d=We(i);if(!ur(i)){var w=ue(o,3);i=Mt(i),o=function(T){return w(d[T],T,d)}}var x=e(i,o,u);return x>-1?d[w?i[x]:x]:r}}function wl(e){return ii(function(i){var o=i.length,u=o,d=xr.prototype.thru;for(e&&i.reverse();u--;){var w=i[u];if(typeof w!="function")throw new Sr(f);if(d&&!x&&ia(w)=="wrapper")var x=new xr([],!0)}for(u=x?u:o;++u<o;){w=i[u];var T=ia(w),D=T=="wrapper"?Qo(w):r;D&&Xo(D[0])&&D[1]==(N|p|y|P)&&!D[4].length&&D[9]==1?x=x[ia(D[0])].apply(x,D[3]):x=w.length==1&&Xo(w)?x[T]():x.thru(w)}return function(){var K=arguments,k=K[0];if(x&&K.length==1&&ye(k))return x.plant(k).value();for(var G=0,X=o?i[G].apply(this,K):k;++G<o;)X=i[G].call(this,X);return X}})}function Xs(e,i,o,u,d,w,x,T,D,K){var k=i&N,G=i&ie,X=i&ce,oe=i&(p|m),le=i&Q,_e=X?r:qn(e);function he(){for(var Ie=arguments.length,Oe=j(Ie),vr=Ie;vr--;)Oe[vr]=arguments[vr];if(oe)var rr=dn(he),_r=Fd(Oe,rr);if(u&&(Oe=gl(Oe,u,d,oe)),w&&(Oe=yl(Oe,w,x,oe)),Ie-=_r,oe&&Ie<K){var It=mi(Oe,rr);return Sl(e,i,Xs,he.placeholder,o,Oe,It,T,D,K-Ie)}var Lr=G?o:this,oi=X?Lr[e]:e;return Ie=Oe.length,T?Oe=Qg(Oe,T):le&&Ie>1&&Oe.reverse(),k&&D<Ie&&(Oe.length=D),this&&this!==Pe&&this instanceof he&&(oi=_e||qn(oi)),oi.apply(Lr,Oe)}return he}function El(e,i){return function(o,u){return ig(o,e,i(u),{})}}function ea(e,i){return function(o,u){var d;if(o===r&&u===r)return i;if(o!==r&&(d=o),u!==r){if(d===r)return u;typeof o=="string"||typeof u=="string"?(o=yr(o),u=yr(u)):(o=ol(o),u=ol(u)),d=e(o,u)}return d}}function Vo(e){return ii(function(i){return i=nt(i,gr(ue())),we(function(o){var u=this;return e(i,function(d){return qt(d,u,o)})})})}function ta(e,i){i=i===r?" ":yr(i);var o=i.length;if(o<2)return o?qo(i,e):i;var u=qo(i,Fs(e/sn(i)));return nn(i)?Ei(Dr(u),0,e).join(""):u.slice(0,e)}function Ag(e,i,o,u){var d=i&ie,w=qn(e);function x(){for(var T=-1,D=arguments.length,K=-1,k=u.length,G=j(k+D),X=this&&this!==Pe&&this instanceof x?w:e;++K<k;)G[K]=u[K];for(;D--;)G[K++]=arguments[++T];return qt(X,d?o:this,G)}return x}function Il(e){return function(i,o,u){return u&&typeof u!="number"&&tr(i,o,u)&&(o=u=r),i=ai(i),o===r?(o=i,i=0):o=ai(o),u=u===r?i<o?1:-1:ai(u),gg(i,o,u,e)}}function ra(e){return function(i,o){return typeof i=="string"&&typeof o=="string"||(i=Tr(i),o=Tr(o)),e(i,o)}}function Sl(e,i,o,u,d,w,x,T,D,K){var k=i&p,G=k?x:r,X=k?r:x,oe=k?w:r,le=k?r:w;i|=k?y:g,i&=~(k?g:y),i&l||(i&=~(ie|ce));var _e=[e,i,d,oe,G,le,X,T,D,K],he=o.apply(r,_e);return Xo(e)&&jl(he,_e),he.placeholder=u,Ll(he,e,i)}function Bo(e){var i=Ut[e];return function(o,u){if(o=Tr(o),u=u==null?0:Bt(me(u),292),u&&Lu(o)){var d=(je(o)+"e").split("e"),w=i(d[0]+"e"+(+d[1]+u));return d=(je(w)+"e").split("e"),+(d[0]+"e"+(+d[1]-u))}return i(o)}}var Rg=cn&&1/Rs(new cn([,-0]))[1]==Ae?function(e){return new cn(e)}:pc;function xl(e){return function(i){var o=Gt(i);return o==ve?Eo(i):o==Ue?Wd(i):zd(i,e(i))}}function ri(e,i,o,u,d,w,x,T){var D=i&ce;if(!D&&typeof e!="function")throw new Sr(f);var K=u?u.length:0;if(K||(i&=~(y|g),u=d=r),x=x===r?x:jt(me(x),0),T=T===r?T:me(T),K-=d?d.length:0,i&g){var k=u,G=d;u=d=r}var X=D?r:Qo(e),oe=[e,i,o,u,d,k,G,w,x,T];if(X&&Bg(oe,X),e=oe[0],i=oe[1],o=oe[2],u=oe[3],d=oe[4],T=oe[9]=oe[9]===r?D?0:e.length:jt(oe[9]-K,0),!T&&i&(p|m)&&(i&=~(p|m)),!i||i==ie)var le=Ng(e,i,o);else i==p||i==m?le=Tg(e,i,T):(i==y||i==(ie|y))&&!d.length?le=Ag(e,i,o,u):le=Xs.apply(r,oe);var _e=X?sl:jl;return Ll(_e(le,oe),e,i)}function Pl(e,i,o,u){return e===r||jr(e,on[o])&&!qe.call(u,o)?i:e}function Ol(e,i,o,u,d,w){return ut(e)&&ut(i)&&(w.set(i,e),Qs(e,i,r,Ol,w),w.delete(i)),e}function Cg(e){return Fn(e)?r:e}function Nl(e,i,o,u,d,w){var x=o&q,T=e.length,D=i.length;if(T!=D&&!(x&&D>T))return!1;var K=w.get(e),k=w.get(i);if(K&&k)return K==i&&k==e;var G=-1,X=!0,oe=o&W?new ji:r;for(w.set(e,i),w.set(i,e);++G<T;){var le=e[G],_e=i[G];if(u)var he=x?u(_e,le,G,i,e,w):u(le,_e,G,e,i,w);if(he!==r){if(he)continue;X=!1;break}if(oe){if(!yo(i,function(Ie,Oe){if(!On(oe,Oe)&&(le===Ie||d(le,Ie,o,u,w)))return oe.push(Oe)})){X=!1;break}}else if(!(le===_e||d(le,_e,o,u,w))){X=!1;break}}return w.delete(e),w.delete(i),X}function $g(e,i,o,u,d,w,x){switch(o){case ke:if(e.byteLength!=i.byteLength||e.byteOffset!=i.byteOffset)return!1;e=e.buffer,i=i.buffer;case Ce:return!(e.byteLength!=i.byteLength||!w(new Ls(e),new Ls(i)));case M:case U:case Re:return jr(+e,+i);case A:return e.name==i.name&&e.message==i.message;case at:case Je:return e==i+"";case ve:var T=Eo;case Ue:var D=u&q;if(T||(T=Rs),e.size!=i.size&&!D)return!1;var K=x.get(e);if(K)return K==i;u|=W,x.set(e,i);var k=Nl(T(e),T(i),u,d,w,x);return x.delete(e),k;case Ye:if(Cn)return Cn.call(e)==Cn.call(i)}return!1}function Dg(e,i,o,u,d,w){var x=o&q,T=Go(e),D=T.length,K=Go(i),k=K.length;if(D!=k&&!x)return!1;for(var G=D;G--;){var X=T[G];if(!(x?X in i:qe.call(i,X)))return!1}var oe=w.get(e),le=w.get(i);if(oe&&le)return oe==i&&le==e;var _e=!0;w.set(e,i),w.set(i,e);for(var he=x;++G<D;){X=T[G];var Ie=e[X],Oe=i[X];if(u)var vr=x?u(Oe,Ie,X,i,e,w):u(Ie,Oe,X,e,i,w);if(!(vr===r?Ie===Oe||d(Ie,Oe,o,u,w):vr)){_e=!1;break}he||(he=X=="constructor")}if(_e&&!he){var rr=e.constructor,_r=i.constructor;rr!=_r&&"constructor"in e&&"constructor"in i&&!(typeof rr=="function"&&rr instanceof rr&&typeof _r=="function"&&_r instanceof _r)&&(_e=!1)}return w.delete(e),w.delete(i),_e}function ii(e){return tc(Dl(e,r,Kl),e+"")}function Go(e){return Wu(e,Mt,Yo)}function Wo(e){return Wu(e,lr,Tl)}var Qo=Ks?function(e){return Ks.get(e)}:pc;function ia(e){for(var i=e.name+"",o=un[i],u=qe.call(un,i)?o.length:0;u--;){var d=o[u],w=d.func;if(w==null||w==e)return d.name}return i}function dn(e){var i=qe.call(_,"placeholder")?_:e;return i.placeholder}function ue(){var e=_.iteratee||fc;return e=e===fc?Yu:e,arguments.length?e(arguments[0],arguments[1]):e}function na(e,i){var o=e.__data__;return Hg(i)?o[typeof i=="string"?"string":"hash"]:o.map}function Jo(e){for(var i=Mt(e),o=i.length;o--;){var u=i[o],d=e[u];i[o]=[u,d,Cl(d)]}return i}function Mi(e,i){var o=Vd(e,i);return Ju(o)?o:r}function Ug(e){var i=qe.call(e,Di),o=e[Di];try{e[Di]=r;var u=!0}catch{}var d=Us.call(e);return u&&(i?e[Di]=o:delete e[Di]),d}var Yo=So?function(e){return e==null?[]:(e=We(e),gi(So(e),function(i){return Uu.call(e,i)}))}:gc,Tl=So?function(e){for(var i=[];e;)yi(i,Yo(e)),e=qs(e);return i}:gc,Gt=er;(xo&&Gt(new xo(new ArrayBuffer(1)))!=ke||Tn&&Gt(new Tn)!=ve||Po&&Gt(Po.resolve())!=xt||cn&&Gt(new cn)!=Ue||An&&Gt(new An)!=ze)&&(Gt=function(e){var i=er(e),o=i==Se?e.constructor:r,u=o?zi(o):"";if(u)switch(u){case mp:return ke;case vp:return ve;case _p:return xt;case bp:return Ue;case wp:return ze}return i});function jg(e,i,o){for(var u=-1,d=o.length;++u<d;){var w=o[u],x=w.size;switch(w.type){case"drop":e+=x;break;case"dropRight":i-=x;break;case"take":i=Bt(i,e+x);break;case"takeRight":e=jt(e,i-x);break}}return{start:e,end:i}}function Lg(e){var i=e.match(Qe);return i?i[1].split(At):[]}function Al(e,i,o){i=wi(i,e);for(var u=-1,d=i.length,w=!1;++u<d;){var x=Gr(i[u]);if(!(w=e!=null&&o(e,x)))break;e=e[x]}return w||++u!=d?w:(d=e==null?0:e.length,!!d&&ha(d)&&ni(x,d)&&(ye(e)||Fi(e)))}function qg(e){var i=e.length,o=new e.constructor(i);return i&&typeof e[0]=="string"&&qe.call(e,"index")&&(o.index=e.index,o.input=e.input),o}function Rl(e){return typeof e.constructor=="function"&&!Mn(e)?ln(qs(e)):{}}function Mg(e,i,o){var u=e.constructor;switch(i){case Ce:return ko(e);case M:case U:return new u(+e);case ke:return Eg(e,o);case ht:case Le:case Pt:case Dt:case Ft:case Ht:case Lt:case Yt:case ar:return dl(e,o);case ve:return new u;case Re:case Je:return new u(e);case at:return Ig(e);case Ue:return new u;case Ye:return Sg(e)}}function zg(e,i){var o=i.length;if(!o)return e;var u=o-1;return i[u]=(o>1?"& ":"")+i[u],i=i.join(o>2?", ":" "),e.replace(mt,`{
/* [wrapped with `+i+`] */
`)}function Fg(e){return ye(e)||Fi(e)||!!(ju&&e&&e[ju])}function ni(e,i){var o=typeof e;return i=i??ee,!!i&&(o=="number"||o!="symbol"&&Xa.test(e))&&e>-1&&e%1==0&&e<i}function tr(e,i,o){if(!ut(o))return!1;var u=typeof i;return(u=="number"?ur(o)&&ni(i,o.length):u=="string"&&i in o)?jr(o[i],e):!1}function Zo(e,i){if(ye(e))return!1;var o=typeof e;return o=="number"||o=="symbol"||o=="boolean"||e==null||mr(e)?!0:Ot.test(e)||!it.test(e)||i!=null&&e in We(i)}function Hg(e){var i=typeof e;return i=="string"||i=="number"||i=="symbol"||i=="boolean"?e!=="__proto__":e===null}function Xo(e){var i=ia(e),o=_[i];if(typeof o!="function"||!(i in xe.prototype))return!1;if(e===o)return!0;var u=Qo(o);return!!u&&e===u[0]}function Kg(e){return!!Cu&&Cu in e}var kg=$s?si:yc;function Mn(e){var i=e&&e.constructor,o=typeof i=="function"&&i.prototype||on;return e===o}function Cl(e){return e===e&&!ut(e)}function $l(e,i){return function(o){return o==null?!1:o[e]===i&&(i!==r||e in We(o))}}function Vg(e){var i=ua(e,function(u){return o.size===v&&o.clear(),u}),o=i.cache;return i}function Bg(e,i){var o=e[1],u=i[1],d=o|u,w=d<(ie|ce|N),x=u==N&&o==p||u==N&&o==P&&e[7].length<=i[8]||u==(N|P)&&i[7].length<=i[8]&&o==p;if(!(w||x))return e;u&ie&&(e[2]=i[2],d|=o&ie?0:l);var T=i[3];if(T){var D=e[3];e[3]=D?gl(D,T,i[4]):T,e[4]=D?mi(e[3],E):i[4]}return T=i[5],T&&(D=e[5],e[5]=D?yl(D,T,i[6]):T,e[6]=D?mi(e[5],E):i[6]),T=i[7],T&&(e[7]=T),u&N&&(e[8]=e[8]==null?i[8]:Bt(e[8],i[8])),e[9]==null&&(e[9]=i[9]),e[0]=i[0],e[1]=d,e}function Gg(e){var i=[];if(e!=null)for(var o in We(e))i.push(o);return i}function Wg(e){return Us.call(e)}function Dl(e,i,o){return i=jt(i===r?e.length-1:i,0),function(){for(var u=arguments,d=-1,w=jt(u.length-i,0),x=j(w);++d<w;)x[d]=u[i+d];d=-1;for(var T=j(i+1);++d<i;)T[d]=u[d];return T[i]=o(x),qt(e,this,T)}}function Ul(e,i){return i.length<2?e:qi(e,Or(i,0,-1))}function Qg(e,i){for(var o=e.length,u=Bt(i.length,o),d=cr(e);u--;){var w=i[u];e[u]=ni(w,o)?d[w]:r}return e}function ec(e,i){if(!(i==="constructor"&&typeof e[i]=="function")&&i!="__proto__")return e[i]}var jl=ql(sl),zn=lp||function(e,i){return Pe.setTimeout(e,i)},tc=ql(vg);function Ll(e,i,o){var u=i+"";return tc(e,zg(u,Jg(Lg(u),o)))}function ql(e){var i=0,o=0;return function(){var u=pp(),d=tt-(u-o);if(o=u,d>0){if(++i>=Te)return arguments[0]}else i=0;return e.apply(r,arguments)}}function sa(e,i){var o=-1,u=e.length,d=u-1;for(i=i===r?u:i;++o<i;){var w=Lo(o,d),x=e[w];e[w]=e[o],e[o]=x}return e.length=i,e}var Ml=Vg(function(e){var i=[];return e.charCodeAt(0)===46&&i.push(""),e.replace(Nt,function(o,u,d,w){i.push(d?w.replace(Ga,"$1"):u||o)}),i});function Gr(e){if(typeof e=="string"||mr(e))return e;var i=e+"";return i=="0"&&1/e==-Ae?"-0":i}function zi(e){if(e!=null){try{return Ds.call(e)}catch{}try{return e+""}catch{}}return""}function Jg(e,i){return Ir(Fr,function(o){var u="_."+o[0];i&o[1]&&!Ts(e,u)&&e.push(u)}),e.sort()}function zl(e){if(e instanceof xe)return e.clone();var i=new xr(e.__wrapped__,e.__chain__);return i.__actions__=cr(e.__actions__),i.__index__=e.__index__,i.__values__=e.__values__,i}function Yg(e,i,o){(o?tr(e,i,o):i===r)?i=1:i=jt(me(i),0);var u=e==null?0:e.length;if(!u||i<1)return[];for(var d=0,w=0,x=j(Fs(u/i));d<u;)x[w++]=Or(e,d,d+=i);return x}function Zg(e){for(var i=-1,o=e==null?0:e.length,u=0,d=[];++i<o;){var w=e[i];w&&(d[u++]=w)}return d}function Xg(){var e=arguments.length;if(!e)return[];for(var i=j(e-1),o=arguments[0],u=e;u--;)i[u-1]=arguments[u];return yi(ye(o)?cr(o):[o],Kt(i,1))}var ey=we(function(e,i){return Et(e)?Dn(e,Kt(i,1,Et,!0)):[]}),ty=we(function(e,i){var o=Nr(i);return Et(o)&&(o=r),Et(e)?Dn(e,Kt(i,1,Et,!0),ue(o,2)):[]}),ry=we(function(e,i){var o=Nr(i);return Et(o)&&(o=r),Et(e)?Dn(e,Kt(i,1,Et,!0),r,o):[]});function iy(e,i,o){var u=e==null?0:e.length;return u?(i=o||i===r?1:me(i),Or(e,i<0?0:i,u)):[]}function ny(e,i,o){var u=e==null?0:e.length;return u?(i=o||i===r?1:me(i),i=u-i,Or(e,0,i<0?0:i)):[]}function sy(e,i){return e&&e.length?Ys(e,ue(i,3),!0,!0):[]}function ay(e,i){return e&&e.length?Ys(e,ue(i,3),!0):[]}function oy(e,i,o,u){var d=e==null?0:e.length;return d?(o&&typeof o!="number"&&tr(e,i,o)&&(o=0,u=d),Xp(e,i,o,u)):[]}function Fl(e,i,o){var u=e==null?0:e.length;if(!u)return-1;var d=o==null?0:me(o);return d<0&&(d=jt(u+d,0)),As(e,ue(i,3),d)}function Hl(e,i,o){var u=e==null?0:e.length;if(!u)return-1;var d=u-1;return o!==r&&(d=me(o),d=o<0?jt(u+d,0):Bt(d,u-1)),As(e,ue(i,3),d,!0)}function Kl(e){var i=e==null?0:e.length;return i?Kt(e,1):[]}function cy(e){var i=e==null?0:e.length;return i?Kt(e,Ae):[]}function uy(e,i){var o=e==null?0:e.length;return o?(i=i===r?1:me(i),Kt(e,i)):[]}function ly(e){for(var i=-1,o=e==null?0:e.length,u={};++i<o;){var d=e[i];u[d[0]]=d[1]}return u}function kl(e){return e&&e.length?e[0]:r}function hy(e,i,o){var u=e==null?0:e.length;if(!u)return-1;var d=o==null?0:me(o);return d<0&&(d=jt(u+d,0)),rn(e,i,d)}function fy(e){var i=e==null?0:e.length;return i?Or(e,0,-1):[]}var dy=we(function(e){var i=nt(e,Ho);return i.length&&i[0]===e[0]?Co(i):[]}),py=we(function(e){var i=Nr(e),o=nt(e,Ho);return i===Nr(o)?i=r:o.pop(),o.length&&o[0]===e[0]?Co(o,ue(i,2)):[]}),gy=we(function(e){var i=Nr(e),o=nt(e,Ho);return i=typeof i=="function"?i:r,i&&o.pop(),o.length&&o[0]===e[0]?Co(o,r,i):[]});function yy(e,i){return e==null?"":fp.call(e,i)}function Nr(e){var i=e==null?0:e.length;return i?e[i-1]:r}function my(e,i,o){var u=e==null?0:e.length;if(!u)return-1;var d=u;return o!==r&&(d=me(o),d=d<0?jt(u+d,0):Bt(d,u-1)),i===i?Jd(e,i,d):As(e,Su,d,!0)}function vy(e,i){return e&&e.length?tl(e,me(i)):r}var _y=we(Vl);function Vl(e,i){return e&&e.length&&i&&i.length?jo(e,i):e}function by(e,i,o){return e&&e.length&&i&&i.length?jo(e,i,ue(o,2)):e}function wy(e,i,o){return e&&e.length&&i&&i.length?jo(e,i,r,o):e}var Ey=ii(function(e,i){var o=e==null?0:e.length,u=No(e,i);return nl(e,nt(i,function(d){return ni(d,o)?+d:d}).sort(pl)),u});function Iy(e,i){var o=[];if(!(e&&e.length))return o;var u=-1,d=[],w=e.length;for(i=ue(i,3);++u<w;){var x=e[u];i(x,u,e)&&(o.push(x),d.push(u))}return nl(e,d),o}function rc(e){return e==null?e:yp.call(e)}function Sy(e,i,o){var u=e==null?0:e.length;return u?(o&&typeof o!="number"&&tr(e,i,o)?(i=0,o=u):(i=i==null?0:me(i),o=o===r?u:me(o)),Or(e,i,o)):[]}function xy(e,i){return Js(e,i)}function Py(e,i,o){return Mo(e,i,ue(o,2))}function Oy(e,i){var o=e==null?0:e.length;if(o){var u=Js(e,i);if(u<o&&jr(e[u],i))return u}return-1}function Ny(e,i){return Js(e,i,!0)}function Ty(e,i,o){return Mo(e,i,ue(o,2),!0)}function Ay(e,i){var o=e==null?0:e.length;if(o){var u=Js(e,i,!0)-1;if(jr(e[u],i))return u}return-1}function Ry(e){return e&&e.length?al(e):[]}function Cy(e,i){return e&&e.length?al(e,ue(i,2)):[]}function $y(e){var i=e==null?0:e.length;return i?Or(e,1,i):[]}function Dy(e,i,o){return e&&e.length?(i=o||i===r?1:me(i),Or(e,0,i<0?0:i)):[]}function Uy(e,i,o){var u=e==null?0:e.length;return u?(i=o||i===r?1:me(i),i=u-i,Or(e,i<0?0:i,u)):[]}function jy(e,i){return e&&e.length?Ys(e,ue(i,3),!1,!0):[]}function Ly(e,i){return e&&e.length?Ys(e,ue(i,3)):[]}var qy=we(function(e){return bi(Kt(e,1,Et,!0))}),My=we(function(e){var i=Nr(e);return Et(i)&&(i=r),bi(Kt(e,1,Et,!0),ue(i,2))}),zy=we(function(e){var i=Nr(e);return i=typeof i=="function"?i:r,bi(Kt(e,1,Et,!0),r,i)});function Fy(e){return e&&e.length?bi(e):[]}function Hy(e,i){return e&&e.length?bi(e,ue(i,2)):[]}function Ky(e,i){return i=typeof i=="function"?i:r,e&&e.length?bi(e,r,i):[]}function ic(e){if(!(e&&e.length))return[];var i=0;return e=gi(e,function(o){if(Et(o))return i=jt(o.length,i),!0}),bo(i,function(o){return nt(e,mo(o))})}function Bl(e,i){if(!(e&&e.length))return[];var o=ic(e);return i==null?o:nt(o,function(u){return qt(i,r,u)})}var ky=we(function(e,i){return Et(e)?Dn(e,i):[]}),Vy=we(function(e){return Fo(gi(e,Et))}),By=we(function(e){var i=Nr(e);return Et(i)&&(i=r),Fo(gi(e,Et),ue(i,2))}),Gy=we(function(e){var i=Nr(e);return i=typeof i=="function"?i:r,Fo(gi(e,Et),r,i)}),Wy=we(ic);function Qy(e,i){return ll(e||[],i||[],$n)}function Jy(e,i){return ll(e||[],i||[],Ln)}var Yy=we(function(e){var i=e.length,o=i>1?e[i-1]:r;return o=typeof o=="function"?(e.pop(),o):r,Bl(e,o)});function Gl(e){var i=_(e);return i.__chain__=!0,i}function Zy(e,i){return i(e),e}function aa(e,i){return i(e)}var Xy=ii(function(e){var i=e.length,o=i?e[0]:0,u=this.__wrapped__,d=function(w){return No(w,e)};return i>1||this.__actions__.length||!(u instanceof xe)||!ni(o)?this.thru(d):(u=u.slice(o,+o+(i?1:0)),u.__actions__.push({func:aa,args:[d],thisArg:r}),new xr(u,this.__chain__).thru(function(w){return i&&!w.length&&w.push(r),w}))});function em(){return Gl(this)}function tm(){return new xr(this.value(),this.__chain__)}function rm(){this.__values__===r&&(this.__values__=oh(this.value()));var e=this.__index__>=this.__values__.length,i=e?r:this.__values__[this.__index__++];return{done:e,value:i}}function im(){return this}function nm(e){for(var i,o=this;o instanceof Vs;){var u=zl(o);u.__index__=0,u.__values__=r,i?d.__wrapped__=u:i=u;var d=u;o=o.__wrapped__}return d.__wrapped__=e,i}function sm(){var e=this.__wrapped__;if(e instanceof xe){var i=e;return this.__actions__.length&&(i=new xe(this)),i=i.reverse(),i.__actions__.push({func:aa,args:[rc],thisArg:r}),new xr(i,this.__chain__)}return this.thru(rc)}function am(){return ul(this.__wrapped__,this.__actions__)}var om=Zs(function(e,i,o){qe.call(e,o)?++e[o]:ti(e,o,1)});function cm(e,i,o){var u=ye(e)?Eu:Zp;return o&&tr(e,i,o)&&(i=r),u(e,ue(i,3))}function um(e,i){var o=ye(e)?gi:Bu;return o(e,ue(i,3))}var lm=bl(Fl),hm=bl(Hl);function fm(e,i){return Kt(oa(e,i),1)}function dm(e,i){return Kt(oa(e,i),Ae)}function pm(e,i,o){return o=o===r?1:me(o),Kt(oa(e,i),o)}function Wl(e,i){var o=ye(e)?Ir:_i;return o(e,ue(i,3))}function Ql(e,i){var o=ye(e)?$d:Vu;return o(e,ue(i,3))}var gm=Zs(function(e,i,o){qe.call(e,o)?e[o].push(i):ti(e,o,[i])});function ym(e,i,o,u){e=ur(e)?e:gn(e),o=o&&!u?me(o):0;var d=e.length;return o<0&&(o=jt(d+o,0)),fa(e)?o<=d&&e.indexOf(i,o)>-1:!!d&&rn(e,i,o)>-1}var mm=we(function(e,i,o){var u=-1,d=typeof i=="function",w=ur(e)?j(e.length):[];return _i(e,function(x){w[++u]=d?qt(i,x,o):Un(x,i,o)}),w}),vm=Zs(function(e,i,o){ti(e,o,i)});function oa(e,i){var o=ye(e)?nt:Zu;return o(e,ue(i,3))}function _m(e,i,o,u){return e==null?[]:(ye(i)||(i=i==null?[]:[i]),o=u?r:o,ye(o)||(o=o==null?[]:[o]),rl(e,i,o))}var bm=Zs(function(e,i,o){e[o?0:1].push(i)},function(){return[[],[]]});function wm(e,i,o){var u=ye(e)?go:Pu,d=arguments.length<3;return u(e,ue(i,4),o,d,_i)}function Em(e,i,o){var u=ye(e)?Dd:Pu,d=arguments.length<3;return u(e,ue(i,4),o,d,Vu)}function Im(e,i){var o=ye(e)?gi:Bu;return o(e,la(ue(i,3)))}function Sm(e){var i=ye(e)?Fu:yg;return i(e)}function xm(e,i,o){(o?tr(e,i,o):i===r)?i=1:i=me(i);var u=ye(e)?Gp:mg;return u(e,i)}function Pm(e){var i=ye(e)?Wp:_g;return i(e)}function Om(e){if(e==null)return 0;if(ur(e))return fa(e)?sn(e):e.length;var i=Gt(e);return i==ve||i==Ue?e.size:Do(e).length}function Nm(e,i,o){var u=ye(e)?yo:bg;return o&&tr(e,i,o)&&(i=r),u(e,ue(i,3))}var Tm=we(function(e,i){if(e==null)return[];var o=i.length;return o>1&&tr(e,i[0],i[1])?i=[]:o>2&&tr(i[0],i[1],i[2])&&(i=[i[0]]),rl(e,Kt(i,1),[])}),ca=up||function(){return Pe.Date.now()};function Am(e,i){if(typeof i!="function")throw new Sr(f);return e=me(e),function(){if(--e<1)return i.apply(this,arguments)}}function Jl(e,i,o){return i=o?r:i,i=e&&i==null?e.length:i,ri(e,N,r,r,r,r,i)}function Yl(e,i){var o;if(typeof i!="function")throw new Sr(f);return e=me(e),function(){return--e>0&&(o=i.apply(this,arguments)),e<=1&&(i=r),o}}var nc=we(function(e,i,o){var u=ie;if(o.length){var d=mi(o,dn(nc));u|=y}return ri(e,u,i,o,d)}),Zl=we(function(e,i,o){var u=ie|ce;if(o.length){var d=mi(o,dn(Zl));u|=y}return ri(i,u,e,o,d)});function Xl(e,i,o){i=o?r:i;var u=ri(e,p,r,r,r,r,r,i);return u.placeholder=Xl.placeholder,u}function eh(e,i,o){i=o?r:i;var u=ri(e,m,r,r,r,r,r,i);return u.placeholder=eh.placeholder,u}function th(e,i,o){var u,d,w,x,T,D,K=0,k=!1,G=!1,X=!0;if(typeof e!="function")throw new Sr(f);i=Tr(i)||0,ut(o)&&(k=!!o.leading,G="maxWait"in o,w=G?jt(Tr(o.maxWait)||0,i):w,X="trailing"in o?!!o.trailing:X);function oe(It){var Lr=u,oi=d;return u=d=r,K=It,x=e.apply(oi,Lr),x}function le(It){return K=It,T=zn(Ie,i),k?oe(It):x}function _e(It){var Lr=It-D,oi=It-K,bh=i-Lr;return G?Bt(bh,w-oi):bh}function he(It){var Lr=It-D,oi=It-K;return D===r||Lr>=i||Lr<0||G&&oi>=w}function Ie(){var It=ca();if(he(It))return Oe(It);T=zn(Ie,_e(It))}function Oe(It){return T=r,X&&u?oe(It):(u=d=r,x)}function vr(){T!==r&&hl(T),K=0,u=D=d=T=r}function rr(){return T===r?x:Oe(ca())}function _r(){var It=ca(),Lr=he(It);if(u=arguments,d=this,D=It,Lr){if(T===r)return le(D);if(G)return hl(T),T=zn(Ie,i),oe(D)}return T===r&&(T=zn(Ie,i)),x}return _r.cancel=vr,_r.flush=rr,_r}var Rm=we(function(e,i){return ku(e,1,i)}),Cm=we(function(e,i,o){return ku(e,Tr(i)||0,o)});function $m(e){return ri(e,Q)}function ua(e,i){if(typeof e!="function"||i!=null&&typeof i!="function")throw new Sr(f);var o=function(){var u=arguments,d=i?i.apply(this,u):u[0],w=o.cache;if(w.has(d))return w.get(d);var x=e.apply(this,u);return o.cache=w.set(d,x)||w,x};return o.cache=new(ua.Cache||ei),o}ua.Cache=ei;function la(e){if(typeof e!="function")throw new Sr(f);return function(){var i=arguments;switch(i.length){case 0:return!e.call(this);case 1:return!e.call(this,i[0]);case 2:return!e.call(this,i[0],i[1]);case 3:return!e.call(this,i[0],i[1],i[2])}return!e.apply(this,i)}}function Dm(e){return Yl(2,e)}var Um=wg(function(e,i){i=i.length==1&&ye(i[0])?nt(i[0],gr(ue())):nt(Kt(i,1),gr(ue()));var o=i.length;return we(function(u){for(var d=-1,w=Bt(u.length,o);++d<w;)u[d]=i[d].call(this,u[d]);return qt(e,this,u)})}),sc=we(function(e,i){var o=mi(i,dn(sc));return ri(e,y,r,i,o)}),rh=we(function(e,i){var o=mi(i,dn(rh));return ri(e,g,r,i,o)}),jm=ii(function(e,i){return ri(e,P,r,r,r,i)});function Lm(e,i){if(typeof e!="function")throw new Sr(f);return i=i===r?i:me(i),we(e,i)}function qm(e,i){if(typeof e!="function")throw new Sr(f);return i=i==null?0:jt(me(i),0),we(function(o){var u=o[i],d=Ei(o,0,i);return u&&yi(d,u),qt(e,this,d)})}function Mm(e,i,o){var u=!0,d=!0;if(typeof e!="function")throw new Sr(f);return ut(o)&&(u="leading"in o?!!o.leading:u,d="trailing"in o?!!o.trailing:d),th(e,i,{leading:u,maxWait:i,trailing:d})}function zm(e){return Jl(e,1)}function Fm(e,i){return sc(Ko(i),e)}function Hm(){if(!arguments.length)return[];var e=arguments[0];return ye(e)?e:[e]}function Km(e){return Pr(e,z)}function km(e,i){return i=typeof i=="function"?i:r,Pr(e,z,i)}function Vm(e){return Pr(e,O|z)}function Bm(e,i){return i=typeof i=="function"?i:r,Pr(e,O|z,i)}function Gm(e,i){return i==null||Ku(e,i,Mt(i))}function jr(e,i){return e===i||e!==e&&i!==i}var Wm=ra(Ro),Qm=ra(function(e,i){return e>=i}),Fi=Qu(function(){return arguments}())?Qu:function(e){return vt(e)&&qe.call(e,"callee")&&!Uu.call(e,"callee")},ye=j.isArray,Jm=Xt?gr(Xt):ng;function ur(e){return e!=null&&ha(e.length)&&!si(e)}function Et(e){return vt(e)&&ur(e)}function Ym(e){return e===!0||e===!1||vt(e)&&er(e)==M}var Ii=hp||yc,Zm=$r?gr($r):sg;function Xm(e){return vt(e)&&e.nodeType===1&&!Fn(e)}function e0(e){if(e==null)return!0;if(ur(e)&&(ye(e)||typeof e=="string"||typeof e.splice=="function"||Ii(e)||pn(e)||Fi(e)))return!e.length;var i=Gt(e);if(i==ve||i==Ue)return!e.size;if(Mn(e))return!Do(e).length;for(var o in e)if(qe.call(e,o))return!1;return!0}function t0(e,i){return jn(e,i)}function r0(e,i,o){o=typeof o=="function"?o:r;var u=o?o(e,i):r;return u===r?jn(e,i,r,o):!!u}function ac(e){if(!vt(e))return!1;var i=er(e);return i==A||i==h||typeof e.message=="string"&&typeof e.name=="string"&&!Fn(e)}function i0(e){return typeof e=="number"&&Lu(e)}function si(e){if(!ut(e))return!1;var i=er(e);return i==ae||i==de||i==F||i==_t}function ih(e){return typeof e=="number"&&e==me(e)}function ha(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=ee}function ut(e){var i=typeof e;return e!=null&&(i=="object"||i=="function")}function vt(e){return e!=null&&typeof e=="object"}var nh=Er?gr(Er):og;function n0(e,i){return e===i||$o(e,i,Jo(i))}function s0(e,i,o){return o=typeof o=="function"?o:r,$o(e,i,Jo(i),o)}function a0(e){return sh(e)&&e!=+e}function o0(e){if(kg(e))throw new pe(c);return Ju(e)}function c0(e){return e===null}function u0(e){return e==null}function sh(e){return typeof e=="number"||vt(e)&&er(e)==Re}function Fn(e){if(!vt(e)||er(e)!=Se)return!1;var i=qs(e);if(i===null)return!0;var o=qe.call(i,"constructor")&&i.constructor;return typeof o=="function"&&o instanceof o&&Ds.call(o)==sp}var oc=kr?gr(kr):cg;function l0(e){return ih(e)&&e>=-ee&&e<=ee}var ah=Pn?gr(Pn):ug;function fa(e){return typeof e=="string"||!ye(e)&&vt(e)&&er(e)==Je}function mr(e){return typeof e=="symbol"||vt(e)&&er(e)==Ye}var pn=$i?gr($i):lg;function h0(e){return e===r}function f0(e){return vt(e)&&Gt(e)==ze}function d0(e){return vt(e)&&er(e)==Ze}var p0=ra(Uo),g0=ra(function(e,i){return e<=i});function oh(e){if(!e)return[];if(ur(e))return fa(e)?Dr(e):cr(e);if(Nn&&e[Nn])return Gd(e[Nn]());var i=Gt(e),o=i==ve?Eo:i==Ue?Rs:gn;return o(e)}function ai(e){if(!e)return e===0?e:0;if(e=Tr(e),e===Ae||e===-Ae){var i=e<0?-1:1;return i*Y}return e===e?e:0}function me(e){var i=ai(e),o=i%1;return i===i?o?i-o:i:0}function ch(e){return e?Li(me(e),0,Z):0}function Tr(e){if(typeof e=="number")return e;if(mr(e))return J;if(ut(e)){var i=typeof e.valueOf=="function"?e.valueOf():e;e=ut(i)?i+"":i}if(typeof e!="string")return e===0?e:+e;e=Ou(e);var o=Ja.test(e);return o||Za.test(e)?ge(e.slice(2),o?2:8):Qa.test(e)?J:+e}function uh(e){return Br(e,lr(e))}function y0(e){return e?Li(me(e),-ee,ee):e===0?e:0}function je(e){return e==null?"":yr(e)}var m0=hn(function(e,i){if(Mn(i)||ur(i)){Br(i,Mt(i),e);return}for(var o in i)qe.call(i,o)&&$n(e,o,i[o])}),lh=hn(function(e,i){Br(i,lr(i),e)}),da=hn(function(e,i,o,u){Br(i,lr(i),e,u)}),v0=hn(function(e,i,o,u){Br(i,Mt(i),e,u)}),_0=ii(No);function b0(e,i){var o=ln(e);return i==null?o:Hu(o,i)}var w0=we(function(e,i){e=We(e);var o=-1,u=i.length,d=u>2?i[2]:r;for(d&&tr(i[0],i[1],d)&&(u=1);++o<u;)for(var w=i[o],x=lr(w),T=-1,D=x.length;++T<D;){var K=x[T],k=e[K];(k===r||jr(k,on[K])&&!qe.call(e,K))&&(e[K]=w[K])}return e}),E0=we(function(e){return e.push(r,Ol),qt(hh,r,e)});function I0(e,i){return Iu(e,ue(i,3),Vr)}function S0(e,i){return Iu(e,ue(i,3),Ao)}function x0(e,i){return e==null?e:To(e,ue(i,3),lr)}function P0(e,i){return e==null?e:Gu(e,ue(i,3),lr)}function O0(e,i){return e&&Vr(e,ue(i,3))}function N0(e,i){return e&&Ao(e,ue(i,3))}function T0(e){return e==null?[]:Ws(e,Mt(e))}function A0(e){return e==null?[]:Ws(e,lr(e))}function cc(e,i,o){var u=e==null?r:qi(e,i);return u===r?o:u}function R0(e,i){return e!=null&&Al(e,i,eg)}function uc(e,i){return e!=null&&Al(e,i,tg)}var C0=El(function(e,i,o){i!=null&&typeof i.toString!="function"&&(i=Us.call(i)),e[i]=o},hc(hr)),$0=El(function(e,i,o){i!=null&&typeof i.toString!="function"&&(i=Us.call(i)),qe.call(e,i)?e[i].push(o):e[i]=[o]},ue),D0=we(Un);function Mt(e){return ur(e)?zu(e):Do(e)}function lr(e){return ur(e)?zu(e,!0):hg(e)}function U0(e,i){var o={};return i=ue(i,3),Vr(e,function(u,d,w){ti(o,i(u,d,w),u)}),o}function j0(e,i){var o={};return i=ue(i,3),Vr(e,function(u,d,w){ti(o,d,i(u,d,w))}),o}var L0=hn(function(e,i,o){Qs(e,i,o)}),hh=hn(function(e,i,o,u){Qs(e,i,o,u)}),q0=ii(function(e,i){var o={};if(e==null)return o;var u=!1;i=nt(i,function(w){return w=wi(w,e),u||(u=w.length>1),w}),Br(e,Wo(e),o),u&&(o=Pr(o,O|R|z,Cg));for(var d=i.length;d--;)zo(o,i[d]);return o});function M0(e,i){return fh(e,la(ue(i)))}var z0=ii(function(e,i){return e==null?{}:dg(e,i)});function fh(e,i){if(e==null)return{};var o=nt(Wo(e),function(u){return[u]});return i=ue(i),il(e,o,function(u,d){return i(u,d[0])})}function F0(e,i,o){i=wi(i,e);var u=-1,d=i.length;for(d||(d=1,e=r);++u<d;){var w=e==null?r:e[Gr(i[u])];w===r&&(u=d,w=o),e=si(w)?w.call(e):w}return e}function H0(e,i,o){return e==null?e:Ln(e,i,o)}function K0(e,i,o,u){return u=typeof u=="function"?u:r,e==null?e:Ln(e,i,o,u)}var dh=xl(Mt),ph=xl(lr);function k0(e,i,o){var u=ye(e),d=u||Ii(e)||pn(e);if(i=ue(i,4),o==null){var w=e&&e.constructor;d?o=u?new w:[]:ut(e)?o=si(w)?ln(qs(e)):{}:o={}}return(d?Ir:Vr)(e,function(x,T,D){return i(o,x,T,D)}),o}function V0(e,i){return e==null?!0:zo(e,i)}function B0(e,i,o){return e==null?e:cl(e,i,Ko(o))}function G0(e,i,o,u){return u=typeof u=="function"?u:r,e==null?e:cl(e,i,Ko(o),u)}function gn(e){return e==null?[]:wo(e,Mt(e))}function W0(e){return e==null?[]:wo(e,lr(e))}function Q0(e,i,o){return o===r&&(o=i,i=r),o!==r&&(o=Tr(o),o=o===o?o:0),i!==r&&(i=Tr(i),i=i===i?i:0),Li(Tr(e),i,o)}function J0(e,i,o){return i=ai(i),o===r?(o=i,i=0):o=ai(o),e=Tr(e),rg(e,i,o)}function Y0(e,i,o){if(o&&typeof o!="boolean"&&tr(e,i,o)&&(i=o=r),o===r&&(typeof i=="boolean"?(o=i,i=r):typeof e=="boolean"&&(o=e,e=r)),e===r&&i===r?(e=0,i=1):(e=ai(e),i===r?(i=e,e=0):i=ai(i)),e>i){var u=e;e=i,i=u}if(o||e%1||i%1){var d=qu();return Bt(e+d*(i-e+Be("1e-"+((d+"").length-1))),i)}return Lo(e,i)}var Z0=fn(function(e,i,o){return i=i.toLowerCase(),e+(o?gh(i):i)});function gh(e){return lc(je(e).toLowerCase())}function yh(e){return e=je(e),e&&e.replace(Yr,Hd).replace(ho,"")}function X0(e,i,o){e=je(e),i=yr(i);var u=e.length;o=o===r?u:Li(me(o),0,u);var d=o;return o-=i.length,o>=0&&e.slice(o,d)==i}function ev(e){return e=je(e),e&&rt.test(e)?e.replace(Ni,Kd):e}function tv(e){return e=je(e),e&&Tt.test(e)?e.replace(gt,"\\$&"):e}var rv=fn(function(e,i,o){return e+(o?"-":"")+i.toLowerCase()}),iv=fn(function(e,i,o){return e+(o?" ":"")+i.toLowerCase()}),nv=_l("toLowerCase");function sv(e,i,o){e=je(e),i=me(i);var u=i?sn(e):0;if(!i||u>=i)return e;var d=(i-u)/2;return ta(Hs(d),o)+e+ta(Fs(d),o)}function av(e,i,o){e=je(e),i=me(i);var u=i?sn(e):0;return i&&u<i?e+ta(i-u,o):e}function ov(e,i,o){e=je(e),i=me(i);var u=i?sn(e):0;return i&&u<i?ta(i-u,o)+e:e}function cv(e,i,o){return o||i==null?i=0:i&&(i=+i),gp(je(e).replace(yt,""),i||0)}function uv(e,i,o){return(o?tr(e,i,o):i===r)?i=1:i=me(i),qo(je(e),i)}function lv(){var e=arguments,i=je(e[0]);return e.length<3?i:i.replace(e[1],e[2])}var hv=fn(function(e,i,o){return e+(o?"_":"")+i.toLowerCase()});function fv(e,i,o){return o&&typeof o!="number"&&tr(e,i,o)&&(i=o=r),o=o===r?Z:o>>>0,o?(e=je(e),e&&(typeof i=="string"||i!=null&&!oc(i))&&(i=yr(i),!i&&nn(e))?Ei(Dr(e),0,o):e.split(i,o)):[]}var dv=fn(function(e,i,o){return e+(o?" ":"")+lc(i)});function pv(e,i,o){return e=je(e),o=o==null?0:Li(me(o),0,e.length),i=yr(i),e.slice(o,o+i.length)==i}function gv(e,i,o){var u=_.templateSettings;o&&tr(e,i,o)&&(i=r),e=je(e),i=da({},i,u,Pl);var d=da({},i.imports,u.imports,Pl),w=Mt(d),x=wo(d,w),T,D,K=0,k=i.interpolate||Qi,G="__p += '",X=Io((i.escape||Qi).source+"|"+k.source+"|"+(k===ct?Wa:Qi).source+"|"+(i.evaluate||Qi).source+"|$","g"),oe="//# sourceURL="+(qe.call(i,"sourceURL")?(i.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++fo+"]")+`
`;e.replace(X,function(he,Ie,Oe,vr,rr,_r){return Oe||(Oe=vr),G+=e.slice(K,_r).replace(eo,kd),Ie&&(T=!0,G+=`' +
__e(`+Ie+`) +
'`),rr&&(D=!0,G+=`';
`+rr+`;
__p += '`),Oe&&(G+=`' +
((__t = (`+Oe+`)) == null ? '' : __t) +
'`),K=_r+he.length,he}),G+=`';
`;var le=qe.call(i,"variable")&&i.variable;if(!le)G=`with (obj) {
`+G+`
}
`;else if(Ba.test(le))throw new pe(b);G=(D?G.replace(Hr,""):G).replace(Zt,"$1").replace(Jr,"$1;"),G="function("+(le||"obj")+`) {
`+(le?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(T?", __e = _.escape":"")+(D?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+G+`return __p
}`;var _e=vh(function(){return De(w,oe+"return "+G).apply(r,x)});if(_e.source=G,ac(_e))throw _e;return _e}function yv(e){return je(e).toLowerCase()}function mv(e){return je(e).toUpperCase()}function vv(e,i,o){if(e=je(e),e&&(o||i===r))return Ou(e);if(!e||!(i=yr(i)))return e;var u=Dr(e),d=Dr(i),w=Nu(u,d),x=Tu(u,d)+1;return Ei(u,w,x).join("")}function _v(e,i,o){if(e=je(e),e&&(o||i===r))return e.slice(0,Ru(e)+1);if(!e||!(i=yr(i)))return e;var u=Dr(e),d=Tu(u,Dr(i))+1;return Ei(u,0,d).join("")}function bv(e,i,o){if(e=je(e),e&&(o||i===r))return e.replace(yt,"");if(!e||!(i=yr(i)))return e;var u=Dr(e),d=Nu(u,Dr(i));return Ei(u,d).join("")}function wv(e,i){var o=se,u=Ee;if(ut(i)){var d="separator"in i?i.separator:d;o="length"in i?me(i.length):o,u="omission"in i?yr(i.omission):u}e=je(e);var w=e.length;if(nn(e)){var x=Dr(e);w=x.length}if(o>=w)return e;var T=o-sn(u);if(T<1)return u;var D=x?Ei(x,0,T).join(""):e.slice(0,T);if(d===r)return D+u;if(x&&(T+=D.length-T),oc(d)){if(e.slice(T).search(d)){var K,k=D;for(d.global||(d=Io(d.source,je(wr.exec(d))+"g")),d.lastIndex=0;K=d.exec(k);)var G=K.index;D=D.slice(0,G===r?T:G)}}else if(e.indexOf(yr(d),T)!=T){var X=D.lastIndexOf(d);X>-1&&(D=D.slice(0,X))}return D+u}function Ev(e){return e=je(e),e&&ft.test(e)?e.replace(di,Yd):e}var Iv=fn(function(e,i,o){return e+(o?" ":"")+i.toUpperCase()}),lc=_l("toUpperCase");function mh(e,i,o){return e=je(e),i=o?r:i,i===r?Bd(e)?ep(e):Ld(e):e.match(i)||[]}var vh=we(function(e,i){try{return qt(e,r,i)}catch(o){return ac(o)?o:new pe(o)}}),Sv=ii(function(e,i){return Ir(i,function(o){o=Gr(o),ti(e,o,nc(e[o],e))}),e});function xv(e){var i=e==null?0:e.length,o=ue();return e=i?nt(e,function(u){if(typeof u[1]!="function")throw new Sr(f);return[o(u[0]),u[1]]}):[],we(function(u){for(var d=-1;++d<i;){var w=e[d];if(qt(w[0],this,u))return qt(w[1],this,u)}})}function Pv(e){return Yp(Pr(e,O))}function hc(e){return function(){return e}}function Ov(e,i){return e==null||e!==e?i:e}var Nv=wl(),Tv=wl(!0);function hr(e){return e}function fc(e){return Yu(typeof e=="function"?e:Pr(e,O))}function Av(e){return Xu(Pr(e,O))}function Rv(e,i){return el(e,Pr(i,O))}var Cv=we(function(e,i){return function(o){return Un(o,e,i)}}),$v=we(function(e,i){return function(o){return Un(e,o,i)}});function dc(e,i,o){var u=Mt(i),d=Ws(i,u);o==null&&!(ut(i)&&(d.length||!u.length))&&(o=i,i=e,e=this,d=Ws(i,Mt(i)));var w=!(ut(o)&&"chain"in o)||!!o.chain,x=si(e);return Ir(d,function(T){var D=i[T];e[T]=D,x&&(e.prototype[T]=function(){var K=this.__chain__;if(w||K){var k=e(this.__wrapped__),G=k.__actions__=cr(this.__actions__);return G.push({func:D,args:arguments,thisArg:e}),k.__chain__=K,k}return D.apply(e,yi([this.value()],arguments))})}),e}function Dv(){return Pe._===this&&(Pe._=ap),this}function pc(){}function Uv(e){return e=me(e),we(function(i){return tl(i,e)})}var jv=Vo(nt),Lv=Vo(Eu),qv=Vo(yo);function _h(e){return Zo(e)?mo(Gr(e)):pg(e)}function Mv(e){return function(i){return e==null?r:qi(e,i)}}var zv=Il(),Fv=Il(!0);function gc(){return[]}function yc(){return!1}function Hv(){return{}}function Kv(){return""}function kv(){return!0}function Vv(e,i){if(e=me(e),e<1||e>ee)return[];var o=Z,u=Bt(e,Z);i=ue(i),e-=Z;for(var d=bo(u,i);++o<e;)i(o);return d}function Bv(e){return ye(e)?nt(e,Gr):mr(e)?[e]:cr(Ml(je(e)))}function Gv(e){var i=++np;return je(e)+i}var Wv=ea(function(e,i){return e+i},0),Qv=Bo("ceil"),Jv=ea(function(e,i){return e/i},1),Yv=Bo("floor");function Zv(e){return e&&e.length?Gs(e,hr,Ro):r}function Xv(e,i){return e&&e.length?Gs(e,ue(i,2),Ro):r}function e_(e){return xu(e,hr)}function t_(e,i){return xu(e,ue(i,2))}function r_(e){return e&&e.length?Gs(e,hr,Uo):r}function i_(e,i){return e&&e.length?Gs(e,ue(i,2),Uo):r}var n_=ea(function(e,i){return e*i},1),s_=Bo("round"),a_=ea(function(e,i){return e-i},0);function o_(e){return e&&e.length?_o(e,hr):0}function c_(e,i){return e&&e.length?_o(e,ue(i,2)):0}return _.after=Am,_.ary=Jl,_.assign=m0,_.assignIn=lh,_.assignInWith=da,_.assignWith=v0,_.at=_0,_.before=Yl,_.bind=nc,_.bindAll=Sv,_.bindKey=Zl,_.castArray=Hm,_.chain=Gl,_.chunk=Yg,_.compact=Zg,_.concat=Xg,_.cond=xv,_.conforms=Pv,_.constant=hc,_.countBy=om,_.create=b0,_.curry=Xl,_.curryRight=eh,_.debounce=th,_.defaults=w0,_.defaultsDeep=E0,_.defer=Rm,_.delay=Cm,_.difference=ey,_.differenceBy=ty,_.differenceWith=ry,_.drop=iy,_.dropRight=ny,_.dropRightWhile=sy,_.dropWhile=ay,_.fill=oy,_.filter=um,_.flatMap=fm,_.flatMapDeep=dm,_.flatMapDepth=pm,_.flatten=Kl,_.flattenDeep=cy,_.flattenDepth=uy,_.flip=$m,_.flow=Nv,_.flowRight=Tv,_.fromPairs=ly,_.functions=T0,_.functionsIn=A0,_.groupBy=gm,_.initial=fy,_.intersection=dy,_.intersectionBy=py,_.intersectionWith=gy,_.invert=C0,_.invertBy=$0,_.invokeMap=mm,_.iteratee=fc,_.keyBy=vm,_.keys=Mt,_.keysIn=lr,_.map=oa,_.mapKeys=U0,_.mapValues=j0,_.matches=Av,_.matchesProperty=Rv,_.memoize=ua,_.merge=L0,_.mergeWith=hh,_.method=Cv,_.methodOf=$v,_.mixin=dc,_.negate=la,_.nthArg=Uv,_.omit=q0,_.omitBy=M0,_.once=Dm,_.orderBy=_m,_.over=jv,_.overArgs=Um,_.overEvery=Lv,_.overSome=qv,_.partial=sc,_.partialRight=rh,_.partition=bm,_.pick=z0,_.pickBy=fh,_.property=_h,_.propertyOf=Mv,_.pull=_y,_.pullAll=Vl,_.pullAllBy=by,_.pullAllWith=wy,_.pullAt=Ey,_.range=zv,_.rangeRight=Fv,_.rearg=jm,_.reject=Im,_.remove=Iy,_.rest=Lm,_.reverse=rc,_.sampleSize=xm,_.set=H0,_.setWith=K0,_.shuffle=Pm,_.slice=Sy,_.sortBy=Tm,_.sortedUniq=Ry,_.sortedUniqBy=Cy,_.split=fv,_.spread=qm,_.tail=$y,_.take=Dy,_.takeRight=Uy,_.takeRightWhile=jy,_.takeWhile=Ly,_.tap=Zy,_.throttle=Mm,_.thru=aa,_.toArray=oh,_.toPairs=dh,_.toPairsIn=ph,_.toPath=Bv,_.toPlainObject=uh,_.transform=k0,_.unary=zm,_.union=qy,_.unionBy=My,_.unionWith=zy,_.uniq=Fy,_.uniqBy=Hy,_.uniqWith=Ky,_.unset=V0,_.unzip=ic,_.unzipWith=Bl,_.update=B0,_.updateWith=G0,_.values=gn,_.valuesIn=W0,_.without=ky,_.words=mh,_.wrap=Fm,_.xor=Vy,_.xorBy=By,_.xorWith=Gy,_.zip=Wy,_.zipObject=Qy,_.zipObjectDeep=Jy,_.zipWith=Yy,_.entries=dh,_.entriesIn=ph,_.extend=lh,_.extendWith=da,dc(_,_),_.add=Wv,_.attempt=vh,_.camelCase=Z0,_.capitalize=gh,_.ceil=Qv,_.clamp=Q0,_.clone=Km,_.cloneDeep=Vm,_.cloneDeepWith=Bm,_.cloneWith=km,_.conformsTo=Gm,_.deburr=yh,_.defaultTo=Ov,_.divide=Jv,_.endsWith=X0,_.eq=jr,_.escape=ev,_.escapeRegExp=tv,_.every=cm,_.find=lm,_.findIndex=Fl,_.findKey=I0,_.findLast=hm,_.findLastIndex=Hl,_.findLastKey=S0,_.floor=Yv,_.forEach=Wl,_.forEachRight=Ql,_.forIn=x0,_.forInRight=P0,_.forOwn=O0,_.forOwnRight=N0,_.get=cc,_.gt=Wm,_.gte=Qm,_.has=R0,_.hasIn=uc,_.head=kl,_.identity=hr,_.includes=ym,_.indexOf=hy,_.inRange=J0,_.invoke=D0,_.isArguments=Fi,_.isArray=ye,_.isArrayBuffer=Jm,_.isArrayLike=ur,_.isArrayLikeObject=Et,_.isBoolean=Ym,_.isBuffer=Ii,_.isDate=Zm,_.isElement=Xm,_.isEmpty=e0,_.isEqual=t0,_.isEqualWith=r0,_.isError=ac,_.isFinite=i0,_.isFunction=si,_.isInteger=ih,_.isLength=ha,_.isMap=nh,_.isMatch=n0,_.isMatchWith=s0,_.isNaN=a0,_.isNative=o0,_.isNil=u0,_.isNull=c0,_.isNumber=sh,_.isObject=ut,_.isObjectLike=vt,_.isPlainObject=Fn,_.isRegExp=oc,_.isSafeInteger=l0,_.isSet=ah,_.isString=fa,_.isSymbol=mr,_.isTypedArray=pn,_.isUndefined=h0,_.isWeakMap=f0,_.isWeakSet=d0,_.join=yy,_.kebabCase=rv,_.last=Nr,_.lastIndexOf=my,_.lowerCase=iv,_.lowerFirst=nv,_.lt=p0,_.lte=g0,_.max=Zv,_.maxBy=Xv,_.mean=e_,_.meanBy=t_,_.min=r_,_.minBy=i_,_.stubArray=gc,_.stubFalse=yc,_.stubObject=Hv,_.stubString=Kv,_.stubTrue=kv,_.multiply=n_,_.nth=vy,_.noConflict=Dv,_.noop=pc,_.now=ca,_.pad=sv,_.padEnd=av,_.padStart=ov,_.parseInt=cv,_.random=Y0,_.reduce=wm,_.reduceRight=Em,_.repeat=uv,_.replace=lv,_.result=F0,_.round=s_,_.runInContext=$,_.sample=Sm,_.size=Om,_.snakeCase=hv,_.some=Nm,_.sortedIndex=xy,_.sortedIndexBy=Py,_.sortedIndexOf=Oy,_.sortedLastIndex=Ny,_.sortedLastIndexBy=Ty,_.sortedLastIndexOf=Ay,_.startCase=dv,_.startsWith=pv,_.subtract=a_,_.sum=o_,_.sumBy=c_,_.template=gv,_.times=Vv,_.toFinite=ai,_.toInteger=me,_.toLength=ch,_.toLower=yv,_.toNumber=Tr,_.toSafeInteger=y0,_.toString=je,_.toUpper=mv,_.trim=vv,_.trimEnd=_v,_.trimStart=bv,_.truncate=wv,_.unescape=Ev,_.uniqueId=Gv,_.upperCase=Iv,_.upperFirst=lc,_.each=Wl,_.eachRight=Ql,_.first=kl,dc(_,function(){var e={};return Vr(_,function(i,o){qe.call(_.prototype,o)||(e[o]=i)}),e}(),{chain:!1}),_.VERSION=s,Ir(["bind","bindKey","curry","curryRight","partial","partialRight"],function(e){_[e].placeholder=_}),Ir(["drop","take"],function(e,i){xe.prototype[e]=function(o){o=o===r?1:jt(me(o),0);var u=this.__filtered__&&!i?new xe(this):this.clone();return u.__filtered__?u.__takeCount__=Bt(o,u.__takeCount__):u.__views__.push({size:Bt(o,Z),type:e+(u.__dir__<0?"Right":"")}),u},xe.prototype[e+"Right"]=function(o){return this.reverse()[e](o).reverse()}}),Ir(["filter","map","takeWhile"],function(e,i){var o=i+1,u=o==L||o==Me;xe.prototype[e]=function(d){var w=this.clone();return w.__iteratees__.push({iteratee:ue(d,3),type:o}),w.__filtered__=w.__filtered__||u,w}}),Ir(["head","last"],function(e,i){var o="take"+(i?"Right":"");xe.prototype[e]=function(){return this[o](1).value()[0]}}),Ir(["initial","tail"],function(e,i){var o="drop"+(i?"":"Right");xe.prototype[e]=function(){return this.__filtered__?new xe(this):this[o](1)}}),xe.prototype.compact=function(){return this.filter(hr)},xe.prototype.find=function(e){return this.filter(e).head()},xe.prototype.findLast=function(e){return this.reverse().find(e)},xe.prototype.invokeMap=we(function(e,i){return typeof e=="function"?new xe(this):this.map(function(o){return Un(o,e,i)})}),xe.prototype.reject=function(e){return this.filter(la(ue(e)))},xe.prototype.slice=function(e,i){e=me(e);var o=this;return o.__filtered__&&(e>0||i<0)?new xe(o):(e<0?o=o.takeRight(-e):e&&(o=o.drop(e)),i!==r&&(i=me(i),o=i<0?o.dropRight(-i):o.take(i-e)),o)},xe.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},xe.prototype.toArray=function(){return this.take(Z)},Vr(xe.prototype,function(e,i){var o=/^(?:filter|find|map|reject)|While$/.test(i),u=/^(?:head|last)$/.test(i),d=_[u?"take"+(i=="last"?"Right":""):i],w=u||/^find/.test(i);d&&(_.prototype[i]=function(){var x=this.__wrapped__,T=u?[1]:arguments,D=x instanceof xe,K=T[0],k=D||ye(x),G=function(Ie){var Oe=d.apply(_,yi([Ie],T));return u&&X?Oe[0]:Oe};k&&o&&typeof K=="function"&&K.length!=1&&(D=k=!1);var X=this.__chain__,oe=!!this.__actions__.length,le=w&&!X,_e=D&&!oe;if(!w&&k){x=_e?x:new xe(this);var he=e.apply(x,T);return he.__actions__.push({func:aa,args:[G],thisArg:r}),new xr(he,X)}return le&&_e?e.apply(this,T):(he=this.thru(G),le?u?he.value()[0]:he.value():he)})}),Ir(["pop","push","shift","sort","splice","unshift"],function(e){var i=Cs[e],o=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",u=/^(?:pop|shift)$/.test(e);_.prototype[e]=function(){var d=arguments;if(u&&!this.__chain__){var w=this.value();return i.apply(ye(w)?w:[],d)}return this[o](function(x){return i.apply(ye(x)?x:[],d)})}}),Vr(xe.prototype,function(e,i){var o=_[i];if(o){var u=o.name+"";qe.call(un,u)||(un[u]=[]),un[u].push({name:i,func:o})}}),un[Xs(r,ce).name]=[{name:"wrapper",func:r}],xe.prototype.clone=Ep,xe.prototype.reverse=Ip,xe.prototype.value=Sp,_.prototype.at=Xy,_.prototype.chain=em,_.prototype.commit=tm,_.prototype.next=rm,_.prototype.plant=nm,_.prototype.reverse=sm,_.prototype.toJSON=_.prototype.valueOf=_.prototype.value=am,_.prototype.first=_.prototype.head,Nn&&(_.prototype[Nn]=im),_},an=tp();wt?((wt.exports=an)._=an,Ge._=an):Pe._=an}).call(Qn)})(tu,tu.exports);var lx=Object.defineProperty,hx=Object.defineProperties,fx=Object.getOwnPropertyDescriptors,Of=Object.getOwnPropertySymbols,dx=Object.prototype.hasOwnProperty,px=Object.prototype.propertyIsEnumerable,Nf=(n,t,r)=>t in n?lx(n,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[t]=r,_a=(n,t)=>{for(var r in t||(t={}))dx.call(t,r)&&Nf(n,r,t[r]);if(Of)for(var r of Of(t))px.call(t,r)&&Nf(n,r,t[r]);return n},gx=(n,t)=>hx(n,fx(t));function Pi(n,t,r){var s;const a=ix(n);return((s=t.rpcMap)==null?void 0:s[a.reference])||`${ux}?chainId=${a.namespace}:${a.reference}&projectId=${r}`}function Wi(n){return n.includes(":")?n.split(":")[1]:n}function Ad(n){return n.map(t=>`${t.split(":")[0]}:${t.split(":")[1]}`)}function yx(n,t){const r=Object.keys(t.namespaces).filter(a=>a.includes(n));if(!r.length)return[];const s=[];return r.forEach(a=>{const c=t.namespaces[a].accounts;s.push(...c)}),s}function mx(n={},t={}){const r=Tf(n),s=Tf(t);return tu.exports.merge(r,s)}function Tf(n){var t,r,s,a;const c={};if(!sx(n))return c;for(const[f,b]of Object.entries(n)){const S=_u(f)?[f]:b.chains,v=b.methods||[],E=b.events||[],O=b.rpcMap||{},R=Zn(f);c[R]=gx(_a(_a({},c[R]),b),{chains:$c(S,(t=c[R])==null?void 0:t.chains),methods:$c(v,(r=c[R])==null?void 0:r.methods),events:$c(E,(s=c[R])==null?void 0:s.events),rpcMap:_a(_a({},O),(a=c[R])==null?void 0:a.rpcMap)})}return c}function vx(n){return n.includes(":")?n.split(":")[2]:n}function _x(n){const t={};for(const[r,s]of Object.entries(n)){const a=s.methods||[],c=s.events||[],f=s.accounts||[],b=_u(r)?[r]:s.chains?s.chains:Ad(s.accounts);t[r]={chains:b,methods:a,events:c,accounts:f}}return t}function Dc(n){return typeof n=="number"?n:n.includes("0x")?parseInt(n,16):n.includes(":")?Number(n.split(":")[1]):Number(n)}const Rd={},st=n=>Rd[n],Uc=(n,t)=>{Rd[n]=t};class bx{constructor(t){this.name="polkadot",this.namespace=t.namespace,this.events=st("events"),this.client=st("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(fi.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}getAccounts(){const t=this.namespace.accounts;return t?t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2])||[]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var s;const a=Wi(r);t[a]=this.createHttpProvider(a,(s=this.namespace.rpcMap)==null?void 0:s[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProvider(t,r){const s=r||Pi(t,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);return new hi(new Oi(s,st("disableProviderPing")))}}class wx{constructor(t){this.name="eip155",this.namespace=t.namespace,this.events=st("events"),this.client=st("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain())}async request(t){switch(t.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(t);case"eth_chainId":return parseInt(this.getDefaultChain())}return this.namespace.methods.includes(t.request.method)?await this.client.request(t):this.getHttpProvider().request(t.request)}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(parseInt(t),r),this.chainId=parseInt(t),this.events.emit(fi.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}createHttpProvider(t,r){const s=r||Pi(`${this.name}:${t}`,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);return new hi(new Oi(s,st("disableProviderPing")))}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var s;const a=parseInt(Wi(r));t[a]=this.createHttpProvider(a,(s=this.namespace.rpcMap)==null?void 0:s[r])}),t}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}getHttpProvider(){const t=this.chainId,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}async handleSwitchChain(t){var r,s;let a=t.request.params?(r=t.request.params[0])==null?void 0:r.chainId:"0x0";a=a.startsWith("0x")?a:`0x${a}`;const c=parseInt(a,16);if(this.isChainApproved(c))this.setDefaultChain(`${c}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:t.topic,request:{method:t.request.method,params:[{chainId:a}]},chainId:(s=this.namespace.chains)==null?void 0:s[0]}),this.setDefaultChain(`${c}`);else throw new Error(`Failed to switch to chain 'eip155:${c}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(t){return this.namespace.chains.includes(`${this.name}:${t}`)}}class Ex{constructor(t){this.name="solana",this.namespace=t.namespace,this.events=st("events"),this.client=st("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(fi.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var s;const a=Wi(r);t[a]=this.createHttpProvider(a,(s=this.namespace.rpcMap)==null?void 0:s[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProvider(t,r){const s=r||Pi(t,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);return new hi(new Oi(s,st("disableProviderPing")))}}class Ix{constructor(t){this.name="cosmos",this.namespace=t.namespace,this.events=st("events"),this.client=st("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(fi.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var s;const a=Wi(r);t[a]=this.createHttpProvider(a,(s=this.namespace.rpcMap)==null?void 0:s[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProvider(t,r){const s=r||Pi(t,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);return new hi(new Oi(s,st("disableProviderPing")))}}class Sx{constructor(t){this.name="cip34",this.namespace=t.namespace,this.events=st("events"),this.client=st("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(fi.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{const s=this.getCardanoRPCUrl(r),a=Wi(r);t[a]=this.createHttpProvider(a,s)}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}getCardanoRPCUrl(t){const r=this.namespace.rpcMap;if(r)return r[t]}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProvider(t,r){const s=r||this.getCardanoRPCUrl(t);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);return new hi(new Oi(s,st("disableProviderPing")))}}class xx{constructor(t){this.name="elrond",this.namespace=t.namespace,this.events=st("events"),this.client=st("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(fi.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var s;const a=Wi(r);t[a]=this.createHttpProvider(a,(s=this.namespace.rpcMap)==null?void 0:s[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProvider(t,r){const s=r||Pi(t,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);return new hi(new Oi(s,st("disableProviderPing")))}}class Px{constructor(t){this.name="multiversx",this.namespace=t.namespace,this.events=st("events"),this.client=st("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(fi.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var s;const a=Wi(r);t[a]=this.createHttpProvider(a,(s=this.namespace.rpcMap)==null?void 0:s[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProvider(t,r){const s=r||Pi(t,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);return new hi(new Oi(s,st("disableProviderPing")))}}class Ox{constructor(t){this.name="near",this.namespace=t.namespace,this.events=st("events"),this.client=st("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){if(this.chainId=t,!this.httpProviders[t]){const s=r||Pi(`${this.name}:${t}`,this.namespace);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);this.setHttpProvider(t,s)}this.events.emit(fi.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const t=this.namespace.accounts;return t?t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2])||[]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var s;t[r]=this.createHttpProvider(r,(s=this.namespace.rpcMap)==null?void 0:s[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProvider(t,r){const s=r||Pi(t,this.namespace);return typeof s>"u"?void 0:new hi(new Oi(s,st("disableProviderPing")))}}var Nx=Object.defineProperty,Tx=Object.defineProperties,Ax=Object.getOwnPropertyDescriptors,Af=Object.getOwnPropertySymbols,Rx=Object.prototype.hasOwnProperty,Cx=Object.prototype.propertyIsEnumerable,Rf=(n,t,r)=>t in n?Nx(n,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[t]=r,ba=(n,t)=>{for(var r in t||(t={}))Rx.call(t,r)&&Rf(n,r,t[r]);if(Af)for(var r of Af(t))Cx.call(t,r)&&Rf(n,r,t[r]);return n},jc=(n,t)=>Tx(n,Ax(t));class bu{constructor(t){this.events=new su,this.rpcProviders={},this.shouldAbortPairingAttempt=!1,this.maxPairingAttempts=10,this.disableProviderPing=!1,this.providerOpts=t,this.logger=typeof(t==null?void 0:t.logger)<"u"&&typeof(t==null?void 0:t.logger)!="string"?t.logger:Ne.pino(Ne.getDefaultLoggerOptions({level:(t==null?void 0:t.logger)||xf})),this.disableProviderPing=(t==null?void 0:t.disableProviderPing)||!1}static async init(t){const r=new bu(t);return await r.initialize(),r}async request(t,r){const[s,a]=this.validateChain(r);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(s).request({request:ba({},t),chainId:`${s}:${a}`,topic:this.session.topic})}sendAsync(t,r,s){this.request(t,s).then(a=>r(null,a)).catch(a=>r(a,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties}),await this.requestAccounts()}async disconnect(){var t;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(t=this.session)==null?void 0:t.topic,reason:If("USER_DISCONNECTED")}),await this.cleanup()}async connect(t){if(!this.client)throw new Error("Sign Client not initialized");if(this.setNamespaces(t),await this.cleanupPendingPairings(),!t.skipPairing)return await this.pair(t.pairingTopic)}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}removeListener(t,r){this.events.removeListener(t,r)}off(t,r){this.events.off(t,r)}get isWalletConnect(){return!0}async pair(t){this.shouldAbortPairingAttempt=!1;let r=0;do{if(this.shouldAbortPairingAttempt)throw new Error("Pairing aborted");if(r>=this.maxPairingAttempts)throw new Error("Max auto pairing attempts reached");const{uri:s,approval:a}=await this.client.connect({pairingTopic:t,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties});s&&(this.uri=s,this.events.emit("display_uri",s)),await a().then(c=>{this.session=c,this.namespaces||(this.namespaces=_x(c.namespaces),this.persist("namespaces",this.namespaces))}).catch(c=>{if(c.message!==Nd)throw c;r++})}while(!this.session);return this.onConnect(),this.session}setDefaultChain(t,r){try{if(!this.session)return;const[s,a]=this.validateChain(t);this.getProvider(s).setDefaultChain(a,r)}catch(s){if(!/Please call connect/.test(s.message))throw s}}async cleanupPendingPairings(t={}){this.logger.info("Cleaning up inactive pairings...");const r=this.client.pairing.getAll();if(Sf(r)){for(const s of r)t.deletePairings?this.client.core.expirer.set(s.topic,0):await this.client.core.relayer.subscriber.unsubscribe(s.topic);this.logger.info(`Inactive pairings cleared: ${r.length}`)}}abortPairingAttempt(){this.shouldAbortPairingAttempt=!0}async checkStorage(){if(this.namespaces=await this.getFromStore("namespaces"),this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.client.session.length){const t=this.client.session.keys.length-1;this.session=this.client.session.get(this.client.session.keys[t]),this.createProviders()}}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){this.client=this.providerOpts.client||await ex.init({logger:this.providerOpts.logger||xf,relayUrl:this.providerOpts.relayUrl||ax,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name}),this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");const t=[...new Set(Object.keys(this.session.namespaces).map(r=>Zn(r)))];Uc("client",this.client),Uc("events",this.events),Uc("disableProviderPing",this.disableProviderPing),t.forEach(r=>{if(!this.session)return;const s=yx(r,this.session),a=Ad(s),c=mx(this.namespaces,this.optionalNamespaces),f=jc(ba({},c[r]),{accounts:s,chains:a});switch(r){case"eip155":this.rpcProviders[r]=new wx({namespace:f});break;case"solana":this.rpcProviders[r]=new Ex({namespace:f});break;case"cosmos":this.rpcProviders[r]=new Ix({namespace:f});break;case"polkadot":this.rpcProviders[r]=new bx({namespace:f});break;case"cip34":this.rpcProviders[r]=new Sx({namespace:f});break;case"elrond":this.rpcProviders[r]=new xx({namespace:f});break;case"multiversx":this.rpcProviders[r]=new Px({namespace:f});break;case"near":this.rpcProviders[r]=new Ox({namespace:f});break}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",t=>{this.events.emit("session_ping",t)}),this.client.on("session_event",t=>{const{params:r}=t,{event:s}=r;if(s.name==="accountsChanged"){const a=s.data;a&&Sf(a)&&this.events.emit("accountsChanged",a.map(vx))}else if(s.name==="chainChanged"){const a=r.chainId,c=r.event.data,f=Zn(a),b=Dc(a)!==Dc(c)?`${f}:${Dc(c)}`:a;this.onChainChanged(b)}else this.events.emit(s.name,s.data);this.events.emit("session_event",t)}),this.client.on("session_update",({topic:t,params:r})=>{var s;const{namespaces:a}=r,c=(s=this.client)==null?void 0:s.session.get(t);this.session=jc(ba({},c),{namespaces:a}),this.onSessionUpdate(),this.events.emit("session_update",{topic:t,params:r})}),this.client.on("session_delete",async t=>{await this.cleanup(),this.events.emit("session_delete",t),this.events.emit("disconnect",jc(ba({},If("USER_DISCONNECTED")),{data:t.topic}))}),this.on(fi.DEFAULT_CHAIN_CHANGED,t=>{this.onChainChanged(t,!0)})}getProvider(t){if(!this.rpcProviders[t])throw new Error(`Provider not found: ${t}`);return this.rpcProviders[t]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(t=>{var r;this.getProvider(t).updateNamespace((r=this.session)==null?void 0:r.namespaces[t])})}setNamespaces(t){const{namespaces:r,optionalNamespaces:s,sessionProperties:a}=t;r&&Object.keys(r).length&&(this.namespaces=r),s&&Object.keys(s).length&&(this.optionalNamespaces=s),this.sessionProperties=a,this.persist("namespaces",r),this.persist("optionalNamespaces",s)}validateChain(t){const[r,s]=(t==null?void 0:t.split(":"))||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[r,s];if(r&&!Object.keys(this.namespaces||{}).map(f=>Zn(f)).includes(r))throw new Error(`Namespace '${r}' is not configured. Please call connect() first with namespace config.`);if(r&&s)return[r,s];const a=Zn(Object.keys(this.namespaces)[0]),c=this.rpcProviders[a].getDefaultChain();return[a,c]}async requestAccounts(){const[t]=this.validateChain();return await this.getProvider(t).requestAccounts()}onChainChanged(t,r=!1){var s;if(!this.namespaces)return;const[a,c]=this.validateChain(t);r||this.getProvider(a).setDefaultChain(c),((s=this.namespaces[a])!=null?s:this.namespaces[`${a}:${c}`]).defaultChain=c,this.persist("namespaces",this.namespaces),this.events.emit("chainChanged",c)}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.session=void 0,this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,this.persist("namespaces",void 0),this.persist("optionalNamespaces",void 0),this.persist("sessionProperties",void 0),await this.cleanupPendingPairings({deletePairings:!0})}persist(t,r){this.client.core.storage.setItem(`${Pf}/${t}`,r)}async getFromStore(t){return await this.client.core.storage.getItem(`${Pf}/${t}`)}}const $x=bu,Dx="wc",Ux="ethereum_provider",jx=`${Dx}@2:${Ux}:`,Lx="https://rpc.walletconnect.com/v1/",ru=["eth_sendTransaction","personal_sign"],qx=["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","eth_sendTransaction","personal_sign","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode"],iu=["chainChanged","accountsChanged"],Mx=["chainChanged","accountsChanged","message","disconnect","connect"];var zx=Object.defineProperty,Fx=Object.defineProperties,Hx=Object.getOwnPropertyDescriptors,Cf=Object.getOwnPropertySymbols,Kx=Object.prototype.hasOwnProperty,kx=Object.prototype.propertyIsEnumerable,$f=(n,t,r)=>t in n?zx(n,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[t]=r,Xn=(n,t)=>{for(var r in t||(t={}))Kx.call(t,r)&&$f(n,r,t[r]);if(Cf)for(var r of Cf(t))kx.call(t,r)&&$f(n,r,t[r]);return n},Df=(n,t)=>Fx(n,Hx(t));function Ra(n){return Number(n[0].split(":")[1])}function Lc(n){return`0x${n.toString(16)}`}function Vx(n){const{chains:t,optionalChains:r,methods:s,optionalMethods:a,events:c,optionalEvents:f,rpcMap:b}=n;if(!Mc(t))throw new Error("Invalid chains");const S={chains:t,methods:s||ru,events:c||iu,rpcMap:Xn({},t.length?{[Ra(t)]:b[Ra(t)]}:{})},v=c==null?void 0:c.filter(z=>!iu.includes(z)),E=s==null?void 0:s.filter(z=>!ru.includes(z));if(!r&&!f&&!a&&!(v!=null&&v.length)&&!(E!=null&&E.length))return{required:t.length?S:void 0};const O=(v==null?void 0:v.length)&&(E==null?void 0:E.length)||!r,R={chains:[...new Set(O?S.chains.concat(r||[]):r)],methods:[...new Set(S.methods.concat(a!=null&&a.length?a:qx))],events:[...new Set(S.events.concat(f!=null&&f.length?f:Mx))],rpcMap:b};return{required:t.length?S:void 0,optional:r.length?R:void 0}}class wu{constructor(){this.events=new Qr.EventEmitter,this.namespace="eip155",this.accounts=[],this.chainId=1,this.STORAGE_KEY=jx,this.on=(t,r)=>(this.events.on(t,r),this),this.once=(t,r)=>(this.events.once(t,r),this),this.removeListener=(t,r)=>(this.events.removeListener(t,r),this),this.off=(t,r)=>(this.events.off(t,r),this),this.parseAccount=t=>this.isCompatibleChainId(t)?this.parseAccountId(t).address:t,this.signer={},this.rpc={}}static async init(t){const r=new wu;return await r.initialize(t),r}async request(t){return await this.signer.request(t,this.formatChainId(this.chainId))}sendAsync(t,r){this.signer.sendAsync(t,r,this.formatChainId(this.chainId))}get connected(){return this.signer.client?this.signer.client.core.relayer.connected:!1}get connecting(){return this.signer.client?this.signer.client.core.relayer.connecting:!1}async enable(){return this.session||await this.connect(),await this.request({method:"eth_requestAccounts"})}async connect(t){if(!this.signer.client)throw new Error("Provider not initialized. Call init() first");this.loadConnectOpts(t);const{required:r,optional:s}=Vx(this.rpc);try{const a=await new Promise(async(f,b)=>{var S;this.rpc.showQrModal&&((S=this.modal)==null||S.subscribeModal(v=>{!v.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),b(new Error("Connection request reset. Please try again.")))})),await this.signer.connect(Df(Xn({namespaces:Xn({},r&&{[this.namespace]:r})},s&&{optionalNamespaces:{[this.namespace]:s}}),{pairingTopic:t==null?void 0:t.pairingTopic})).then(v=>{f(v)}).catch(v=>{b(new Error(v.message))})});if(!a)return;const c=$_(a.namespaces,[this.namespace]);this.setChainIds(this.rpc.chains.length?this.rpc.chains:c),this.setAccounts(c),this.events.emit("connect",{chainId:Lc(this.chainId)})}catch(a){throw this.signer.logger.error(a),a}finally{this.modal&&this.modal.closeModal()}}async disconnect(){this.session&&await this.signer.disconnect(),this.reset()}get isWalletConnect(){return!0}get session(){return this.signer.session}registerEventListeners(){this.signer.on("session_event",t=>{const{params:r}=t,{event:s}=r;s.name==="accountsChanged"?(this.accounts=this.parseAccounts(s.data),this.events.emit("accountsChanged",this.accounts)):s.name==="chainChanged"?this.setChainId(this.formatChainId(s.data)):this.events.emit(s.name,s.data),this.events.emit("session_event",t)}),this.signer.on("chainChanged",t=>{const r=parseInt(t);this.chainId=r,this.events.emit("chainChanged",Lc(this.chainId)),this.persist()}),this.signer.on("session_update",t=>{this.events.emit("session_update",t)}),this.signer.on("session_delete",t=>{this.reset(),this.events.emit("session_delete",t),this.events.emit("disconnect",Df(Xn({},U_("USER_DISCONNECTED")),{data:t.topic,name:"USER_DISCONNECTED"}))}),this.signer.on("display_uri",t=>{var r,s;this.rpc.showQrModal&&((r=this.modal)==null||r.closeModal(),(s=this.modal)==null||s.openModal({uri:t})),this.events.emit("display_uri",t)})}switchEthereumChain(t){this.request({method:"wallet_switchEthereumChain",params:[{chainId:t.toString(16)}]})}isCompatibleChainId(t){return typeof t=="string"?t.startsWith(`${this.namespace}:`):!1}formatChainId(t){return`${this.namespace}:${t}`}parseChainId(t){return Number(t.split(":")[1])}setChainIds(t){const r=t.filter(s=>this.isCompatibleChainId(s)).map(s=>this.parseChainId(s));r.length&&(this.chainId=r[0],this.events.emit("chainChanged",Lc(this.chainId)),this.persist())}setChainId(t){if(this.isCompatibleChainId(t)){const r=this.parseChainId(t);this.chainId=r,this.switchEthereumChain(r)}}parseAccountId(t){const[r,s,a]=t.split(":");return{chainId:`${r}:${s}`,address:a}}setAccounts(t){this.accounts=t.filter(r=>this.parseChainId(this.parseAccountId(r).chainId)===this.chainId).map(r=>this.parseAccountId(r).address),this.events.emit("accountsChanged",this.accounts)}getRpcConfig(t){var r,s;const a=(r=t==null?void 0:t.chains)!=null?r:[],c=(s=t==null?void 0:t.optionalChains)!=null?s:[],f=a.concat(c);if(!f.length)throw new Error("No chains specified in either `chains` or `optionalChains`");const b=a.length?(t==null?void 0:t.methods)||ru:[],S=a.length?(t==null?void 0:t.events)||iu:[],v=(t==null?void 0:t.optionalMethods)||[],E=(t==null?void 0:t.optionalEvents)||[],O=(t==null?void 0:t.rpcMap)||this.buildRpcMap(f,t.projectId),R=(t==null?void 0:t.qrModalOptions)||void 0;return{chains:a==null?void 0:a.map(z=>this.formatChainId(z)),optionalChains:c.map(z=>this.formatChainId(z)),methods:b,events:S,optionalMethods:v,optionalEvents:E,rpcMap:O,showQrModal:!!(t!=null&&t.showQrModal),qrModalOptions:R,projectId:t.projectId,metadata:t.metadata}}buildRpcMap(t,r){const s={};return t.forEach(a=>{s[a]=this.getRpcUrl(a,r)}),s}async initialize(t){if(this.rpc=this.getRpcConfig(t),this.chainId=this.rpc.chains.length?Ra(this.rpc.chains):Ra(this.rpc.optionalChains),this.signer=await $x.init({projectId:this.rpc.projectId,metadata:this.rpc.metadata,disableProviderPing:t.disableProviderPing,relayUrl:t.relayUrl,storageOptions:t.storageOptions}),this.registerEventListeners(),await this.loadPersistedSession(),this.rpc.showQrModal){let r;try{const{WalletConnectModal:s}=await S_(()=>import("./index-gb6VXh7l.js").then(a=>a.i),__vite__mapDeps([0,1,2]));r=s}catch{throw new Error("To use QR modal, please install @walletconnect/modal package")}if(r)try{this.modal=new r(Xn({walletConnectVersion:2,projectId:this.rpc.projectId,standaloneChains:this.rpc.chains},this.rpc.qrModalOptions))}catch(s){throw this.signer.logger.error(s),new Error("Could not generate WalletConnectModal Instance")}}}loadConnectOpts(t){if(!t)return;const{chains:r,optionalChains:s,rpcMap:a}=t;r&&Mc(r)&&(this.rpc.chains=r.map(c=>this.formatChainId(c)),r.forEach(c=>{this.rpc.rpcMap[c]=(a==null?void 0:a[c])||this.getRpcUrl(c)})),s&&Mc(s)&&(this.rpc.optionalChains=[],this.rpc.optionalChains=s==null?void 0:s.map(c=>this.formatChainId(c)),s.forEach(c=>{this.rpc.rpcMap[c]=(a==null?void 0:a[c])||this.getRpcUrl(c)}))}getRpcUrl(t,r){var s;return((s=this.rpc.rpcMap)==null?void 0:s[t])||`${Lx}?chainId=eip155:${t}&projectId=${r||this.rpc.projectId}`}async loadPersistedSession(){if(!this.session)return;const t=await this.signer.client.core.storage.getItem(`${this.STORAGE_KEY}/chainId`),r=this.session.namespaces[`${this.namespace}:${t}`]?this.session.namespaces[`${this.namespace}:${t}`]:this.session.namespaces[this.namespace];this.setChainIds(t?[this.formatChainId(t)]:r==null?void 0:r.accounts),this.setAccounts(r==null?void 0:r.accounts)}reset(){this.chainId=1,this.accounts=[]}persist(){this.session&&this.signer.client.core.storage.setItem(`${this.STORAGE_KEY}/chainId`,this.chainId)}parseAccounts(t){return typeof t=="string"||t instanceof String?[this.parseAccount(t)]:t.map(r=>this.parseAccount(r))}}const hP=wu;export{hP as EthereumProvider,Mx as OPTIONAL_EVENTS,qx as OPTIONAL_METHODS,iu as REQUIRED_EVENTS,ru as REQUIRED_METHODS,wu as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/index-gb6VXh7l.js","assets/index-7Sksl8rG.js","assets/index-9zYeH8pC.css"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}